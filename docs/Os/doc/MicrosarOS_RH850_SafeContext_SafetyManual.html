---
layout: default
title: MicrosarOS_RH850_SafeContext_SafetyManual
nav_order: 1
parent: OS
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>1 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>MICROSAR OS SafeContext </b></p>
<p>Safety Manual </p>
<p> </p>
<p>Renesas RH850 with compiler Green Hills </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>Authors </p>
<p>Senol Cendere, Yohan Humbert, Michael Kock </p>
<p>Version </p>
<p>1.10 </p>
<p>Status </p>
<p>Released </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>2 </p>
<p>based on template version 2.0 </p>
<p><b>Document Information     </b></p>
<p><b>History </b></p>
<p><b>Author </b></p>
<p><b>Date </b></p>
<p><b>Version </b></p>
<p><b>Remarks </b></p>
<p>Senol Cendere  </p>
<p>2014-02-17 </p>
<p>1.00 </p>
<p>Creation for RH850 </p>
<p>Senol Cendere </p>
<p>2014-02-26 </p>
<p>1.01 </p>
<p>Updated the Requirement IDs </p>
<p>Senol Cendere </p>
<p>2014-05-09 </p>
<p>1.02 </p>
<p>Adaption for RH850 P1M </p>
<p>Senol Cendere </p>
<p>2014-08-18 </p>
<p>1.03 </p>
<p>Reworked after Safety Manual Review </p>
<p>Senol Cendere </p>
<p>2014-09-22 </p>
<p>1.04 </p>
<p>Added reference for Renesas Electronics RH850/P1M  </p>
<p>Safety Application Note </p>
<p>Removed CPU derivative specification  </p>
<p>Removed compiler options (both are specified in safety </p>
<p>case) </p>
<p>Yohan Humbert </p>
<p>2014-12-03 </p>
<p>1.05 </p>
<p>Added level support </p>
<p>Michael Kock </p>
<p>2015-08-18 </p>
<p>1.06 </p>
<p>Updated chapter Configuration Block </p>
<p>Senol Cendere  </p>
<p>2016-01-05 </p>
<p>1.07 </p>
<p>Updated hardware specific part </p>
<p>Senol Cendere </p>
<p>2016-01-29 </p>
<p>1.08 </p>
<p>Rework after review </p>
<p>Senol Cendere </p>
<p>2016-02-09 </p>
<p>1.09 </p>
<p>Rework after review </p>
<p>Michael Kock </p>
<p>2016-06-17 </p>
<p>1.10 </p>
<p>Updated chapter Review Generated Code and Rework </p>
<p>[END OF HISTORY]</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>3 </p>
<p>based on template version 2.0 </p>
<p><b>Reference Documents </b></p>
<p><b>No. </b></p>
<p><b>Source </b></p>
<p><b>Title </b></p>
<p><b>Version </b></p>
<p>[1] </p>
<p> </p>
<p>AUTOSAR </p>
<p>AUTOSAR Operating System Specification </p>
<p>This document is available in PDF-format on the Internet at </p>
<p>the AUTOSAR homepage: http://www.autosar.org</p>
<p> </p>
<p>3.x </p>
<p>4.x </p>
<p>[2] </p>
<p> </p>
<p>OSEK </p>
<p>OSEK/VDX Operating System Specification </p>
<p>This document is available in PDF-format on the Internet at </p>
<p>the OSEK/VDX homepage: http://www.osek-vdx.org </p>
<p>2.2.3 </p>
<p>[3] </p>
<p> </p>
<p>Vector Informatik </p>
<p>GmbH </p>
<p>MICROSAR OS SafeContext Technical Reference </p>
<p>TechnicalReference_Os.pdf </p>
<p>9.01 </p>
<p>[4] </p>
<p> </p>
<p>Vector Informatik </p>
<p>GmbH </p>
<p>MICROSAR Safe Silence Verifier Technical </p>
<p>Reference </p>
<p>TechnicalReference_MSSV.pdf </p>
<p>1.04 </p>
<p>[5] </p>
<p> </p>
<p>Vector Informatik </p>
<p>GmbH </p>
<p>MICROSAR OS RH850 User Manual </p>
<p>TechnicalReference_MICROSAROS_RH850.pdf </p>
<p>1.10 </p>
<p>[6] </p>
<p> </p>
<p>Vector Informatik </p>
<p>GmbH </p>
<p>Vector MICROSAR OS SafeContext Concept </p>
<p>1.04 </p>
<p>[7] </p>
<p> </p>
<p>ISO </p>
<p>International Organization for Standardization, </p>
<p>Draft International Standard ISO/DIS 26262 Road </p>
<p>Vehicles - Functional Safety (all parts), 2009 </p>
<p>2009 </p>
<p>[8] </p>
<p> </p>
<p>Renesas Electronics </p>
<p>V850E3v5 Architecture Specifications </p>
<p>(5</p>
<p>th</p>
<p> edition) </p>
<p>[9] </p>
<p> </p>
<p>Renesas Electronics  </p>
<p> </p>
<p>RH850G3K User’s Manual: Software </p>
<p>r01us0125ej0100_rh850g3k.pdf </p>
<p>Rev. 1.00 </p>
<p>Aug, 2014 </p>
<p>[10]  </p>
<p>Renesas Electronics  </p>
<p> </p>
<p>RH850G3M User’s Manual: Software </p>
<p>r01us0123ej0100_rh850g3m.pdf </p>
<p>Rev. 1.00 </p>
<p>Aug, 2014 </p>
<p>[11]  </p>
<p>Green Hills Software </p>
<p>MULTI: Building Applications for Embedded V850 </p>
<p>and RH850 </p>
<p>build_v800.pdf </p>
<p>PubID: </p>
<p>build_v800-</p>
<p>496213 </p>
<p>Date: October </p>
<p>4, 2013 </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>4 </p>
<p>based on template version 2.0 </p>
<p><b>Contents </b></p>
<p><b>1</b></p>
<p> </p>
<p><b>Purpose ......................................................................................................................... 8</b></p>
<p> </p>
<p>1.1</p>
<p> </p>
<p>Safety Element out of Context (SEooC) ............................................................. 8</p>
<p> </p>
<p>1.2</p>
<p> </p>
<p>Standards and Legal Requirements ................................................................... 8</p>
<p> </p>
<p><b>2</b></p>
<p> </p>
<p><b>Concept ......................................................................................................................... 9</b></p>
<p> </p>
<p>2.1</p>
<p> </p>
<p>SafeContext Is One Part of a Whole ................................................................... 9</p>
<p> </p>
<p>2.2</p>
<p> </p>
<p>Safety Goal ........................................................................................................ 9</p>
<p> </p>
<p>2.3</p>
<p> </p>
<p>Safety Requirements .......................................................................................... 9</p>
<p> </p>
<p>2.4</p>
<p> </p>
<p>SafeContext Functionality ................................................................................. 10</p>
<p> </p>
<p>2.4.1</p>
<p> </p>
<p>ASIL Functionality ............................................................................. 10</p>
<p> </p>
<p>2.4.2</p>
<p> </p>
<p>Detailed List...................................................................................... 12</p>
<p> </p>
<p>2.4.2.1</p>
<p> </p>
<p>Provided Functionality .................................................... 12</p>
<p> </p>
<p>2.4.2.1.1</p>
<p> </p>
<p>osGetConfigBlockVersion ........................... 14</p>
<p> </p>
<p>2.4.2.2</p>
<p> </p>
<p>Not provided Functionality .............................................. 14</p>
<p> </p>
<p>2.5</p>
<p> </p>
<p>Safe State ........................................................................................................ 15</p>
<p> </p>
<p><b>3</b></p>
<p> </p>
<p><b>Overview of Requirements to the OS User ................................................................ 16</b></p>
<p> </p>
<p><b>4</b></p>
<p> </p>
<p><b>SafeContext Assumptions .......................................................................................... 18</b></p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Context Definition ............................................................................................. 20</p>
<p> </p>
<p><b>5</b></p>
<p> </p>
<p><b>OS Source Checksum ................................................................................................. 21</b></p>
<p> </p>
<p><b>6</b></p>
<p> </p>
<p><b>Patching the Configuration Block .............................................................................. 23</b></p>
<p> </p>
<p>6.1</p>
<p> </p>
<p>Using ElfConverter ........................................................................................... 24</p>
<p> </p>
<p>6.2</p>
<p> </p>
<p>Using ConfigBlockCRCPatch ........................................................................... 24</p>
<p> </p>
<p><b>7</b></p>
<p> </p>
<p><b>SafeContext Guidelines .............................................................................................. 25</b></p>
<p> </p>
<p>7.1</p>
<p> </p>
<p>Configuration .................................................................................................... 25</p>
<p> </p>
<p>7.2</p>
<p> </p>
<p>Linking Example for Memory Mapping .............................................................. 27</p>
<p> </p>
<p><b>8</b></p>
<p> </p>
<p><b>Configuration Block Review ....................................................................................... 28</b></p>
<p> </p>
<p>8.1</p>
<p> </p>
<p>How to Read Back the Configuration ................................................................ 28</p>
<p> </p>
<p>8.1.1</p>
<p> </p>
<p>Using ElfConverter ........................................................................... 29</p>
<p> </p>
<p>8.1.2</p>
<p> </p>
<p>Using HexConverter ......................................................................... 29</p>
<p> </p>
<p>8.1.3</p>
<p> </p>
<p>Using ConfigViewer .......................................................................... 30</p>
<p> </p>
<p>8.2</p>
<p> </p>
<p>Configuration Block Head ................................................................................. 31</p>
<p> </p>
<p>8.3</p>
<p> </p>
<p>General Information .......................................................................................... 32</p>
<p> </p>
<p>8.4</p>
<p> </p>
<p>Task Start Address ........................................................................................... 34</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>5 </p>
<p>based on template version 2.0 </p>
<p>8.5</p>
<p> </p>
<p>Task Pre-emptive Configuration ........................................................................ 35</p>
<p> </p>
<p>8.6</p>
<p> </p>
<p>Task Trusted Configuration ............................................................................... 36</p>
<p> </p>
<p>8.7</p>
<p> </p>
<p>Task Stack Addresses ...................................................................................... 37</p>
<p> </p>
<p>8.8</p>
<p> </p>
<p>Task to Application Mapping ............................................................................. 38</p>
<p> </p>
<p>8.9</p>
<p> </p>
<p>Category 2 ISR Trusted Configuration .............................................................. 39</p>
<p> </p>
<p>8.10</p>
<p> </p>
<p>Category 2 ISR to Application Mapping ............................................................ 40</p>
<p> </p>
<p>8.11</p>
<p> </p>
<p>Application Trusted Configuration ..................................................................... 41</p>
<p> </p>
<p>8.12</p>
<p> </p>
<p>Trusted Functions Configuration ....................................................................... 42</p>
<p> </p>
<p>8.13</p>
<p> </p>
<p>Non-Trusted Functions Configuration ............................................................... 43</p>
<p> </p>
<p>8.14</p>
<p> </p>
<p>Category 2 ISR Start Addresses ....................................................................... 44</p>
<p> </p>
<p>8.15</p>
<p> </p>
<p>Category 2 ISR Nesting Configuration .............................................................. 45</p>
<p> </p>
<p>8.16</p>
<p> </p>
<p>Process to Core Mapping ................................................................................. 46</p>
<p> </p>
<p>8.17</p>
<p> </p>
<p>Alarms to Core Mapping ................................................................................... 47</p>
<p> </p>
<p>8.18</p>
<p> </p>
<p>Resources to Core Mapping ............................................................................. 48</p>
<p> </p>
<p>8.19</p>
<p> </p>
<p>Counters to Core Mapping ............................................................................... 49</p>
<p> </p>
<p>8.20</p>
<p> </p>
<p>Schedule Tables to Core Mapping .................................................................... 50</p>
<p> </p>
<p>8.21</p>
<p> </p>
<p>Application to Core Mapping............................................................................. 51</p>
<p> </p>
<p>8.22</p>
<p> </p>
<p>Trusted Functions to Core Mapping .................................................................. 52</p>
<p> </p>
<p>8.23</p>
<p> </p>
<p>Non-Trusted Functions to Core Mapping .......................................................... 53</p>
<p> </p>
<p>8.24</p>
<p> </p>
<p>Core Control Block Address ............................................................................. 54</p>
<p> </p>
<p>8.25</p>
<p> </p>
<p>Peripheral Regions Configuration ..................................................................... 55</p>
<p> </p>
<p>8.26</p>
<p> </p>
<p>Spinlock Lock Method ...................................................................................... 56</p>
<p> </p>
<p>8.27</p>
<p> </p>
<p>Spinlock Config Type ........................................................................................ 56</p>
<p> </p>
<p>8.28</p>
<p> </p>
<p>Optimized Spinlock Variable Addresses............................................................ 56</p>
<p> </p>
<p>8.29</p>
<p> </p>
<p>Category 2 ISR Stack Address ......................................................................... 57</p>
<p> </p>
<p>8.30</p>
<p> </p>
<p>Category 2 ISR Interrupt Channel Index ........................................................... 57</p>
<p> </p>
<p>8.31</p>
<p> </p>
<p>Category 2 ISR Priority Level ........................................................................... 58</p>
<p> </p>
<p>8.32</p>
<p> </p>
<p>Category 2 ISR to Core Mapping ...................................................................... 60</p>
<p> </p>
<p>8.33</p>
<p> </p>
<p>Application MPU Configuration ......................................................................... 61</p>
<p> </p>
<p>8.34</p>
<p> </p>
<p>MPU Configuration ........................................................................................... 62</p>
<p> </p>
<p>8.35</p>
<p> </p>
<p>Application MPU ASID Configuration ................................................................ 63</p>
<p> </p>
<p><b>9</b></p>
<p> </p>
<p><b>Generated OS Code .................................................................................................... 64</b></p>
<p> </p>
<p>9.1</p>
<p> </p>
<p>Using MICROSAR Safe Silence Verifier (MSSV) .............................................. 64</p>
<p> </p>
<p>9.2</p>
<p> </p>
<p>Manual Reviews ............................................................................................... 66</p>
<p> </p>
<p>9.2.1</p>
<p> </p>
<p>Review generated file tcb.h .............................................................. 66</p>
<p> </p>
<p>9.2.2</p>
<p> </p>
<p>Review of tcb.c ................................................................................. 67</p>
<p> </p>
<p>9.2.3</p>
<p> </p>
<p>Review of tcbpost.h .......................................................................... 69</p>
<p> </p>
<p>9.2.4</p>
<p> </p>
<p>Review of trustfct.c &amp; trustfct.h ......................................................... 71</p>
<p> </p>
<p>9.2.4.1</p>
<p> </p>
<p>File trustfct.c ................................................................... 71</p>
<p> </p>
<p>9.2.4.2</p>
<p> </p>
<p>File trustfct.h................................................................... 73</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>6 </p>
<p>based on template version 2.0 </p>
<p><b>10</b></p>
<p> </p>
<p><b>Review User Software ................................................................................................. 75</b></p>
<p> </p>
<p><b>11</b></p>
<p> </p>
<p><b>Hardware Specific Part ............................................................................................... 79</b></p>
<p> </p>
<p>11.1</p>
<p> </p>
<p>Interrupt Vector Table ....................................................................................... 82</p>
<p> </p>
<p>11.1.1</p>
<p> </p>
<p>Header Include Section .................................................................... 82</p>
<p> </p>
<p>11.1.2</p>
<p> </p>
<p>Core Exception Vector Table ............................................................ 83</p>
<p> </p>
<p>11.1.3</p>
<p> </p>
<p>EIINT Vector Table ............................................................................ 84</p>
<p> </p>
<p>11.1.4</p>
<p> </p>
<p>CAT2 ISR Wrappers ......................................................................... 85</p>
<p> </p>
<p>11.1.5</p>
<p> </p>
<p>End of file Intvect_c&lt;CoreID&gt;.c ........................................................ 85</p>
<p> </p>
<p>11.2</p>
<p> </p>
<p>Linker Memory Sections ................................................................................... 86</p>
<p> </p>
<p>11.3</p>
<p> </p>
<p>Linker Include Files .......................................................................................... 88</p>
<p> </p>
<p>11.3.1</p>
<p> </p>
<p>Review File osdata.dld ..................................................................... 88</p>
<p> </p>
<p>11.3.2</p>
<p> </p>
<p>Review File ossdata.dld .................................................................... 89</p>
<p> </p>
<p>11.3.3</p>
<p> </p>
<p>Review File osstacks.dld .................................................................. 90</p>
<p> </p>
<p>11.3.4</p>
<p> </p>
<p>Review File osrom.dld ...................................................................... 91</p>
<p> </p>
<p>11.3.5</p>
<p> </p>
<p>Review File ostdata.dld .................................................................... 91</p>
<p> </p>
<p>11.4</p>
<p> </p>
<p>Stack Size Configuration .................................................................................. 92</p>
<p> </p>
<p>11.5</p>
<p> </p>
<p>Stack Monitoring............................................................................................... 93</p>
<p> </p>
<p>11.6</p>
<p> </p>
<p>Usage of MPU Regions .................................................................................... 93</p>
<p> </p>
<p>11.7</p>
<p> </p>
<p>Usage of Peripheral Interrupt API ..................................................................... 93</p>
<p> </p>
<p><b>12</b></p>
<p> </p>
<p><b>Glossary and Abbreviations ....................................................................................... 94</b></p>
<p> </p>
<p>12.1</p>
<p> </p>
<p>Glossary ........................................................................................................... 94</p>
<p> </p>
<p>12.2</p>
<p> </p>
<p>Abbreviations ................................................................................................... 95</p>
<p> </p>
<p><b>13</b></p>
<p> </p>
<p><b>Contact ........................................................................................................................ 96</b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>7 </p>
<p>based on template version 2.0 </p>
<p><b>Illustrations </b></p>
<p>Figure 2-1</p>
<p> </p>
<p>Stored and active contexts ........................................................................ 11</p>
<p> </p>
<p>Figure 3-1</p>
<p> </p>
<p>Strategy for safety configuration ................................................................ 17</p>
<p> </p>
<p>Figure 7-1</p>
<p> </p>
<p>Linking Example ........................................................................................ 27</p>
<p> </p>
<p><b> </b></p>
<p><b>Tables </b></p>
<p>Table 2-1 </p>
<p> </p>
<p>MICROSAR OS SafeContext Functionality ............................................... 14</p>
<p> </p>
<p>Table 2-2 </p>
<p> </p>
<p>Functionality – Not provided ...................................................................... 15</p>
<p> </p>
<p>Table 4-1 </p>
<p> </p>
<p>General SafeContext Assumptions ............................................................ 19</p>
<p> </p>
<p>Table 6-1 </p>
<p> </p>
<p>ElfConverter Parameters ........................................................................... 24</p>
<p> </p>
<p>Table 8-1 </p>
<p> </p>
<p>ElfConverter Parameters ........................................................................... 29</p>
<p> </p>
<p>Table 8-2 </p>
<p> </p>
<p>HexConverter parameters ......................................................................... 29</p>
<p> </p>
<p>Table 8-3 </p>
<p> </p>
<p>ConfigViewer Parameters ......................................................................... 30</p>
<p> </p>
<p>Table 12-1 </p>
<p> </p>
<p>Glossary .................................................................................................... 94</p>
<p> </p>
<p>Table 12-2 </p>
<p> </p>
<p>Abbreviations ............................................................................................ 95</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>8 </p>
<p>based on template version 2.0 </p>
<p><b>1 </b></p>
<p><b>Purpose </b></p>
<p><b>1.1 </b></p>
<p><b>Safety Element out of Context (SEooC) </b></p>
<p>MICROSAR OS SafeContext is a Safety Element out of Context (SEooC). It is developed </p>
<p>based  on  assumptions  on  the  intended functionality,  use  and  context,  including  external </p>
<p>interfaces. To have a complete safety case, the validity of these assumptions has to be </p>
<p>checked in the context of the actual item after integration of the SEooC. </p>
<p>The application conditions for SEooC provide the assumptions made on the requirements </p>
<p>(including safety requirements) that are placed on the SEooC by higher levels of design </p>
<p>and also on the design external to the SEooC and the assumed safety requirements and </p>
<p>assumptions related to the design of the SEooC. </p>
<p>Information  given  by  this  document  helps  to  check  whether  the  SEooC  fulfills  the  item </p>
<p>requirements,  or  whether  a  change  to  the  SEooC  is  necessary  in  accordance  with  the </p>
<p>requirements of ISO 26262. </p>
<p><b>1.2 </b></p>
<p><b>Standards and Legal Requirements </b></p>
<p>Standards followed by the development of MICROSAR OS SafeContext: </p>
<p><b>&gt; </b></p>
<p>ISO 26262</p>
<p>1</p>
<p> </p>
<p><b>&gt; </b></p>
<p>OSEK OS</p>
<p>2</p>
<p> </p>
<p><b>&gt; </b></p>
<p>AUTOSAR OS</p>
<p>3</p>
<p> </p>
<p> </p>
<p>                                            </p>
<p>1</p>
<p> International Standard ISO 26262 Road Vehicles - Functional Safety (all parts), 2011 </p>
<p>2</p>
<p> OSEK/VDX Operating System, v2.2.3 </p>
<p>3</p>
<p> AUTOSAR Specification of Operating  System </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>9 </p>
<p>based on template version 2.0 </p>
<p><b>2 </b></p>
<p><b>Concept </b></p>
<p>This  chapter  provides  a  description  of  the  assumed  safety  requirements  and  the  main </p>
<p>concept. </p>
<p><b>2.1 </b></p>
<p><b>SafeContext Is One Part of a Whole </b></p>
<p>SafeContext  is part  of  Vector  SafeExecution.  SafeExecution  consists  of  SafeContext  for </p>
<p>prevention from corrupted data and SafeWatchdog for supervision of timing behavior. This </p>
<p>document covers SafeContext only. </p>
<p><b>2.2 </b></p>
<p><b>Safety Goal </b></p>
<p>The safety goal is to ensure context integrity for all safety critical parts. Whenever a safety </p>
<p>critical  code  is  executed,  it  is  guaranteed  that  the  code  is  executed  with  the  correct </p>
<p>context. After pre-emption or interruption, execution is resumed with the correct context. </p>
<p>The  integrity  of  the  memory  is  ensured  by  usage  of  hardware  (e.g.  MPU)  and  software </p>
<p>measures. </p>
<p><b>2.3 </b></p>
<p><b>Safety Requirements </b></p>
<p>To  achieve  this  safety  goal,  the  following  assumed  safety  requirements  are  provided  by </p>
<p>SafeContext: </p>
<p><b>ASA_OS_1: </b>Non-trusted software must be prevented from overwriting data of safety </p>
<p>relevant software. </p>
<p>The OS assures this mainly by programming of an MPU. </p>
<p><b>ASA_OS_2: </b>A <i>runtime context </i>(Task, Hook, (Non-)Trusted-Function or ISR) must not </p>
<p>be destroyed by a switch (to another runtime context). </p>
<p>The  OS  assures  this  mainly  by  correct  storage  and  restauration  of  the  register </p>
<p>context.  </p>
<p><b>ASA_OS_3: </b>A runtime context shall be set up according to compiler and processor </p>
<p>specifications. </p>
<p>The OS assures this mainly by correct implementation of the register setup at context </p>
<p>switches. </p>
<p><b>ASA_OS_4: </b>Services to prevent data inconsistencies by racing conditions shall be </p>
<p>provided. </p>
<p>The OS provides the following functions for this purpose: </p>
<p></p>
<p> </p>
<p>DisableAllInterrupts/EnableAllInterrupts, </p>
<p></p>
<p> </p>
<p>SuspendOsInterrupts/ResumeOSInterrupts </p>
<p></p>
<p> </p>
<p>SuspendAllInterrupts/ResumeAllInterrupts </p>
<p><b>ASA_OS_5: </b>The OS never writes to unintended memory locations. </p>
<p>The OS assures this mainly by correct implementation of its functionality. </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>10 </p>
<p>based on template version 2.0 </p>
<p><b>2.4 </b></p>
<p><b>SafeContext Functionality </b></p>
<p>MICROSAR OS SafeContext implements the AUTOSAR OS and OSEK OS standards of a </p>
<p>real-time operating system with some restrictions. </p>
<p> </p>
<p><b>2.4.1 </b></p>
<p><b>ASIL Functionality </b></p>
<p>Derived  from  our  safety  requirements,  SafeContext  provides  the  following  functionality </p>
<p>safely: </p>
<p>1. </p>
<p>Context management </p>
<p>2. </p>
<p>MPU management </p>
<p>3. </p>
<p>Interrupt API </p>
<p>4. </p>
<p>no unintended overwriting of memory </p>
<p> </p>
<p>The <i>context </i>is defined as: </p>
<p><b>&gt; </b></p>
<p>The set of registers, which is used by the compiler </p>
<p><b>&gt; </b></p>
<p>The stack pointer </p>
<p><b>&gt; </b></p>
<p>CPU mode (including interrupt state and privilege mode) </p>
<p><b>&gt; </b></p>
<p>Memory access rights </p>
<p> </p>
<p>Explanations: </p>
<p><b>&gt; </b></p>
<p>A context switch occurs in several situations. These are: Task start/preemption/stop, </p>
<p>ISR entry/exit, call of OS services, call of (Non-)Trusted Functions and Hook routines. </p>
<p>Conclusions: </p>
<p><b>&gt; </b></p>
<p>If a user program is executed, it will always be executed with the correct context </p>
<p><b>&gt; </b></p>
<p>After interruptions it is guaranteed that execution is resumed with the correct context </p>
<p><b>&gt; </b></p>
<p>Freedom from interference with respect to memory will be achieved by using memory </p>
<p>protection hardware (e.g. MPU) for non-trusted code. </p>
<p><b>&gt; </b></p>
<p>Data inconsistency due to race conditions can be prevented by using the interrupt </p>
<p>API. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>All other OS functionality, for example the sequence of task executions (scheduling) </p>
<p>including the Task pre-emption is provided on QM level. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>11 </p>
<p>based on template version 2.0 </p>
<p>The  operating  system  provides  safe  switching  of  memory  access  rights  during  context </p>
<p>switches to ensure that non-trusted code does not modify data of other OS-Applications (if </p>
<p>not explicitly allowed). In addition the OS interrupts Tasks or ISRs to execute higher priority </p>
<p>ISRs. By switching to another context the correct context is set up. By switching back to an </p>
<p>interrupted Task or ISR, the correct and unchanged context is restored. To avoid change of </p>
<p>a saved context of an interrupted or waiting task, memory protecting hardware is used. </p>
<p>All points in the OS where context switches are performed or are necessary to perform are </p>
<p>identified and developed according the safety standard. </p>
<p>At each point in time only one context is active. All other contexts are saved and protected </p>
<p>by hardware against accidental alterations. </p>
<p> </p>
<p> </p>
<p>Figure 2-1 </p>
<p>Stored and active contexts </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>time </p>
<p>now </p>
<p><b>inactive </b></p>
<p><b>inactive </b></p>
<p><b>active </b></p>
<p><b>inactive </b></p>
<p><b>inactive </b></p>
<p><b>inactive </b></p>
<p><b>Register </b></p>
<p><b>Context </b></p>
<p><b>Stack </b></p>
<p><b>Register </b></p>
<p><b>Context </b></p>
<p><b>Stack </b></p>
<p><b>Register </b></p>
<p><b>Context </b></p>
<p><b>Stack </b></p>
<p><b>Register </b></p>
<p><b>Context </b></p>
<p><b>Stack </b></p>
<p><b>Register </b></p>
<p><b>Context </b></p>
<p><b>Stack </b></p>
<p><b>Register </b></p>
<p><b>Context </b></p>
<p><b>Stack </b></p>
<p><b>MPU Protection </b></p>
<p><b>MPU Protection </b></p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>12 </p>
<p>based on template version 2.0 </p>
<p><b>2.4.2 </b></p>
<p><b>Detailed List  </b></p>
<p><b>2.4.2.1 </b></p>
<p><b>Provided Functionality </b></p>
<p>The following OS services are provided by MICROSAR OS SafeContext. </p>
<p><b>Class </b></p>
<p><b>Description </b></p>
<p>Startup API </p>
<p><b>&gt; </b></p>
<p>osInitialize </p>
<p><b>&gt; </b></p>
<p>osInitINTC </p>
<p><b>&gt; </b></p>
<p>StartOS </p>
<p>Shutdown API </p>
<p><b>&gt; </b></p>
<p>ShutdownOS </p>
<p>Application API </p>
<p><b>&gt; </b></p>
<p>GetApplicationID  </p>
<p><b>&gt; </b></p>
<p>CheckObjectOwnership  </p>
<p><b>&gt; </b></p>
<p>CheckObjectAccess  </p>
<p><b>&gt; </b></p>
<p>GetApplicationState</p>
<p> (if ASR4)</p>
<p>  </p>
<p><b>&gt; </b></p>
<p>AllowAccess </p>
<p><b>&gt; </b></p>
<p>GetISRID  </p>
<p><b>&gt; </b></p>
<p>GetTaskID</p>
<p> </p>
<p><b>&gt; </b></p>
<p>GetActiveApplicationMode </p>
<p><b>&gt; </b></p>
<p>CheckObjectAccess </p>
<p><b>&gt; </b></p>
<p>CheckObjectOwnership </p>
<p>Interrupt API </p>
<p><b>&gt; </b></p>
<p>DisableAllInterrupts </p>
<p><b>&gt; </b></p>
<p>EnableAllInterrupts  </p>
<p><b>&gt; </b></p>
<p>SuspendAllInterrupts </p>
<p><b>&gt; </b></p>
<p>ResumeAllInterrupts </p>
<p><b>&gt; </b></p>
<p>SuspendOSInterrupts </p>
<p><b>&gt; </b></p>
<p>ResumeOSInterrupts </p>
<p>Stack usage API </p>
<p><b>&gt; </b></p>
<p>osGetStackUsage </p>
<p><b>&gt; </b></p>
<p>osGetISRStackUsage </p>
<p><b>&gt; </b></p>
<p>osGetSystemStackUsage </p>
<p>Trusted Function </p>
<p>API </p>
<p><b>&gt; </b></p>
<p>CallTrustedFunction </p>
<p>Schedule Table API </p>
<p><b>&gt; </b></p>
<p>StartScheduleTableRel </p>
<p><b>&gt; </b></p>
<p>StartScheduleTableAbs  </p>
<p><b>&gt; </b></p>
<p>StopScheduleTable  </p>
<p><b>&gt; </b></p>
<p>NextScheduleTable  </p>
<p><b>&gt; </b></p>
<p>GetScheduleTableStatus </p>
<p>Event API </p>
<p><b>&gt; </b></p>
<p>SetEvent  </p>
<p><b>&gt; </b></p>
<p>ClearEvent  </p>
<p><b>&gt; </b></p>
<p>GetEvent  </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>13 </p>
<p>based on template version 2.0 </p>
<p><b>Class </b></p>
<p><b>Description </b></p>
<p><b>&gt; </b></p>
<p>WaitEvent  </p>
<p>Alarm API </p>
<p><b>&gt; </b></p>
<p>GetAlarm  </p>
<p><b>&gt; </b></p>
<p>SetRelAlarm  </p>
<p><b>&gt; </b></p>
<p>SetAbsAlarm  </p>
<p><b>&gt; </b></p>
<p>CancelAlarm  </p>
<p>Resource API </p>
<p><b>&gt; </b></p>
<p>GetResource</p>
<p> </p>
<p><b>&gt; </b></p>
<p>ReleaseResource</p>
<p> </p>
<p>Task API </p>
<p><b>&gt; </b></p>
<p>ActivateTask  </p>
<p><b>&gt; </b></p>
<p>TerminateTask </p>
<p><b>&gt; </b></p>
<p>ChainTask </p>
<p><b>&gt; </b></p>
<p>Schedule </p>
<p><b>&gt; </b></p>
<p>GetTaskState </p>
<p>Counter API </p>
<p><b>&gt; </b></p>
<p>IncrementCounter </p>
<p><b>&gt; </b></p>
<p>GetElapsedValue</p>
<p>(ASR4)/</p>
<p>GetElapsedCounterValue</p>
<p>(ASR3)</p>
<p> </p>
<p><b>&gt; </b></p>
<p>GetCounterValue </p>
<p>SafeContext </p>
<p>Extensions </p>
<p><b>&gt; </b></p>
<p>osCheckMPUAccess </p>
<p><b>&gt; </b></p>
<p>osCheckAndRefreshTimer </p>
<p><b>&gt; </b></p>
<p>osCheckAndRefreshMPU </p>
<p><b>&gt; </b></p>
<p>osGetConfigBlockVersion </p>
<p><b>&gt; </b></p>
<p>CallNonTrustedFunction </p>
<p><b>&gt; </b></p>
<p>osReadPeripheral8 </p>
<p><b>&gt; </b></p>
<p>osReadPeripheral16 </p>
<p><b>&gt; </b></p>
<p>osReadPeripheral32 </p>
<p><b>&gt; </b></p>
<p>osWritePeripheral8 </p>
<p><b>&gt; </b></p>
<p>osWritePeripheral16 </p>
<p><b>&gt; </b></p>
<p>osWritePeripheral32 </p>
<p><b>&gt; </b></p>
<p>osModifyPeripheral8 </p>
<p><b>&gt; </b></p>
<p>osModifyPeripheral16 </p>
<p><b>&gt; </b></p>
<p>osModifyPeripheral32 </p>
<p>OS System Hooks </p>
<p><b>&gt; </b></p>
<p>StartupHook </p>
<p><b>&gt; </b></p>
<p>ErrorHook </p>
<p><b>&gt; </b></p>
<p>ProtectionHook </p>
<p><b>&gt; </b></p>
<p>ShutdownHook </p>
<p>Error Handling </p>
<p><b>&gt; </b></p>
<p>osUnhandledException </p>
<p><b>&gt; </b></p>
<p>osAbortSystem </p>
<p><b>&gt; </b></p>
<p>OSErrorGetServiceId </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>14 </p>
<p>based on template version 2.0 </p>
<p><b>Class </b></p>
<p><b>Description </b></p>
<p>Timer handling </p>
<p>The handling of timer hardware is realized as QM software.</p>
<p> </p>
<p>Scheduling </p>
<p>The correct sequence of processing application programs is realized with </p>
<p>QM-Software (priority handling, including Resources).</p>
<p> </p>
<p>ORTI </p>
<p>ORTI is realized as QM software.</p>
<p> </p>
<p>Table 2-1  </p>
<p>MICROSAR OS SafeContext Functionality </p>
<p> </p>
<p><b>2.4.2.1.1 </b></p>
<p><b>osGetConfigBlockVersion </b></p>
<p>Description of the osGetConfigBlockVersion-API. [SPMF92:0045] </p>
<p><b>Prototype </b></p>
<p>uint16 osGetConfigBlockVersion(void) </p>
<p><b>Return code </b></p>
<p>uint16 </p>
<p>The version number which was specified by the user in the </p>
<p>configuration attribute</p>
<p> </p>
<p>UserConfigurationVersion</p>
<p>. </p>
<p><b>Functional Description </b></p>
<p>Return user configuration version.</p>
<p> </p>
<p><b>Particularities and Limitations </b></p>
<p><b>&gt; </b></p>
<p>- </p>
<p>Call context </p>
<p><b>&gt;</b></p>
<p><b> </b></p>
<p>any</p>
<p> </p>
<p> </p>
<p> </p>
<p><b>2.4.2.2 </b></p>
<p><b>Not provided Functionality </b></p>
<p>The features listed in the following table are not supported in SafeContext per default. </p>
<p><b>Class </b></p>
<p><b>Description </b></p>
<p>OS service API </p>
<p><b>&gt; </b></p>
<p>TerminateApplication </p>
<p><b>&gt; </b></p>
<p>CheckISRMemoryAccess </p>
<p><b>&gt; </b></p>
<p>CheckTaskMemoryAccess </p>
<p><b>&gt; </b></p>
<p>StartScheduleTableSynchron </p>
<p><b>&gt; </b></p>
<p>SyncScheduleTable  </p>
<p><b>&gt; </b></p>
<p>SetScheduleTableAsync</p>
<p> </p>
<p>COM </p>
<p>OSEK COM inter task communication with messages is not supported </p>
<p>Interrupt resources </p>
<p>Resources are only available at task level. </p>
<p>Protection Reaction </p>
<p>The only allowed protection reaction in the </p>
<p>ProtectionHook</p>
<p> is </p>
<p>PRO_SHUTDOWN</p>
<p>. Other reactions will be interpreted as </p>
<p>PRO_SHUTDOWN</p>
<p>.  </p>
<p>[SPMF92:0020] </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>15 </p>
<p>based on template version 2.0 </p>
<p><b>Class </b></p>
<p><b>Description </b></p>
<p>Killing </p>
<p>Terminating Tasks or Applications is not supported. </p>
<p>OS Hooks </p>
<p><b>&gt; </b></p>
<p>PreTaskHook</p>
<p> (only for debugging!)</p>
<p> </p>
<p><b>&gt; </b></p>
<p>PostTaskHook </p>
<p>(only for debugging!)</p>
<p> </p>
<p><b>&gt; </b></p>
<p>ISRHook </p>
<p><b>&gt; </b></p>
<p>PreAlarmHook </p>
<p>OS Application </p>
<p>specific Hooks </p>
<p><b>&gt; </b></p>
<p>StartupHook&lt;AppName&gt; </p>
<p><b>&gt; </b></p>
<p>ErrorHook&lt;AppName&gt; </p>
<p><b>&gt; </b></p>
<p>ShutdownHook&lt;AppName&gt; </p>
<p>Address Parameter </p>
<p>Check </p>
<p>In case API functions with output-parameters are called with illegal </p>
<p>address, they do not return with the error code </p>
<p>E_OS_ILLEGAL_ADDRESS as required by the AUTOSAR specification. </p>
<p>Instead the out parameter is written with the access rights of the caller, </p>
<p>which may lead to a memory protection violation in case the given pointer </p>
<p>is invalid.  </p>
<p>Stack optimization </p>
<p>Single stack model and stack sharing are not supported. </p>
<p>Internal Resources </p>
<p>Internal Resources are not supported. </p>
<p>Configuration </p>
<p>Aspects </p>
<p>The following hooks must always be enabled: </p>
<p><b>&gt; </b></p>
<p>StartupHook </p>
<p><b>&gt; </b></p>
<p>ErrorHook </p>
<p><b>&gt; </b></p>
<p>ShutdownHook </p>
<p><b>&gt; </b></p>
<p>ProtectionHook</p>
<p> </p>
<p>Only </p>
<p>SCALABILITYCLASS SC3</p>
<p> or </p>
<p>SC4</p>
<p> is supported. Memory protection </p>
<p>must be active. </p>
<p>STACKMONITORING</p>
<p> must be enabled. </p>
<p>OSInternalChecks</p>
<p> must be configured to </p>
<p>Additional</p>
<p>.</p>
<p> </p>
<p>ORTIVersion = 2.0</p>
<p> is not supported. </p>
<p>ErrorInfoLevel = Modulenames</p>
<p> is not supported.</p>
<p> </p>
<p>Table 2-2  </p>
<p>Functionality – Not provided </p>
<p> </p>
<p><b>2.5 </b></p>
<p><b>Safe State </b></p>
<p>The  safe  state  in  SafeContext  is  shutdown  (endless  loop  with  interrupts  disabled).  The </p>
<p>safe  state  is  entered  whenever  the  OS  detects  a  violation  of  its  safety  goal  or  even  an </p>
<p>attempt. </p>
<p>Before </p>
<p>the </p>
<p>safe </p>
<p>state </p>
<p>is </p>
<p>entered, </p>
<p>the </p>
<p>ShutdownHook</p>
<p> </p>
<p>is </p>
<p>called. </p>
<p>The </p>
<p>ShutdownHook</p>
<p> may contain user code which is necessary to reach the defined safe state </p>
<p>of the system. This might lead to a reset in combination with a watchdog.  </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>16 </p>
<p>based on template version 2.0 </p>
<p><b>3 </b></p>
<p><b>Overview of Requirements to the OS User </b></p>
<p>For  integration  of  the  SafeContext  into  a  particular  context,  the  user  has  the  following </p>
<p>requirements to be fulfilled. They can be seen as steps to integrate the SEooC in the ECU </p>
<p>without harming the assumed safety goal.  </p>
<p>The top level requirements are listed in the following table. They are considered in more </p>
<p>detail later. If all sub-requirements are checked, you can check the according top level </p>
<p>requirement too. </p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that all assumptions made by SafeContext are valid  </p>
<p>(see chapter “SafeContext Assumptions”) </p>
<p> </p>
<p>Check code integrity of the used OS sources </p>
<p>(see chapter “OS Source Checksum”) </p>
<p> </p>
<p>Add CRC into the configuration block after linkage </p>
<p>(see chapter “Patching the Configuration Block”) </p>
<p> </p>
<p>Follow SafeContext guidelines </p>
<p>(see chapter “SafeContext Guidelines”) </p>
<p> </p>
<p>Review the safety relevant configuration data </p>
<p>(see chapter “Configuration Block Review”) </p>
<p> </p>
<p>Qualify the generated OS code  </p>
<p>(see chapter “Generated OS Code”) </p>
<p> </p>
<p>Review your software </p>
<p>(see chapter “Review User Software”) </p>
<p> </p>
<p>Check specific requirements to the user </p>
<p>(see chapter “Hardware Specific Part”) </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>All requirements listed in this document must be checked and fulfilled by the user! </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>17 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p>Figure 3-1 </p>
<p>Strategy for safety configuration </p>
<p>OS Configuration </p>
<p>(OIL or ECUC) </p>
<p>OS Generator</p>
<p> </p>
<p>Generated OS </p>
<p>Sources</p>
<p> </p>
<p>Configuration in </p>
<p>XML</p>
<p> </p>
<p>Static OS </p>
<p>Sources</p>
<p> </p>
<p>Compiling + </p>
<p>Linking</p>
<p> </p>
<p> </p>
<p> </p>
<p>Application </p>
<p>Sources</p>
<p> </p>
<p>Executable</p>
<p> </p>
<p><b>ECU</b></p>
<p> </p>
<p>Patching the </p>
<p>Configuration Block</p>
<p> </p>
<p>Executable </p>
<p> </p>
<p>  </p>
<p>ConfigBlock </p>
<p>Intermediate </p>
<p>Format</p>
<p> </p>
<p>Read Back </p>
<p>ConfigBlock </p>
<p>OS Source </p>
<p>Checksum</p>
<p> </p>
<p>In Human </p>
<p>Readable </p>
<p>ConfigBlock</p>
<p> </p>
<p>Qualify generated </p>
<p>Sources</p>
<p> </p>
<p>(</p>
<p>MSSV</p>
<p>)</p>
<p> </p>
<p>Verify ConfigBlock</p>
<p> </p>
<p>User Review</p>
<p> </p>
<p>Review User </p>
<p>Software</p>
<p> </p>
<p>Flashing</p>
<p> </p>
<p>Read Back</p>
<p> </p>
<p>Hex File</p>
<p> </p>
<p>Hex Converter</p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>18 </p>
<p>based on template version 2.0 </p>
<p><b>4 </b></p>
<p><b>SafeContext Assumptions </b></p>
<p>All  assumptions  must  be  checked  to  be  true.  Assumptions  concerning  the  focus  of </p>
<p>SafeContext are  given  by  the  safety  goals and  related  safety  requirements  described  in </p>
<p>the safety case. Assumptions about the environment are described in this chapter. </p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p><i>Know the SafeContext concept </i></p>
<p>The system safety concept must not rely on OS functionality which is not part of the </p>
<p>SafeContext safety requirements. Only the safety requirements (see chapter “Safety </p>
<p>Requirements”) are assured by SafeContext. </p>
<p>[SPMF92:0075] </p>
<p> </p>
<p><i>Timing and Scheduling </i></p>
<p>If timing and scheduling is safety critical in your application, you have to supervise this </p>
<p>by an external tool like e.g. SafeWatchdog. </p>
<p>[SPMF92:0050] </p>
<p> </p>
<p><i>Know your memory configuration  </i></p>
<p>Setup of memory sections must be planned by the system designer. Whether or not </p>
<p>the planned setup is configured correctly must be verified by reading the configuration </p>
<p>back from the ECU and reviewing it against system design and hardware manuals. </p>
<p> </p>
<p><i>Know the OS specifications </i></p>
<p>The user shall read the OS specifications for OSEK OS and AUTOSAR OS. </p>
<p> </p>
<p><i>Know how to use the OS </i></p>
<p>The user shall read the OS manuals: </p>
<p><b>&gt; </b></p>
<p>General Technical Reference Manual </p>
<p><b>&gt; </b></p>
<p>Specific Technical Reference Manual </p>
<p>Versions are listed in the delivered safety case. </p>
<p> </p>
<p><i>Use only the delivered OS generator </i></p>
<p>The  user  shall  only  use  the  delivered  OS  generation  tool  for  generating  the  user </p>
<p>specific configuration. </p>
<p> </p>
<p><i>Correctness of processor  </i></p>
<p>The  processor  provides its functionality  with  sufficient  safety,  so that the OS  needs </p>
<p>not take care about potential hardware failure. </p>
<p>This might be assured by usage of a lockstep processor. </p>
<p> </p>
<p><i>Correctness of memory </i></p>
<p>The memory works with sufficient safety, so that the OS needs not to take care about </p>
<p>potential hardware failure. </p>
<p> </p>
<p><i>Correctness of MPU </i></p>
<p>The  MPU  provides  its  functionality  with  sufficient  safety,  so  that  the  OS  needs  not </p>
<p>take care about potential hardware failure. </p>
<p>The  OS  provides  an API  (</p>
<p>osCheckMPUAccess</p>
<p>)  which  can  be  used  by the  user to </p>
<p>check the MPU. </p>
<p> </p>
<p><i>Correctness of hardware manuals </i></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>19 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>The Hardware manuals and the compiler manuals are sufficiently reliable, so that the </p>
<p>OS  needs  not  take  care  about  potential  deviations  between  hardware  functionality </p>
<p>and its description in the manuals.  </p>
<p>Versions of the used hardware manuals are listed in the delivered safety case. </p>
<p>[SPMF92:0017] </p>
<p><i>Correctness of compiler tool chain </i></p>
<p>SafeContext assumes that the compiler, assembler and linker generate code with the </p>
<p>required safety level. </p>
<p> </p>
<p><i>Correctness of compiler version and options </i></p>
<p>The used compiler version and options are identical to them which are used during </p>
<p>development. </p>
<p>Used compiler version and options are listed in the delivered safety case. </p>
<p> </p>
<p><i>Code integrity </i></p>
<p>The source code and generated configuration of MICROSAR OS SafeContext is </p>
<p>compiled, linked and downloaded to the ECU correctly and not modified afterwards. </p>
<p>[SPMF92:0043] </p>
<p> </p>
<p><i>Context definition </i></p>
<p>The user shall not rely on registers, which are not part of the context of the OS. </p>
<p> The context definition is listed in chapter 4.1 </p>
<p> </p>
<p><i>Hardware handled by the OS shall not be manipulated by user code </i></p>
<p>User code shall not handle hardware which is handled by the OS. This may include: </p>
<p><b>&gt; </b></p>
<p>Interrupt Controller [SPMF92:0083] </p>
<p><b>&gt; </b></p>
<p>MPU [SPMF92:0085] </p>
<p><b>&gt; </b></p>
<p>Timer </p>
<p> </p>
<p><i>Don't manipulate short addressing base registers </i></p>
<p>Do not manipulate registers which are used by the compiler for relative addressing of </p>
<p>code or data. [SPMF92:0084] </p>
<p> </p>
<p>Table 4-1  </p>
<p>General SafeContext Assumptions </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>20 </p>
<p>based on template version 2.0 </p>
<p><b>4.1 </b></p>
<p><b>Context Definition </b></p>
<p>The context which is used by MICROSAR OS RH850 consists of the following registers: </p>
<p><b>FPU used </b></p>
<p><b>Registers </b></p>
<p><b>Size in Bytes </b></p>
<p><b>FPU not used </b></p>
<p><b>Registers </b></p>
<p><b>Size in Bytes </b></p>
<p>total size = 152 </p>
<p>R1 </p>
<p>4 </p>
<p>total size = 144 </p>
<p>R1 </p>
<p>4 </p>
<p>R2 </p>
<p>4 </p>
<p>R2 </p>
<p>4 </p>
<p> </p>
<p>R4 </p>
<p>R5 </p>
<p>… </p>
<p>R30 </p>
<p>R31 </p>
<p> </p>
<p> </p>
<p>28 * 4 = 112 </p>
<p> </p>
<p>R4 </p>
<p>R5 </p>
<p>… </p>
<p>R30 </p>
<p>R31 </p>
<p> </p>
<p>28 * 4 = 112 </p>
<p>EIPC </p>
<p>4 </p>
<p>EIPSW </p>
<p>4 </p>
<p>CTPC </p>
<p>4 </p>
<p>EIPC </p>
<p>4 </p>
<p>CTPSW </p>
<p>4 </p>
<p>EIPSW </p>
<p>4 </p>
<p>MPLA0 </p>
<p>4 </p>
<p>CTPC </p>
<p>4 </p>
<p>MPUA0 </p>
<p>4 </p>
<p>CTPSW </p>
<p>4 </p>
<p>FPSR </p>
<p>4 </p>
<p>MPLA0 </p>
<p>4 </p>
<p>FPEPC </p>
<p>4 </p>
<p>MPUA0 </p>
<p>4 </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Caution </b></p>
<p>FPU setting in OS configuration must match the used compiler FPU option! </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>21 </p>
<p>based on template version 2.0 </p>
<p><b>5 </b></p>
<p><b>OS Source Checksum </b></p>
<p>The OS is delivered as source code. To assure that source code files are not altered after </p>
<p>the testing and release a checksum is calculated. The user shall calculate the checksum to </p>
<p>verify the correctness of the source code he is using. [SPMF92:0042] </p>
<p>A checksum calculation program (CCodeSafe.exe) is provided to the user. It is called with </p>
<p>the following argument: </p>
<p> CCodeSafe.exe &lt;config.ini&gt; </p>
<p> </p>
<p>This tool calculates the CRC32 checksum over all files specified in file </p>
<p>&lt;config.ini&gt;</p>
<p>. </p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Use the delivered source files from Vector! Do not use changed copies in a productive </p>
<p>system! Also consider header include order of the compiler. </p>
<p> </p>
<p>The file </p>
<p>&lt;config.ini&gt;</p>
<p> shall contain the OS sources listed in the Safety Case. </p>
<p> </p>
<p>The calculated checksum returned by tool CCodeSafe.exe must be identical to the </p>
<p>checksum given in the Safety Case. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>22 </p>
<p>based on template version 2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>An example for a </p>
<p>&lt;config.ini&gt;</p>
<p> file: </p>
<p> </p>
<p> </p>
<p>..\..\implementation\atosappl.c </p>
<p>..\..\implementation\atostime.c </p>
<p>..\..\implementation\osek.c </p>
<p>..\..\implementation\osekalrm.c </p>
<p>..\..\implementation\osekasm.c </p>
<p>..\..\implementation\osekerr.c </p>
<p>..\..\implementation\osekevnt.c </p>
<p>..\..\implementation\osekrsrc.c </p>
<p>..\..\implementation\oseksched.c </p>
<p>..\..\implementation\osekstart.c </p>
<p>..\..\implementation\osektask.c </p>
<p>..\..\implementation\osektime.c </p>
<p>..\..\implementation\osOstmHiRes.c </p>
<p>..\..\implementation\osSysCall.c </p>
<p>..\..\implementation\Os.h </p>
<p>..\..\implementation\Os_Cfg.h </p>
<p>..\..\implementation\osDerivatives.h </p>
<p>..\..\implementation\osek.h </p>
<p>..\..\implementation\osekasm.h </p>
<p>..\..\implementation\osekasrt.h </p>
<p>..\..\implementation\osekcov.h </p>
<p>..\..\implementation\osekerr.h </p>
<p>..\..\implementation\osekext.h </p>
<p>..\..\implementation\oseksched.h </p>
<p>..\..\implementation\osINTC2.h </p>
<p>..\..\implementation\osRH850_F1L.h </p>
<p>..\..\implementation\testmac1.h </p>
<p>..\..\implementation\vrm.h </p>
<p>..\..\implementation\osSysCallTable.dld </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>23 </p>
<p>based on template version 2.0 </p>
<p><b>6 </b></p>
<p><b>Patching the Configuration Block </b></p>
<p>Configuration  information  which  is relevant  to  reach the  safety  goals  is  stored  in  a data </p>
<p>structure  called  the  configuration  block.  The  integrity  of  this  information  is  checked  in </p>
<p>StartOS</p>
<p> using a CRC16 checksum. </p>
<p>The CRC must be calculated after compiling and linking the application. There are two </p>
<p>programs provided to calculate and apply the CRC patch into the binary file: </p>
<p>ElfConverter.exe </p>
<p>For patching the CRC into an ELF file. </p>
<p>Creating an intermediate file for reading back the configuration </p>
<p>block is also possible with this tool. </p>
<p>ConfigBlockCRCPatch.exe </p>
<p>For patching the CRC into an Intel HEX or Motorola SREC file. </p>
<p> </p>
<p>The following steps are necessary to patch the configuration block: </p>
<p>1. </p>
<p>Compile and link the complete application project to build the executable  </p>
<p>2. </p>
<p>Run CRC patch tool on executable </p>
<p>3. </p>
<p>Write modified executable into ECU flash memory </p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that CRC is non-zero. If so, change user configuration version to avoid zero CRC. </p>
<p>[SPMF92:0071] </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>24 </p>
<p>based on template version 2.0 </p>
<p><b>6.1 </b></p>
<p><b>Using ElfConverter </b></p>
<p>The program ElfConverter.exe is called with the following parameters: </p>
<p><b>ElfConverter.exe &lt;Input-File&gt; &lt;Output-File&gt; --crc_patch </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p><b>Description </b></p>
<p><b>&lt;Input-File&gt;      </b></p>
<p>Input file with ELF-format which was built by the compiler tool chain </p>
<p><b>&lt;Output-File&gt; </b></p>
<p>Intermediate output file which is used by the tool ConfigViewer.exe for </p>
<p>reading back the configuration block. </p>
<p><b>--crc_patch </b></p>
<p>Patch CRC checksum into ELF-file </p>
<p><b>--help </b></p>
<p>Show help </p>
<p>Table 6-1  </p>
<p>ElfConverter Parameters </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Patching the CRC checksum into configuration block of ELF-file testappl.out: </p>
<p>ElfConverter.exe testappl.out testcfg.hex --patch_crc </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>6.2 </b></p>
<p><b>Using ConfigBlockCRCPatch </b></p>
<p>The tool ConfigBlockCRCPatch.exe is called with the following parameters: </p>
<p>ConfigBlockCRCPatch.exe &lt;Input-File&gt; &lt;Output-File&gt; &lt;Base-Address&gt; </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Read HEX-file project.hex and create file project2.hex with patched CRC checksum: </p>
<p>ConfigBlockCRCPatch.exe project.hex project2.hex 0x4000</p>
<p> </p>
<p>Read SREC-file project.mot and create file project2.mot with patched CRC checksum: </p>
<p>ConfigBlockCRCPatch.exe project.mot project2.mot 0x4000</p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p>The address of the configuration block must be taken via symbol _</p>
<p><i><b>osConfigBlock</b></i></p>
<p> from </p>
<p>the linker generated map file. [SPMF92:0016] </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>25 </p>
<p>based on template version 2.0 </p>
<p><b>7 </b></p>
<p><b>SafeContext Guidelines </b></p>
<p><b>7.1 </b></p>
<p><b>Configuration </b></p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p><i>Non-ASIL user code shall be part of Non-Trusted Applications </i></p>
<p>All non-ASIL user code must be executed by Non-Trusted Applications with no write </p>
<p>access  to  safety  relevant  data  (including  stacks)  and  no  read  or  write  access  to </p>
<p>safety relevant peripherals. [SPMF92:02.0034] </p>
<p> </p>
<p><i>ASIL user code shall not violate the SafeContext safety goals </i></p>
<p>All user code, which has access to safety relevant data (including stacks, and OS </p>
<p>data) or peripherals, must be implemented on ASIL level. This code shall never </p>
<p>violate the safety goals of SafeContext. [SPMF92:0011] </p>
<p>Code which typically has access to safety relevant data (depending on user </p>
<p>configuration): </p>
<p><b>&gt; </b></p>
<p>Trusted Functions [SPMF92:0080] [SPMF92:03.0008] </p>
<p><b>&gt; </b></p>
<p>Trusted Tasks </p>
<p><b>&gt; </b></p>
<p>Trusted ISRs </p>
<p><b>&gt; </b></p>
<p>System Hooks </p>
<p><b>&gt; </b></p>
<p>StartupHook [SPMF92:0040] [SPMF92:03.0007] </p>
<p><b>&gt; </b></p>
<p>ErrorHook [SPMF92:0012] [SPMF92:03.0006] </p>
<p><b>&gt; </b></p>
<p>ProtectionHook [SPMF92:0009] [SPMF92:03.0005] </p>
<p><b>&gt; </b></p>
<p>ShutdownHook [SPMF92:0013] [SPMF92:03.0009] </p>
<p><b>&gt; </b></p>
<p>Reset Handler / Startup Code [SPMF92:0005] [SPMF92:03.0001] </p>
<p><b>&gt; </b></p>
<p>Exception Handlers [SPMF92:0087] [SPMF92:03.0010] </p>
<p><b>&gt; </b></p>
<p>Category 1 ISRs [SPMF92:0054] [SPMF92:03.0004] [SPMF92:03.0010] </p>
<p> </p>
<p><i>Alignment of data sections </i></p>
<p>All data sections shall be linked with MPU alignment granularity (e.g. 32 bytes). See </p>
<p>the </p>
<p>controller’s </p>
<p>reference </p>
<p>manual </p>
<p>to </p>
<p>know </p>
<p>what </p>
<p>the </p>
<p>MPU </p>
<p>granularity </p>
<p>is. </p>
<p>[SPMF92:0065] [SPMF92:04.0005] </p>
<p> </p>
<p><i>Consider category 1 ISRs </i></p>
<p>Category 1 ISRs are completely transparent to the OS. The OS does not perform </p>
<p>stack switching for category 1 ISRs! Consider this during configuration of stack </p>
<p>sizes. [SPMF92:0086] </p>
<p> </p>
<p><i>NMIs shall be category 1 ISRs </i></p>
<p>Non-maskable Interrupts (NMI) shall be configured to be category 1 ISRs. </p>
<p>[SPMF92:0053] [SPMF92:03.0002] </p>
<p> </p>
<p><i>Link global safety data considering stack growing direction </i></p>
<p>Link global safety data (all OS data and at least ASIL relevant application data) so </p>
<p>that it cannot be corrupted by stack overflows (see Figure “Linking example” below </p>
<p>for an example). [SPMF92:0091] </p>
<p> </p>
<p><i>FPU </i></p>
<p><i>setting </i></p>
<p><i>in </i></p>
<p><i>OS </i></p>
<p><i>configuration </i></p>
<p><i>must </i></p>
<p><i>match </i></p>
<p><i>compiler </i></p>
<p><i>FPU </i></p>
<p><i>option. </i></p>
<p>[SPMF92:04.0019] </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>26 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that osdRH850_FPU is only defined in file tcb.h and in osek.h </p>
<p>If compiler option -fnone or -fsoft is used, then assure that in OS </p>
<p>configuration the attribute SupportFPU is set to FALSE and that in file tcb.h </p>
<p>the following line is generated: </p>
<p>#define osdRH850_FPU   0 </p>
<p>If compiler option -fsingle or -fhard is used, then assure that in OS </p>
<p>configuration the attribute SupportFPU is set to TRUE and that in file tcb.h </p>
<p>the following line is generated: </p>
<p> </p>
<p>#define osdRH850_FPU  1</p>
<p><i> </i></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>27 </p>
<p>based on template version 2.0 </p>
<p><b>7.2 </b></p>
<p><b>Linking Example for Memory Mapping </b></p>
<p>The memory mapping should look like following example: </p>
<p> </p>
<p>Figure 7-1 </p>
<p>Linking Example </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>28 </p>
<p>based on template version 2.0 </p>
<p><b>8 </b></p>
<p><b>Configuration Block Review </b></p>
<p>The configuration of MICROSAR OS SafeContext is generated into C-code. The generator </p>
<p>itself </p>
<p>has </p>
<p>not </p>
<p>been </p>
<p>developed </p>
<p>in </p>
<p>accordance </p>
<p>to </p>
<p>ASIL. </p>
<p>Therefore, </p>
<p>the </p>
<p>generated </p>
<p>configuration  information  needs  to  be  reviewed.  The  safety  relevant  configuration  is </p>
<p>generated </p>
<p>into </p>
<p>a </p>
<p>structure </p>
<p>called </p>
<p>configuration </p>
<p>block </p>
<p>(or </p>
<p>ConfigBlock). </p>
<p>This </p>
<p>chapter </p>
<p>describes  how  to  review  this  ConfigBlock. As  the  ConfigBlock  is simply  a  constant  data </p>
<p>structure in the flash memory of an ECU, humans will have difficulties to read it. Therefore, </p>
<p>the configuration viewer is able to transform the ECU internal representation into a human </p>
<p>readable  format.  The  process  of  reading  the  ConfigBlock  and  transforming  it  into  the </p>
<p>human readable format is described in the following subchapter. [SPMF92:0038] </p>
<p>The setup of the memory protecting hardware depends on the correct configuration of the </p>
<p>OS.  All  configuration  parameters,  which  are  necessary  to  ensure  the  safety  goal,  are </p>
<p>stored in a contiguous memory block (configuration block). The configuration block can be </p>
<p>located  to  a  fix  address  and  can  be  read  back  from  the  ECU,  e.g.  by  XCP  or  a  debug </p>
<p>interface. [SPMF92:0034]  </p>
<p>The configuration block is secured by a CRC16 checksum. The way how the configuration </p>
<p>block is read back does not need to be safe. The configuration block is translated into a </p>
<p>human readable format to allow a review against the intended configuration. </p>
<p><b>8.1 </b></p>
<p><b>How to Read Back the Configuration </b></p>
<p>The configuration is read back in two steps: </p>
<p>1. </p>
<p>Patch CRC checksum into executable file and create the intermediate file:  </p>
<p>a)  use ElfConverter.exe for CRC patch and intermediate file creation </p>
<p>b)  or use ConfigBlockCRCPatch.exe for CRC patch and use HexConverter.exe for </p>
<p>intermediate file creation </p>
<p>2. </p>
<p>Extract the configuration block from intermediate file into human readable output by </p>
<p>using the tool ConfigViewer.exe </p>
<p>The  configuration  block  format  is  platform  dependent.  Also  this </p>
<p>information  may  be </p>
<p>retrieved in different ways, e.g. as the HEX output of the linker or as an upload from the </p>
<p>ECU via a protocol like XCP. As this may result in various file formats a conversion into an </p>
<p>intermediate format is required. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>29 </p>
<p>based on template version 2.0 </p>
<p><b>8.1.1  Using ElfConverter </b></p>
<p>The tool ElfConverter.exe is able to patch CRC into ELF-file and create the intermediate </p>
<p>file for reading back the configuration block. It is called with the following parameters: </p>
<p><b>ElfConverter.exe &lt;Input-File&gt; &lt;Output-File&gt; --crc_patch </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Parameter </b></p>
<p><b>Description </b></p>
<p><b>&lt;Input-File&gt;      </b></p>
<p>Input file with ELF-format which was built by the compiler tool chain </p>
<p><b>&lt;Output-File&gt; </b></p>
<p>Intermediate output file which is used by the tool ConfigViewer.exe for </p>
<p>reading back the configuration block. </p>
<p><b>--crc_patch </b></p>
<p>Patch CRC checksum into ELF-file </p>
<p><b>--help </b></p>
<p>Show help </p>
<p>Table 8-1  </p>
<p>ElfConverter Parameters </p>
<p> </p>
<p><b>8.1.2  Using HexConverter </b></p>
<p>The tool HexConverter.exe creates the intermediate file for reading back the configuration </p>
<p>block. It must be used after the CRC is patched via tool ConfigBlockCRCPatch.exe. Tool </p>
<p>HexConverter.exe is called with the following parameters: </p>
<p><b>HexConverter.exe –i &lt;Input-File&gt; -o &lt;Output-File&gt; -b &lt;Address&gt; -s &lt;Size&gt; </b></p>
<p>All parameters are mandatory. </p>
<p><b>Parameter </b></p>
<p><b>Value </b></p>
<p><b>Description </b></p>
<p><b>-i </b></p>
<p>Input File Path and Name </p>
<p>File which was created by ConfigBlockCRCPatch.exe </p>
<p><b>-o </b></p>
<p>Output File Path and </p>
<p>Name </p>
<p>Intermediate output file which is used by the tool </p>
<p>ConfigViewer.exe for reading back the configuration </p>
<p>block. </p>
<p><b>-b </b></p>
<p>Base Address of data </p>
<p>structure _osConfigBlock  </p>
<p>(see linker map file) </p>
<p>Base address of the configuration block as defined in the </p>
<p>linker map file. </p>
<p>It is the address of the symbol ‘osConfigBlock’. </p>
<p>Value has to be given as hexadecimal (e.g. 0x008000). </p>
<p><b>-s </b></p>
<p>0xFFFF </p>
<p>This value must be at least the size of the configuration </p>
<p>block in byte. Bigger values are also allowed. </p>
<p>E.g. this value can be set to 0xFFFF </p>
<p>Table 8-2  </p>
<p>HexConverter parameters </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>30 </p>
<p>based on template version 2.0 </p>
<p><b>8.1.3  Using ConfigViewer </b></p>
<p>The tool ConfigViewer.exe reads the intermediate file and creates a human readable file. </p>
<p>The </p>
<p>intermediate </p>
<p>input </p>
<p>file </p>
<p>must </p>
<p>be </p>
<p>generated </p>
<p>via </p>
<p>tool </p>
<p>ElfConverter.exe </p>
<p>or </p>
<p>HexConverter.exe. ConfigViewer.exe is called with the following parameters: </p>
<p><b>ConfigViewer –i &lt;Input-File&gt; -o &lt;Output-File&gt; -x &lt;XML-File&gt; </b></p>
<p><b>Parameter </b></p>
<p><b>Value </b></p>
<p><b>Description </b></p>
<p><b>-i </b></p>
<p>Input File Path &amp; Name </p>
<p>Intermedia input file which was created by </p>
<p>ElfConverter.exe or HexConverter.exe </p>
<p><b>-o </b></p>
<p>Output File Path &amp; Name </p>
<p>Human readable configuration output file </p>
<p><b>-x </b></p>
<p>XML-ConfigFile </p>
<p>optional: XML-file which was generated by the OS </p>
<p>generator with additional description of the OS </p>
<p>configuration </p>
<p>Table 8-3  </p>
<p>ConfigViewer Parameters </p>
<p>ConfigViewer.exe  expects  the  intermediate  file  format  to  contain  nothing  else  than  the  </p>
<p>configuration block with patched CRC checksum. </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>31 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p><b>8.2 </b></p>
<p><b>Configuration Block Head </b></p>
<p>The configuration block head contains information to identify the configuration block.  </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>The configuration block head must look like: </p>
<p> </p>
<p>================================================== </p>
<p>Start of Config Block                   0x00004000 </p>
<p>Length                                  636        </p>
<p>CRC                                     0x14e9     </p>
<p>Config Block Format Version             03.00      </p>
<p>MICROSAR OS RH850  SafeContext Version  01.06      </p>
<p>User Config Version                     1          </p>
<p>==================================================</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed start address, length and CRC is correct and matches the linker </p>
<p>map file of symbol osConfigBlock. </p>
<p> </p>
<p>Check that the listed configuration block format is 03.00 </p>
<p> </p>
<p>Check  that  the  listed  version  of  MICROSAR  OS  RH850  SafeContext  matches  the  </p>
<p>delivered OS version. </p>
<p> </p>
<p>If you are using the user configuration version, check that the listed one matches the  </p>
<p>configured value. [SPMF92:0045] </p>
<p> </p>
<p>The names printed by the ConfigViewer come from an unsafe source. For this reason </p>
<p>check that object IDs and object Names have the same mapping in all configuration </p>
<p>block sub-containers. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>32 </p>
<p>based on template version 2.0 </p>
<p><b>8.3 </b></p>
<p><b>General Information </b></p>
<p>The configuration viewer generates the general information as followed [SPMF92:0063]. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>The container “General Information” must look like: </p>
<p> </p>
<p>0. General Information </p>
<p>------------------------------------------------------- </p>
<p>Property                          Value        Checked? </p>
<p>------------------------------------------------------- </p>
<p>Stack Usage Measurement           Yes            [ ]    </p>
<p>Number of Tasks                   11             [ ]    </p>
<p>Number of Cat1 ISRs               0              [ ]    </p>
<p>Number of Cat2 ISRs               3              [ ]    </p>
<p>Number of Trusted Functions       1              [ ]    </p>
<p>Number of Non-Trusted Functions   0              [ ]    </p>
<p>Number of Applications            3              [ ]    </p>
<p>Number of Peripheral Regions      0              [ ]    </p>
<p>Number of Alarms                  2              [ ]    </p>
<p>Number of all Resources           1              [ ]    </p>
<p>Number of CPU Cores               1              [ ]    </p>
<p>Number of Counters                2              [ ]    </p>
<p>Number of Processes               14             [ ]    </p>
<p>Number of ScheduleTables          1              [ ]    </p>
<p>Number of Spinlocks               0              [ ]    </p>
<p>Number of MPU Regions             4              [ ]    </p>
<p>Number of Dynamic MPU Regions     0              [ ]    </p>
<p>Number of Static MPU Regions      1              [ ]    </p>
<p>System Stack Start-Address        0xfedf0720     [ ]    </p>
<p>System Stack End-Address          0xfedf08b0     [ ]    </p>
<p>------------------------------------------------------- </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>To minimize variants in code, the OS generator introduces dummies for each OS object </p>
<p>type. These dummies can be identified by the prefix </p>
<p>osSystem</p>
<p> and are handled the </p>
<p>same way like other OS objects. None of these objects are active at runtime. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>33 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed number of OS objects matches the OS configuration. (Consider </p>
<p>that dummy OS objects are generated, to minimize variants in the OS code.) </p>
<p> </p>
<p>Check  number  of  listed  OS  objects  matches  the  elements  in  the  following  sub </p>
<p>containers. [SPMF92:0074] </p>
<p> </p>
<p>Check the number of MPU regions which are provided by the used CPU derivative. </p>
<p> </p>
<p>Check the number of dynamic MPU regions which must be same as the number of </p>
<p>MPU regions configured in the application with most dynamic MPU regions. </p>
<p> </p>
<p>Check the number of static MPU regions configured for the OS. </p>
<p> </p>
<p>Check the stack MPU values lower address matches the corresponding stack start </p>
<p>address </p>
<p> </p>
<p>Compare the system stack start address in the configuration viewer output against </p>
<p>the label  <i>_osSystemStack_&lt;CoreID&gt;_StartAddr </i>in the linker map-file. </p>
<p> </p>
<p>Compare the system stack end address in the configuration viewer output against </p>
<p>the label <i>_osSystemStack_&lt;CoreID&gt;_EndAddr </i>in the linker map-file. </p>
<p> </p>
<p>Check that both labels are 4 Byte aligned [SPMF92:04.0002]. This prevents that any </p>
<p>data of other sections is accessible by the same MPU region. </p>
<p> </p>
<p>Check that only the array variable <i>osSystemStack&lt;CoreID&gt;  </i>is located between the </p>
<p>labels described above. </p>
<p> </p>
<p>Check the difference between the system stack start- and end-address against the </p>
<p>designed (and therefore also configured) system stack size. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>34 </p>
<p>based on template version 2.0 </p>
<p><b>8.4 </b></p>
<p><b>Task Start Address </b></p>
<p>Container “Task Start Address” contains the start addresses of all task functions. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>The container “Task Start Address” must look like: </p>
<p> </p>
<p>1. Task Start Address: </p>
<p>-------------------------------------------------- </p>
<p>Task-ID Task-Name              Value      Checked? </p>
<p>-------------------------------------------------- </p>
<p>0       (osSystemExtendedTask) 0x00007cea   [ ]    </p>
<p>1       (Task2)                0x0000553a   [ ]    </p>
<p>2       (Task1)                0x00005508   [ ]    </p>
<p>3       (osSystemBasicTask)    0x00007ce8   [ ]    </p>
<p>-------------------------------------------------- </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed Task start addresses match to the function start address called </p>
<p><i><b>&lt;Task-Name&gt;func </b></i></p>
<p>(see linker map file). [SPMF92:02.0025] </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>35 </p>
<p>based on template version 2.0 </p>
<p><b>8.5 </b></p>
<p><b>Task Pre-emptive Configuration </b></p>
<p>Container  “Task  Pre-emptive Attribute  Setting”  contains  information  about  which  task  is </p>
<p>full-pre-emptive or non-pre-emptive. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Task Pre-emptive Attribute Setting&quot; must look like: </p>
<p> </p>
<p>2. Task Pre-emptive Attribute Setting: </p>
<p>-------------------------------------------------------- </p>
<p>Task-ID Task-Name              Value            Checked? </p>
<p>-------------------------------------------------------- </p>
<p>0       (osSystemExtendedTask) full pre-emptive   [ ]    </p>
<p>1       (Task2)                full pre-emptive   [ ]    </p>
<p>2       (Task1)                full pre-emptive   [ ]    </p>
<p>3       (osSystemBasicTask)    non pre-emptive    [ ]    </p>
<p>-------------------------------------------------------- </p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check </p>
<p>that </p>
<p>the </p>
<p>listed </p>
<p>task </p>
<p>pre-emptive </p>
<p>attribute </p>
<p>settings </p>
<p>matches </p>
<p>the </p>
<p>OS </p>
<p>configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>36 </p>
<p>based on template version 2.0 </p>
<p><b>8.6 </b></p>
<p><b>Task Trusted Configuration </b></p>
<p>Container &quot;Task Trusted Attribute Setting” contains information about which task is trusted </p>
<p>or non-trusted. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Task Trusted Attribute Setting” must look like: </p>
<p> </p>
<p>3. Task Trusted Attribute Setting: </p>
<p>--------------------------------------------------- </p>
<p>Task-ID Task-Name              Value       Checked? </p>
<p>--------------------------------------------------- </p>
<p>0       (osSystemExtendedTask) trusted       [ ]    </p>
<p>1       (Task2)                non-trusted   [ ]    </p>
<p>2       (Task1)                non-trusted   [ ]    </p>
<p>3       (osSystemBasicTask)    trusted       [ ]    </p>
<p>---------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the trusted attribute setting of each task fits to the trusted attribute setting </p>
<p>of the owner application [SPMF92:0061]. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>37 </p>
<p>based on template version 2.0 </p>
<p><b>8.7 </b></p>
<p><b>Task Stack Addresses </b></p>
<p>Container “Task Stack Lower Boundary Address” contains start address of all task stacks. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Task Stack Lower Boundary Address” must look like: </p>
<p> </p>
<p>4. Task Stack Lower Boundary Address: </p>
<p>-------------------------------------------------- </p>
<p>Task-ID Task-Name              Value      Checked? </p>
<p>-------------------------------------------------- </p>
<p>0       (osSystemExtendedTask) 0xfedf08b0   [ ]    </p>
<p>1       (Task2)                0xfedf0590   [ ]    </p>
<p>2       (Task1)                0xfedf0720   [ ]    </p>
<p>3       (osSystemBasicTask)    0xfedf08c0   [ ]    </p>
<p>--------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p>Container “Task Stack Upper Boundary Address” contains end address of all tasks stacks. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Task Stack Upper Boundary Address” must look like: </p>
<p> </p>
<p>5. Task Stack Upper Boundary Address: </p>
<p>-------------------------------------------------- </p>
<p>Task-ID Task-Name              Value      Checked? </p>
<p>-------------------------------------------------- </p>
<p>0       (osSystemExtendedTask) 0xfedf08c0   [ ]    </p>
<p>1       (Task2)                0xfedf0720   [ ]    </p>
<p>2       (Task1)                0xfedf08b0   [ ]    </p>
<p>3       (osSystemBasicTask)    0xfedf08d0   [ ]    </p>
<p>--------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the difference between stack start and stack end address fits to the </p>
<p>configured size of each task stack. </p>
<p> </p>
<p>Check that the stacks do not overlap [SPMF92:0056]. Start address of stack on higher </p>
<p>address must be &gt;= end address of stack on lower address. </p>
<p> </p>
<p>Compare address value of each stack with the address given in the linker map file. </p>
<p> </p>
<p>Check that all task stack sizes are a multiple of 4 Bytes [SPMF92:04.0008]. This </p>
<p>prevents that any data of another section is accessible in the same MPU region. </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>38 </p>
<p>based on template version 2.0 </p>
<p><b>8.8 </b></p>
<p><b>Task to Application Mapping </b></p>
<p>Container “Task to Application Mapping” contains the assignment of tasks to applications. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Task to Application Mapping” must look like: </p>
<p> </p>
<p>6. Task to Application Mapping: </p>
<p>-------------------------------------------------------------------------- </p>
<p>Task-ID Task-Name              Appl-ID Appl-Name                  Checked? </p>
<p>-------------------------------------------------------------------------- </p>
<p>0       (osSystemExtendedTask) 3       (osSystemApplicationCore0)   [ ]    </p>
<p>1       (Task2)                0       (ApplNonTrust)               [ ]    </p>
<p>2       (Task1)                0       (ApplNonTrust)               [ ]    </p>
<p>3       (osSystemBasicTask)    3       (osSystemApplicationCore0)   [ ]    </p>
<p>--------------------------------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>The configuration of each application contains a list of the tasks which belong to this  </p>
<p>application. Check for each of the named applications that it owns exactly those tasks </p>
<p>listed in the configuration viewer output. [SPMF92:0062] </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>39 </p>
<p>based on template version 2.0 </p>
<p><b>8.9 </b></p>
<p><b>Category 2 ISR Trusted Configuration </b></p>
<p>Container “Category 2 ISR Trusted Attribute Setting” contains information about which  </p>
<p>category 2 ISR is trusted or non-trusted. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container  “Category 2 ISR Trusted Attribute Setting” must look like: </p>
<p> </p>
<p>7. Category 2 ISR Trusted Attribute Setting: </p>
<p>-------------------------------------------- </p>
<p>ISR-ID ISR-Name             Value   Checked? </p>
<p>-------------------------------------------- </p>
<p>0      (ISR1)               trusted   [ ]    </p>
<p>1      (osOstmInterrupt_c0) trusted   [ ]    </p>
<p>2      (osSystemCat2ISR)    trusted   [ ]    </p>
<p>--------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check  that  the  trusted  attribute  setting  of  each  category  2  ISR  fits  to  the  trusted </p>
<p>attribute setting of the owner application. </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>The trusted attribute setting of the system timer ISR <i>osOstmInterrupt_c&lt;CoreID&gt;  </i></p>
<p>cannot be configured because it is always a trusted ISR. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>40 </p>
<p>based on template version 2.0 </p>
<p><b>8.10 </b></p>
<p><b>Category 2 ISR to Application Mapping </b></p>
<p>Container “Category 2 ISR to Application Mapping” contains the assignment of category 2 </p>
<p>ISR functions to applications. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Category 2 ISR to Application Mapping ” must look like: </p>
<p> </p>
<p>8. Category 2 ISR to Application Mapping: </p>
<p>----------------------------------------------------------------------- </p>
<p>ISR-ID ISR-Name             Appl-ID Appl-Name                  Checked? </p>
<p>----------------------------------------------------------------------- </p>
<p>0      (ISR1)               1       (abcAppl)                    [ ]    </p>
<p>1      (osOstmInterrupt_c0) 2       (osSystemApplicationCore0)   [ ]    </p>
<p>2      (osSystemCat2ISR)    2       (osSystemApplicationCore0)   [ ]    </p>
<p>----------------------------------------------------------------------- </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>The  configuration  of  each  application  contains  a  list  of  ISRs  which  belong  to  this  </p>
<p>application. Check for each of the named applications that it owns exactly those ISRs </p>
<p>which are listed in the configuration viewer output [SPMF92:02.0028]. </p>
<p> </p>
<p>Check that category 1 ISRs are not listed in the configuration block [SPMF92:0055]. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>41 </p>
<p>based on template version 2.0 </p>
<p><b>8.11 </b></p>
<p><b>Application Trusted Configuration </b></p>
<p>Container “Application Trusted Attribute Setting” contains information about which </p>
<p>application is trusted or non-trusted. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Application Trusted Attribute Setting” must look like: </p>
<p> </p>
<p>9. Application Trusted Attribute Setting: </p>
<p>---------------------------------------------------------- </p>
<p>Application-ID Application-Name           Value   Checked? </p>
<p>---------------------------------------------------------- </p>
<p>0              (ApplStartVectCore0)       trusted   [ ]    </p>
<p>1              (abcAppl)                  trusted   [ ]    </p>
<p>2              (osSystemApplicationCore0) trusted   [ ]    </p>
<p>----------------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check  that  the  trusted  attribute  of  the  listed  applications  matches  to  the  OS </p>
<p>configuration. [SPMF92:02.0027] </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>42 </p>
<p>based on template version 2.0 </p>
<p><b>8.12 </b></p>
<p><b>Trusted Functions Configuration </b></p>
<p>Container “Trusted Functions Start address and Application Mapping” contains the </p>
<p>configuration of trusted functions. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Trusted Functions Start Address and Application Mapping” must look like: </p>
<p> </p>
<p>10. Trusted Functions Start Address and Application Mapping: </p>
<p>----------------------------------------------------------------------------------------------- </p>
<p>Function-ID Function-Name             Start-Address Appl-ID Appl-Name                  Checked? </p>
<p>----------------------------------------------------------------------------------------------- </p>
<p>0           (TF1)                     0x0000560c    4       (TrustedApplB)               [ ]    </p>
<p>1           (TF2)                     0x0000564c    4       (TrustedApplB)               [ ]    </p>
<p>2           (TF3)                     0x000056f0    4       (TrustedApplB)               [ ]    </p>
<p>3           (osSystemTrustedFunction) 0x00007ed2    5       (osSystemApplicationCore0)   [ ]    </p>
<p>4           (step)                    0x0000d3d6    3       (TraceAppl)                  [ ]    </p>
<p>----------------------------------------------------------------------------------------------- </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check  that  the  listed  Trusted  Function  IDs  match  to  the  corresponding  defines  of </p>
<p>function names generated in tcb.h. [SPMF92:0048]   </p>
<p> </p>
<p>Check that the listed Trusted Function start addresses matches the Trusted Function </p>
<p>start  addresses  called </p>
<p><i><b>TRUSTED_&lt;TrustedFunctionName&gt; </b></i></p>
<p>(see  linker  map  file). </p>
<p>[SPMF92:0057] </p>
<p> </p>
<p>The  configuration  of  each  application  contains  a  list  of  the  trusted  functions  which </p>
<p>belong  to  this  application.  Check  for  each  of  the  named  applications  that  it  owns </p>
<p>exactly those trusted functions listed in the configuration viewer output. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>43 </p>
<p>based on template version 2.0 </p>
<p><b>8.13 </b></p>
<p><b>Non-Trusted Functions Configuration </b></p>
<p>Container “Non-Trusted Functions Start Address and Application Mapping” contains the </p>
<p>configuration of non-trusted functions. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Non-Trusted Functions Start Address and Application Mapping” must look like: </p>
<p> </p>
<p>11. Non-Trusted Functions Start Address and Application Mapping: </p>
<p>-------------------------------------------------------------------------- </p>
<p>Function-ID Function-Name Start-Address Appl-ID Appl-Name         Checked? </p>
<p>-------------------------------------------------------------------------- </p>
<p>0           (NTFunc1)     0x000054dc    2       (NonTrustedApplA)   [ ]    </p>
<p> </p>
<p>1           (NTFunc2)     0x000068e6    3       (NonTrustedApplB)   [ ]    </p>
<p>--------------------------------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed Non-Trusted Function start addresses matches the address of </p>
<p>symbols </p>
<p><i><b>NONTRUSTED_&lt;NonTrustedFunctionName&gt; </b></i></p>
<p>(see linker map file). </p>
<p>[SPMF92:02.0024] </p>
<p> </p>
<p>Check that the listed Non-Trusted Function to application assignment matches the OS </p>
<p>configuration. [SPMF92:02.0029] </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>44 </p>
<p>based on template version 2.0 </p>
<p><b>8.14 </b></p>
<p><b>Category 2 ISR Start Addresses </b></p>
<p>Container “Category 2 ISR Function Start Address” contains the start address of all </p>
<p>category 2 ISR functions. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Category 2 ISR Function Start Address” must look like: </p>
<p> </p>
<p>12. Category 2 ISR Function Start Address: </p>
<p>-------------------------------------------- </p>
<p>ISR-ID ISR-Name          Value      Checked? </p>
<p>-------------------------------------------- </p>
<p>0      (ISRNonTrust)     0x000054b6   [ ]    </p>
<p>1      (osSystemCat2ISR) 0x00007cac   [ ]    </p>
<p>--------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed category 2 ISR start addresses match to the function start </p>
<p>address called <i>_</i></p>
<p><i><b>&lt;ISR-Name&gt;func </b></i></p>
<p>(see linker map file). [SPMF92:02.0026] </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>In case the ISR has a configured </p>
<p>SpecialFunctionName</p>
<p>, search for the symbol </p>
<p>_&lt;SpecialFunctionName&gt;func</p>
<p> instead, which is located at the address, shown in </p>
<p>the configuration block. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>45 </p>
<p>based on template version 2.0 </p>
<p><b>8.15 </b></p>
<p><b>Category 2 ISR Nesting Configuration </b></p>
<p>Container “Category 2 ISR Nested Attribute Setting” contains information about which </p>
<p>category 2 ISR is nestable or non-nestable. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Category 2 ISR Nested Attribute Setting” must look like: </p>
<p> </p>
<p>13. Category 2 ISR nested attribute setting: </p>
<p>----------------------------------------------- </p>
<p>ISR-ID ISR-Name             Value      Checked?  </p>
<p>----------------------------------------------- </p>
<p>0      (TestTimer1)         nested       [ ]     </p>
<p>1      (osOstmInterrupt_c0) nested       [ ]     </p>
<p>2      (osSystemCat2ISR)    non-nested   [ ]     </p>
<p>-----------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check  that  the  listed  category  2  ISR  nested  attributes  match the OS  configuration. </p>
<p>[SPMF92:02.0031] </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>46 </p>
<p>based on template version 2.0 </p>
<p><b>8.16 </b></p>
<p><b>Process to Core Mapping </b></p>
<p>Container “Process to Core Mapping” contains mapping information of all processes to the </p>
<p>available cores. The term “process” means the superset of Tasks and ISRs.  </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Process to Core Mapping” must look like: </p>
<p> </p>
<p>14. Process to Core Mapping: </p>
<p>------------------------------------------------------------ </p>
<p>Process-ID Process-Name           Core-ID Core-Name Checked? </p>
<p>------------------------------------------------------------ </p>
<p>0          (osSystemExtendedTask) 0       (Core0)     [ ]    </p>
<p>1          (TaskTrust)            0       (Core0)     [ ]    </p>
<p>2          (osSystemBasicTask)    0       (Core0)     [ ]    </p>
<p>3          (ISRNonTrust)          0       (Core0)     [ ]    </p>
<p>4          (osSystemCat2ISR)      0       (Core0)     [ ]    </p>
<p>------------------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed Task and ISR to core assignment matches the OS configuration. </p>
<p>In single core systems the core ID should be identical in all “to core” sub-containers. </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>In single core systems the core ID should be identical in all “to-core” sub-containers. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>47 </p>
<p>based on template version 2.0 </p>
<p><b>8.17 </b></p>
<p><b>Alarms to Core Mapping </b></p>
<p>Container “Alarms to Core Mapping” contains the mapping of Alarms to processor cores. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Alarms to Core Mapping” must look like: </p>
<p> </p>
<p>15. Alarms to Core Mapping: </p>
<p>--------------------------------------------------------- </p>
<p>Alarm-ID Alarm-Name            Core-ID Core-Name Checked?  </p>
<p>--------------------------------------------------------- </p>
<p>0        (Alarm0)              0       (Core0)     [ ]     </p>
<p>1        (Alarm1)              0       (Core0)     [ ]     </p>
<p>2        (Alarm2)              0       (Core0)     [ ]     </p>
<p>3        (osSystemAlarm)       0       (Core0)     [ ]     </p>
<p>---------------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed Alarms to core assignment matches the OS configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>48 </p>
<p>based on template version 2.0 </p>
<p><b>8.18 </b></p>
<p><b>Resources to Core Mapping </b></p>
<p>Container “Resources to Core Mapping” contains the mapping of Resources to processor </p>
<p>cores. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Resources to Core Mapping” must look like: </p>
<p> </p>
<p>16. Resources to Core Mapping: </p>
<p>--------------------------------------------------------------- </p>
<p>Resource-ID Resource-Name      Core-ID Core-Name       Checked?  </p>
<p>--------------------------------------------------------------- </p>
<p>0           (RES_SCHEDULER)    0       (Core0)           [ ]     </p>
<p>1           (osSystemResource) 0       (Core0)           [ ]     </p>
<p>2           (resourceConf1)    0       (Core0)           [ ]   </p>
<p>---------------------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed Resources to core assignment matches the Resource usage. </p>
<p>All Tasks and ISRs, which use a Resource, shall belong to OS Applications, which </p>
<p>belong to the listed core. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>49 </p>
<p>based on template version 2.0 </p>
<p><b>8.19 </b></p>
<p><b>Counters to Core Mapping </b></p>
<p>Container “Counters to Core Mapping” contains the mapping of Counters to processor </p>
<p>cores. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Counters to Core Mapping” must look like: </p>
<p> </p>
<p>17. Counters to Core Mapping: </p>
<p>--------------------------------------------------------- </p>
<p>Counter-ID Counter-Name        Core-ID Core-Name Checked?  </p>
<p>--------------------------------------------------------- </p>
<p>0          (AddCount)          0       (Core0)     [ ]     </p>
<p>1          (osSystemSWCounter) 0       (Core0)     [ ]     </p>
<p>2          (SystemTimer)       0       (Core0)     [ ]   </p>
<p>---------------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed Counter to core assignment matches to the OS configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>50 </p>
<p>based on template version 2.0 </p>
<p><b>8.20 </b></p>
<p><b>Schedule Tables to Core Mapping </b></p>
<p>Container “Schedule Tables to Core Mapping” contains the mapping of Schedule Tables to </p>
<p>processor cores. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Schedule Tables to Core Mapping” must look like: </p>
<p> </p>
<p>18. Schedule Tables to Core Mapping: </p>
<p>-------------------------------------------------------------------- </p>
<p>ScheduleTable-ID ScheduleTable-Name Core-ID Core-Name       Checked?  </p>
<p>-------------------------------------------------------------------- </p>
<p>0                (ScT1)             0       (Core0)           [ ]     </p>
<p>1                (ScT2)             0       (Core0)           [ ]     </p>
<p>2                (ScT3)             0       (Core0)           [ ]     </p>
<p>3                (ScT4)             0       (Core0)           [ ]     </p>
<p>4                (osSystemSchT)     0       (Core0)           [ ]     </p>
<p>--------------------------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check </p>
<p>that </p>
<p>the </p>
<p>listed </p>
<p>Schedule </p>
<p>Tables </p>
<p>to </p>
<p>core </p>
<p>assignment </p>
<p>matches </p>
<p>the </p>
<p>OS  </p>
<p>configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>51 </p>
<p>based on template version 2.0 </p>
<p><b>8.21 </b></p>
<p><b>Application to Core Mapping </b></p>
<p>Container “Applications to Core Mapping” contains the mapping of applications to </p>
<p>processor cores. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Applications to Core Mapping” must look like: </p>
<p> </p>
<p>19. Applications to Core Mapping: </p>
<p>-------------------------------------------------------------------- </p>
<p>Application-ID Application-Name           Core-ID Core-Name Checked?  </p>
<p>-------------------------------------------------------------------- </p>
<p>0              (allAppl)                  0       (Core0)     [ ]     </p>
<p>1              (osSystemApplicationCore0) 0       (Core0)     [ ]     </p>
<p>--------------------------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed Applications to core assignment matches the OS configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>52 </p>
<p>based on template version 2.0 </p>
<p><b>8.22 </b></p>
<p><b>Trusted Functions to Core Mapping </b></p>
<p>Container “Trusted Functions to Core Mapping” contains the mapping of Trusted Functions </p>
<p>to processor cores. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Trusted Functions to Core Mapping” must look like: </p>
<p> </p>
<p>20. Trusted Functions to Core Mapping: </p>
<p>------------------------------------------------------------------ </p>
<p>Function-ID Function-Name               Core-ID Core-Name Checked?  </p>
<p>------------------------------------------------------------------ </p>
<p>0           (TF1)                       0       (Core0)     [ ]     </p>
<p>1           (TriggerISR1)               0       (Core0)     [ ]     </p>
<p>2           (osSystemTrustedFunction)   0       (Core0)     [ ]     </p>
<p>------------------------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check  that  the </p>
<p>listed  Trusted </p>
<p>Functions  to </p>
<p>core </p>
<p>assignment </p>
<p>matches  the </p>
<p>OS </p>
<p>configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>53 </p>
<p>based on template version 2.0 </p>
<p><b>8.23 </b></p>
<p><b>Non-Trusted Functions to Core Mapping </b></p>
<p>Container “Non-trusted Functions to Core Mapping” contains the mapping of Non-Trusted </p>
<p>Functions to processor cores. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Non-Trusted Functions to Core Mapping” must look like: </p>
<p> </p>
<p>21. Non-Trusted Functions to Core Mapping: </p>
<p>------------------------------------------------------ </p>
<p>Function-ID Function-Name Core-ID Core-Name   Checked?  </p>
<p>------------------------------------------------------ </p>
<p>0          (NTF1)         0       (Core0)      [ ]     </p>
<p>1          (NTF2)         0       (Core0)      [ ]     </p>
<p>2          (NTF3)         0       (Core0)      [ ]    </p>
<p>------------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check  that  the  listed  Non-Trusted  Functions  to  core  assignment  matches  the  OS </p>
<p>configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>54 </p>
<p>based on template version 2.0 </p>
<p><b>8.24 </b></p>
<p><b>Core Control Block Address </b></p>
<p>Container “Core Control Block Start Address” contains the start address of the core </p>
<p>specific control block data structure. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Core Control Block Start Address&quot; must look like: </p>
<p> </p>
<p>22. Core Control Block Start Address: </p>
<p>------------------------------------------------ </p>
<p>Core-ID Core-Name Control-Block-Address Checked? </p>
<p>------------------------------------------------ </p>
<p>0       (Core0)   0xfedf135c              [ ]    </p>
<p>------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check  that  the  listed  Control  Block  Start Address  matches  to  the  start  address  of </p>
<p>RAM data structure called </p>
<p><b>osCtrlVarsCore0</b></p>
<p> (see linker map file). </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>55 </p>
<p>based on template version 2.0 </p>
<p><b>8.25 </b></p>
<p><b>Peripheral Regions Configuration </b></p>
<p>Container “Peripheral Regions Configuration” contains information about peripheral </p>
<p>regions configuration. [SPMF92:02.0030] </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Peripheral Regions Configuration” must look like: </p>
<p> </p>
<p>23. Peripheral Regions Configuration: </p>
<p>------------------------------------------------------------------------------------- </p>
<p>Region-ID Region-Name Start-Addr End-Addr    Application-Name Application-ID Checked?  </p>
<p>------------------------------------------------------------------------------------- </p>
<p>0         (IORegion0) 0xff030000 0xff03ffff (AppNT1)          0               [ ]     </p>
<p>1         (IORegion1) 0xff080000 0xff080fff (AppNT1)          0               [ ]        </p>
<p>2         (IORegion2) 0xffff0000 0xffff00ff (AppNT2)          1               [ ]        </p>
<p>-------------------------------------------------------------------------------------</p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check </p>
<p>that </p>
<p>the </p>
<p>listed </p>
<p>peripheral </p>
<p>region </p>
<p>start </p>
<p>and </p>
<p>end </p>
<p>addresses </p>
<p>match </p>
<p>the </p>
<p>OS  </p>
<p>configuration. </p>
<p> </p>
<p>Check that the listed accessing application names match the OS configuration. </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>56 </p>
<p>based on template version 2.0 </p>
<p><b>8.26 </b></p>
<p><b>Spinlock Lock Method </b></p>
<p>Container “Spinlock Lock Method” contains information about how spinlocks prevent </p>
<p>interruption by ISRs and pre-emption by tasks with higher priority. </p>
<p>Possible settings are: </p>
<p>LOCK_ALL_INTERRUPTS </p>
<p>LOCK_CAT2_INTERRUPTS </p>
<p>LOCK_WITH_RES_SCHEDULER </p>
<p>LOCK_NOTHING </p>
<p>This container is always available but only relevant in multi core systems.  </p>
<p> </p>
<p> </p>
<p><b>8.27 </b></p>
<p><b>Spinlock Config Type </b></p>
<p>Container “Spinlock Config Type” contains information whether the spinlock type is </p>
<p>standard AUTOSAR or optimized.  </p>
<p>This container is always available but only relevant in multi core systems. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Spinlock Config Type” must look like: </p>
<p> </p>
<p><b>25. Spinlock Config Type: N/A </b></p>
<p> </p>
<p> </p>
<p><b>8.28 </b></p>
<p><b>Optimized Spinlock Variable Addresses </b></p>
<p>Container “Optimized Spinlock Variable Addresses” contains information about the variable </p>
<p>addresses of optimized spinlocks. Standard AUTOSAR spinlocks have no such address, </p>
<p>so there will be a NULL pointer for them.  </p>
<p>This sub-container is always available but only relevant in multi core systems.  </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Spinlock Lock Method” must look like: </p>
<p> </p>
<p><b>24. Spinlock Lock Method: N/A </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>57 </p>
<p>based on template version 2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Optimized Spinlock Variable Addresses” must look like: </p>
<p> </p>
<p><b>26. Optimized Spinlock Variable Address: N/A </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>8.29 </b></p>
<p><b>Category 2 ISR Stack Address </b></p>
<p>Container “Category 2 ISR Stack Address Area” contains the stack start and stack end </p>
<p>address of all category 2 ISR functions.  </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Category 2 ISR Stack Address Area” must look like: </p>
<p> </p>
<p>27. Category 2 ISR Stack Addresses: </p>
<p>------------------------------------------------------------- </p>
<p>ISR-ID ISR-Name          Start-Address End-Address   Checked? </p>
<p>------------------------------------------------------------- </p>
<p>0      (ISRNonTrust)     0xfedf0400    0xfedf0800      [ ]    </p>
<p>1      (ISRTrust)        0xfedf0800    0xfedf0A00      [ ]    </p>
<p>2      (osSystemCat2ISR) 0x00000000    0x00000000      [ ]    </p>
<p>------------------------------------------------------------- </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that for each listed category 2 ISR the start and end address matches to the </p>
<p>stack  of  the  corresponding  interrupt  priority  level.  See  linker  map  file  for  symbols </p>
<p><i>_osIntStackLevel&lt;PriorityLevel&gt;_c&lt;CoreID&gt; </i></p>
<p> </p>
<p> </p>
<p> </p>
<p><b>8.30 </b></p>
<p><b>Category 2 ISR Interrupt Channel Index </b></p>
<p>Container “Category 2 ISR Interrupt Channel Index” contains the interrupt channel index of </p>
<p>all category 2 ISR functions. </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>58 </p>
<p>based on template version 2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Category 2 ISR Interrupt Channel Index” must look like: </p>
<p> </p>
<p>28. Category 2 ISR Interrupt Channel Index: </p>
<p>-------------------------------------------------- </p>
<p>ISR-ID ISR-Name             Channel-Index Checked? </p>
<p>-------------------------------------------------- </p>
<p>0      (TestTimer1)         75              [ ]    </p>
<p>1      (osOstmInterrupt_c0) 76              [ ]    </p>
<p>2      (osSystemCat2ISR)    0               [ ]    </p>
<p>--------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that for each listed category 2 ISR the interrupt channel index matches to the </p>
<p>OS configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b>8.31 </b></p>
<p><b>Category 2 ISR Priority Level </b></p>
<p>Container “Category 2 ISR Interrupt Priority Level” contains the priority level of all category </p>
<p>2 ISR functions. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Category 2 ISR Interrupt Priority Level” must look like: </p>
<p> </p>
<p>29. Category 2 ISR Interrupt Priority Level: </p>
<p>--------------------------------------------- </p>
<p>ISR-ID ISR-Name             Priority Checked? </p>
<p>--------------------------------------------- </p>
<p>0      (TestTimer1)         6          [ ]    </p>
<p>1      (osOstmInterrupt_c0) 6          [ ]    </p>
<p>2      (osSystemCat2ISR)    128        [ ]    </p>
<p>--------------------------------------------- </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that for each listed category 2 ISR the interrupt priority level matches to the </p>
<p>OS configuration. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>59 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Note: The interrupt priority of system ISR osSystemCat2ISR is always 128. </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>60 </p>
<p>based on template version 2.0 </p>
<p><b>8.32 </b></p>
<p><b>Category 2 ISR to Core Mapping </b></p>
<p>Container “Category 2 ISR to Core Mapping” contains the mapping of category 2 ISRs to </p>
<p>processor cores. [SPMF92:02.0030] </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Category 2 ISR to Core Mapping” must look like: </p>
<p> </p>
<p>30. Category 2 ISR to Core Mapping: </p>
<p>------------------------------------------------------ </p>
<p>ISR-ID ISR-Name             Core-ID Core-Name Checked? </p>
<p>------------------------------------------------------ </p>
<p>0      (TestTimer1)         0       (Core0)     [ ]    </p>
<p>1      (osOstmInterrupt_c0) 0       (Core0)     [ ]    </p>
<p>2      (osSystemCat2ISR)    0       (Core0)     [ ]    </p>
<p>------------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed category 2 ISR to core assignment matches the OS </p>
<p>configuration. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>61 </p>
<p>based on template version 2.0 </p>
<p><b>8.33 </b></p>
<p><b>Application MPU Configuration </b></p>
<p>Container “Application MPU Configuration” contains the dynamic MPU region settings of all  </p>
<p>applications. [SPMF92:02.0030] </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Application MPU configuration” must look like: </p>
<p>31. Application MPU configuration: </p>
<p>------------------------------------------------------------------------ </p>
<p>Appl-ID Appl-Name                  Region Start-Addr End-Addr   Checked? </p>
<p>------------------------------------------------------------------------ </p>
<p>0       (APPL1)                    1      0xfedf2000 0xfedf21ff   [ ]    </p>
<p>------------------------------------------------------------------------ </p>
<p>1       (APPL2)                    1      0xfedf2200 0xfedf23ff   [ ]    </p>
<p>------------------------------------------------------------------------ </p>
<p>2       (APPL3)                    1      0xfedf3000 0xfedf3fff   [ ]    </p>
<p>------------------------------------------------------------------------ </p>
<p>3       (ApplStartVectCore0)       1      0x00000010 0x00000000   [ ]    </p>
<p>------------------------------------------------------------------------ </p>
<p>4       (TraceAppl)                1      0x00000010 0x00000000   [ ]    </p>
<p>------------------------------------------------------------------------ </p>
<p>5       (osSystemApplicationCore0) 1      0x00000010 0x00000000   [ ]    </p>
<p>------------------------------------------------------------------------ </p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Trusted  applications  must  always  have  Start-Addr  =  0x00000010  and  End-Addr  = </p>
<p>0x00000000. </p>
<p> </p>
<p>Unused MPU regions in non-trusted applications must have Start-Addr = 0x00000010 </p>
<p>and End-Addr = 0x00000000</p>
<p> </p>
<p> </p>
<p>Check that values of Start-Addr and End-Addr in row of non-trusted applications </p>
<p>matches the OS configuration. </p>
<p> </p>
<p>Check that MPU regions of trusted applications have Start-Addr value smaller than the </p>
<p>End-Addr value. </p>
<p> </p>
<p>Check that unused MPU regions of non-trusted applications have Start-Addr value </p>
<p>smaller than the End-Addr value. </p>
<p> </p>
<p>Check that all trusted and non-trusted applications are listed. </p>
<p> </p>
<p>Check that all Start-Addr values are aligned to 4 Byte boundary [SPMF92:04.0009] </p>
<p> </p>
<p>Check that all End-Addr values point to the last valid byte in the specified area. </p>
<p> </p>
<p>Overlapping of memory regions is not allowed [SPMF92:04.0010]. </p>
<p> </p>
<p>The next region after the end address must be aligned at to a 4 Byte boundary. </p>
<p> </p>
<p>Compare  Start-Addr of non-trusted applications that the address value fits to address </p>
<p>of the application specific linker symbol used in configuration settings</p>
<p> </p>
<p>[SPMF92:0052]. </p>
<p> </p>
<p>Compare  End-Addr of non-trusted applications that the address value fits to address of </p>
<p>the application specific linker symbol used in configuration settings</p>
<p> </p>
<p>[SPMF92:0052]. </p>
<p> </p>
<p>If a linker section for application data memory region is empty then the end address is </p>
<p>below the start address. The start or end address may then overlap with other linker </p>
<p>sections. This can be ignored because it does not harm the MPU functionality. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>62 </p>
<p>based on template version 2.0 </p>
<p><b>8.34 </b></p>
<p><b>MPU Configuration </b></p>
<p>Container “MPU Configuration” contains the MPU regions settings [SPMF92:02.0030</p>
<p>]. The OS </p>
<p>uses the settings to initialize the MPU during StartOS. Static regions stay unchanged after </p>
<p>StartOS. Stack region and dynamic regions are reprogrammed when context is switched. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “MPU configuration” must look like: </p>
<p> </p>
<p>32. MPU Configuration: </p>
<p>--------------------------------------------------------------------------------------- </p>
<p>Region Start-Addr (MPLAn)  End-Addr (MPUAn)  Attributes (MPATn)  Type          Checked? </p>
<p>--------------------------------------------------------------------------------------- </p>
<p>0      0xfedf0400          0xfedf058c        0x000000c3          (Stack Region)     [ ]    </p>
<p>--------------------------------------------------------------------------------------- </p>
<p>1      0x00000010          0x00000000        0x000000c3          (Dynamic Region)   [ ]    </p>
<p>--------------------------------------------------------------------------------------- </p>
<p>2      0x00000000          0xfffffffc        0x03ff00c5          (Static Region)    [ ]    </p>
<p>3      0xfedf0768          0xfedf07fc        0x03ff00c3          (Static Region)    [ ]    </p>
<p>--------------------------------------------------------------------------------------- </p>
<p><b> </b></p>
<p>The MPU configuration in ConfigBlock must be reviewed by the user: [SPMF92:04.0005] </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the total number of Region matches the number of MPU regions which are </p>
<p>provided by the used CPU derivative. </p>
<p> </p>
<p>Dynamic regions must have the following entries:  </p>
<p>Start-Addr=0x00000010, End-Addr=0x00000000 and Attributes=0x000000c3. </p>
<p> </p>
<p>Unused regions must have the following entries: Start-Addr=0x00000010, End-</p>
<p>Addr=0x00000000 and Attributes=0x00000000 </p>
<p> </p>
<p>Region 0 Start-Addr must match to the system stack start address. </p>
<p> </p>
<p>Region 0 End-Addr must match to the system stack end address – 4 Bytes. </p>
<p> </p>
<p>Region 0 entry Attributes must match 0x000000c3. </p>
<p> </p>
<p>Check that the number of static regions matches the OS configuration. </p>
<p> </p>
<p>Check each static region that Start-Addr and End-Addr match the OS configuration. </p>
<p> </p>
<p>Check each static region that Start-Addr is lower than End-Addr. </p>
<p> </p>
<p>Check each static region that Attributes access rights matches the OS configuration. </p>
<p> </p>
<p>Check each static region that Attributes access rights contain the correct ASID. </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Default ASID value is 0x3ff if no ASID is configured. </p>
<p>RH850 F1L does not support ASID due to hardware restrictions. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>63 </p>
<p>based on template version 2.0 </p>
<p><b>8.35 </b></p>
<p><b>Application MPU ASID Configuration </b></p>
<p>Container “Application MPU ASID Configuration” contains the MPU ASID settings of all </p>
<p>applications. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>Container “Application MPU ASID configuration” must look like: </p>
<p> </p>
<p>33. Application MPU ASID configuration: </p>
<p>--------------------------------------------------------- </p>
<p>Application-ID Application-Name           Value  Checked? </p>
<p>--------------------------------------------------------- </p>
<p>0              (APPL1)                    0x0001   [ ]    </p>
<p>1              (APPL2)                    0x0002   [ ]    </p>
<p>2              (APPL3)                    0x0003   [ ]    </p>
<p>3              (ApplStartVectCore0)       0x03ff   [ ]    </p>
<p>4              (TraceAppl)                0x03ff   [ ]    </p>
<p>5              (osSystemApplicationCore0) 0x03ff   [ ]    </p>
<p>---------------------------------------------------------</p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the listed ASID configuration matches the OS configuration. </p>
<p> </p>
<p>All applications with ASID value 0x03ff must not have an ASID identifier configured. </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Note </b></p>
<p>Default ASID value is 0x3ff if no ASID is configured. </p>
<p>RH850 F1L does not support ASID due to hardware restrictions. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>64 </p>
<p>based on template version 2.0 </p>
<p><b>9 </b></p>
<p><b>Generated OS Code </b></p>
<p>MICROSAR OS is a massively configurable software component. As a result, the analysis </p>
<p>of the OS modules cannot be completely performed until the user’s configuration data is </p>
<p>available.  The  user  shall  use  MICROSAR  Safe  Silence  Verifier  (MSSV)  to  qualify  the </p>
<p>generated part of the OS, which depends on user’s configuration. MSSV is a Vector tool, </p>
<p>which performs checks of potential dangerous code constructs. [SPMF92:0049] For more </p>
<p>information about MSSV see the Technical Reference Manual of MSSV [4]. </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>The user must not modify a generated module configuration code file manually </p>
<p>unless explicitly required by the technical reference manual or explicitly direction </p>
<p>formulated by Vector. </p>
<p> </p>
<p>All generated files of a software project shall be generated based on the same </p>
<p>configuration. Generated files of several configurations must not be mixed up unless </p>
<p>explicitly allowed by Vector. </p>
<p> </p>
<p>The user shall apply steps for qualifying the generated sources on the final </p>
<p>configuration which is used for the production. If the configuration changes, source </p>
<p>qualification steps shall be reapplied. </p>
<p> </p>
<p> </p>
<p><b>9.1 </b></p>
<p><b>Using MICROSAR Safe Silence Verifier (MSSV) </b></p>
<p>The following chapter tells how you shall apply MSSV.exe on the OS sources.  </p>
<p>MSSV.exe is called with the following parameters: </p>
<p><b>MSSV.exe -i &lt;SourcePath&gt; -i &lt;GenPath&gt; -i &lt;HeaderPath&gt; -D osdNOASM </b></p>
<p> </p>
<p><b>Parameters </b></p>
<p><b>Description </b></p>
<p><b>-i &lt;SourcePath&gt;</b></p>
<p><b> </b></p>
<p>This parameter is multiple used:  </p>
<p>At least path of OS source files (e.g. osek.c), path of generated OS </p>
<p>files (e.g. tcb.c) and path of additional header files (e.g. Std_Types.h) </p>
<p>must be specified. </p>
<p><b>-r &lt;ReportFile&gt;</b></p>
<p><b> </b></p>
<p>Optional: Path and name which shall be used to save the MSSV report. </p>
<p>If not used then the results will be saved in file report.html </p>
<p><b>-D osdNOASM </b></p>
<p>Disable OS assembler code parts. Mandatory for OS. </p>
<p>Parameter -D can be multiple used. </p>
<p><b>--help </b></p>
<p>Show help </p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>The MICROSAR Safe Silence Verifier shall only be executed on Windows XP SP3+ </p>
<p>(32Bit) or Windows 7 (32Bit or 64Bit). </p>
<p> </p>
<p>The user must not modify the MICROSAR Safe Silence Verifier report. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>65 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>The user shall verify that the used OS sources are checked by verifying the names </p>
<p>and paths of the modules within the report. </p>
<p> </p>
<p>The user shall verify that the evaluated report matches to the execution of the </p>
<p>MICROSAR Safe Silence Verifier by verifying the name, creation date and time, path </p>
<p>and folder of the report. </p>
<p> </p>
<p>Check that MSSV returns with no errors, no warnings and the final verdict of the </p>
<p>report is “pass”. If MSSV did not pass contact OS support. [SPMF92:0088] </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p> </p>
<p>An example for qualifying generated OS sources: </p>
<p> </p>
<p>MSSV.exe -i .\BSW\OS -i .\TestAppl -i .\TestAppl\Gen -D osdNOASM </p>
<p> </p>
<p> </p>
<p>The output of MSSV.exe must look like: </p>
<p> </p>
<p>note: MICROSAR Safe Silence Verifier Version 1.04.00 </p>
<p>note: Copyright (C) 2012-2015 Vector Informatik GmbH </p>
<p>note: License &lt;CBD1600111&gt; Vector Informatik GmbH </p>
<p>note: mssv.exe started at 12:01:28 2016-01-21 </p>
<p>note: scanning plugin directory '... \MSSV\plugins'  </p>
<p>note: scanning input directory '... \BSW\OS'  </p>
<p>note: scanning input directory '... \TestAppl'  </p>
<p>note: scanning input directory '... \TestAppl\Gen'  </p>
<p>note: found 29 source code files, 57 header files and 3 include directories </p>
<p>note: module plugin 'Tcb' successfully initialized </p>
<p>note: starting execution of plugin 'Tcb' </p>
<p>note: plugin 'Tcb' executed 57 rules (84 assertions held, 0 assertions did </p>
<p>not hold) </p>
<p>note: Log file written to 'stdout' </p>
<p>note: Report file written to 'report.invalid' </p>
<p>note: On success report file will be renamed to 'report.html' </p>
<p>note: mssv.exe finished at 12:01:28 2016-01-21 </p>
<p>note: 0 Errors </p>
<p>note: 0 Warnings </p>
<p>note: the final verdict of the report is 'pass'</p>
<p> </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>66 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p><b>9.2 </b></p>
<p><b>Manual Reviews </b></p>
<p>Some generated code parts currently cannot be checked automatically. Therefore the user </p>
<p>has to check them manually. </p>
<p> </p>
<p><b>9.2.1  Review generated file tcb.h </b></p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>1. </p>
<p>You shall review the system level definition </p>
<p>osdSystemLevel</p>
<p> to be the </p>
<p>maximum of all category 2 ISR priorities and check mask definition </p>
<p>osdSystemLevelMask </p>
<p>to be the corresponding value, which has to be </p>
<p>stored in PMR register to mask (i.e. disable) all category 2 interrupts. </p>
<p>[SPMF92:02.0019] [SPMF92:04.0017]  [SPMF92:02.0032] [SPMF92:02.0033] </p>
<p>[SPMF92:0059] [SPMF92:0060] </p>
<p>#define osdSystemLevel &lt;MAXIMUM_OF_ALL_CAT2_ISR_PRIORITIES&gt; </p>
<p>#define osdSystemLevelMask &lt;PMR_VALUE_MASK_ALL_CAT2_ISR&gt; </p>
<p> </p>
<p> </p>
<p>2. </p>
<p>Check that osdExceptionDetails is defined = 1  </p>
<p>#define osdExceptionDetails 1 </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>67 </p>
<p>based on template version 2.0 </p>
<p><b>9.2.2 </b></p>
<p><b>Review of tcb.c </b></p>
<p>The function </p>
<p>osSTWorkActions()</p>
<p> is used for handling Expiry Points. It calls OS internal </p>
<p>functions to perform the configured actions at the configured Expiry Points. This function is </p>
<p>generated, therefore the user has to review that safety requirements are fulfilled. </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>The function </p>
<p>osSTWorkActions()</p>
<p> may look like: </p>
<p> </p>
<p>osqFunc1 osSTReactionType osqFunc2 osSTWorkActions(GlobalTimeTickType* diff, </p>
<p>osSTIndexType CurrentEP) </p>
<p>{ </p>
<p>   switch (CurrentEP) </p>
<p>   { </p>
<p>      case 0: /* SchedT1 */ </p>
<p>         (void)osSysActivateTask(TaskBasic); </p>
<p>         *diff= 250; /* no sync for this schedule table / this expiry point */ </p>
<p>         return osdSTReact_Continue; </p>
<p>      case 1: /* SchedT1 */ </p>
<p>         (void)osSysSetEvent(TaskExt,evTaskExt); </p>
<p>         *diff= 150; /* no sync for this schedule table / this expiry point */ </p>
<p>         return osdSTReact_Continue; </p>
<p>… </p>
<p>      case 15: /* osSystemSchT */ </p>
<p>         (void)osSysSetEvent(osSystemExtendedTask,osSystemEvent); </p>
<p>         *diff=0; </p>
<p>         return osdSTReact_Stop; </p>
<p>      /* MISRA RULE 14.1 VIOLATION: return is not </p>
<p>       * reachable but this is the only way for prevent a compiler warning (3201) </p>
<p>       */ </p>
<p>      default: </p>
<p>         osSysErrAssertFailed(osdErrWSUnknownAction) </p>
<p>         return osdSTReact_Stop;  /* PRQA S 3201 */ </p>
<p>   } </p>
<p>} </p>
<p><b> </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that </p>
<p>osSTWorkActions()</p>
<p> is only called by </p>
<p>osWorkScheduleTable()</p>
<p> in </p>
<p>atostime.c </p>
<p>and nowhere else. </p>
<p> </p>
<p><i>Check for all </i></p>
<p><i>osSysActivateTask()</i></p>
<p><i> calls pass valid Task names </i></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>68 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>User has to review that the parameter of each call of osSysActivateTask in tcb.c is a </p>
<p>valid task identifier (define in </p>
<p>tcbpost.h</p>
<p>). [SPMF92:05.0009] </p>
<p> </p>
<p><i>Check for all </i></p>
<p><i>osSysSetEvent()</i></p>
<p><i> calls pass valid Task and Event names </i></p>
<p>The user has to review that the first parameter of all calls of </p>
<p>osSysSetEvent</p>
<p> in </p>
<p>tcb.c</p>
<p> is a valid task identifier (define in </p>
<p>tcbpost.h</p>
<p>) and that the value of the </p>
<p>define is smaller than </p>
<p>osdNumberOfExtendedTasks</p>
<p>.  </p>
<p>[SPMF92:05.0006] </p>
<p> </p>
<p>Check that the array </p>
<p>oskAlarmCounterRef[]</p>
<p> contains </p>
<p>osdNumberOfAlarms</p>
<p> </p>
<p>elements and that each element contains the index of the counter related to that </p>
<p>alarm. </p>
<p> </p>
<p>Check that the array </p>
<p>oskAlarmTask[]</p>
<p> contains valid task ID values (Task ID of </p>
<p>either the activated task or the Task ID of the task which receives an event). </p>
<p> </p>
<p>Check that </p>
<p>oskResCeilingPrio[]</p>
<p> contains priorities smaller than </p>
<p>oskNumberOfPriorities[&lt;Core ID of the Core to which the </p>
<p>resource is assigned&gt;]</p>
<p> </p>
<p> </p>
<p>Check the size of all </p>
<p>osQTaskActivation_&lt;Prio Index&gt;</p>
<p> arrays </p>
<p>The size must be the value of </p>
<p>oskQMaxActivations[Prio Index] + 1  </p>
<p>[SPMF92:05.0012] </p>
<p> </p>
<p>Check that the array “</p>
<p>oskAlarmHeaps</p>
<p>” has the size of “</p>
<p>osdNumberOfCounters</p>
<p>” </p>
<p>[SPMF92:05.0002] </p>
<p> </p>
<p>Check that all elements of one entry in “</p>
<p>oskAlarmHeaps</p>
<p>” are related to the same </p>
<p>counter </p>
<p>{ </p>
<p>   os&lt;Counter Name&gt;Heap, </p>
<p>   &amp;osAlarmHeapCount[&lt;Counter Name&gt;] </p>
<p>}, </p>
<p>[SPMF92:05.0002] </p>
<p> </p>
<p>Check for the correct ordering of the entries in “</p>
<p>oskAlarmHeaps</p>
<p>”. Correct ordering </p>
<p>means that the first entry must be related to the counter which is defined to zero (in </p>
<p>tcbpost.h</p>
<p>). The second entry must be related to the counter which is defined to </p>
<p>one etc.  </p>
<p>[SPMF92:05.0002] </p>
<p> </p>
<p>Check for the correct size of the Heap arrays. </p>
<p>The size of such an array “</p>
<p>os&lt;Counter Name&gt;Heap</p>
<p>” must be  </p>
<p>Number of alarms related to counter  &lt;Counter Name&gt; + Number of Scheduletables </p>
<p>related to &lt;Counter Name&gt; + 1  </p>
<p>[SPMF92:05.0005] </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>69 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p><b>9.2.3  Review of tcbpost.h </b></p>
<p><b>Description of requirements to the user </b></p>
<p><b>Fulfilled </b></p>
<p>Check that the Alarm names are mapped onto adjoining numbers. Starting with zero </p>
<p>to </p>
<p>osdNumberOfAlarms – 1 </p>
<p>(</p>
<p>osdNumberOfAlarms</p>
<p> is defined in </p>
<p>tcb.h</p>
<p>) [SPMF92:05.0013] </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>/* Alarms */  </p>
<p>#define CrossCoreATAlarm ((AlarmType)0) </p>
<p>#define osSystemAlarm ((AlarmType)1) </p>
<p>#define My10msAlarm ((AlarmType)2) </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>Check that the Counter names are mapped onto adjoining numbers. Starting with </p>
<p>zero to </p>
<p>osdNumberOfCounters – 1 </p>
<p>(</p>
<p>osdNumberOfCounters</p>
<p> is defined in </p>
<p>tcb.h</p>
<p>) [SPMF92:05.0003] </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>/* Counter */ </p>
<p> </p>
<p>#define osSystemSWCounter ((CounterType) 0) </p>
<p>#define SystemTimerCore0 ((CounterType) 1) </p>
<p>#define OtherCounter ((CounterType) 2) </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>Check that the task names are mapped onto adjoining numbers starting from zero to </p>
<p>osdNumberOfAllTasks – 1 </p>
<p>(</p>
<p>osdNumberOfAllTasks</p>
<p> is defined in </p>
<p>tcb.h</p>
<p>) [SPMF92:05.0010] </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>/* Tasks */  </p>
<p>#define Task2Core1 ((TaskType)0) </p>
<p>#define osSystemExtendedTask ((TaskType)1) </p>
<p>#define Task1Core1 ((TaskType)2) </p>
<p>#define Task1Core0 ((TaskType)3) </p>
<p>#define IdleTaskCore1 ((TaskType)4) </p>
<p>#define IdleTaskCore0 ((TaskType)5) </p>
<p>#define osSystemBasicTask ((TaskType)6) </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>70 </p>
<p>based on template version 2.0 </p>
<p>Check that the category 2 ISR names are mapped onto adjoining numbers starting </p>
<p>from zero to </p>
<p>osdNumberOfCat2ISRs – 1 </p>
<p>(</p>
<p>osdNumberOfCat2ISRs</p>
<p> is defined in </p>
<p>tcb.h</p>
<p>) [SPMF92:05.0015] </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>/* ISR IDs */  </p>
<p>#define SystemTimerISR_Core0 ((ISRType)0) </p>
<p>#define osIOCNotificationISRCore0 ((ISRType)1) </p>
<p>#define osIOCNotificationISRCore1 ((ISRType)2) </p>
<p>#define osIOCNotificationISRCore2 ((ISRType)3) </p>
<p>#define osShutdownRequestISRCore0 ((ISRType)4) </p>
<p>#define osShutdownRequestISRCore1 ((ISRType)5) </p>
<p>#define osShutdownRequestISRCore2 ((ISRType)6) </p>
<p>#define osSystemCat2ISR ((ISRType)7) </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>Check that the Schedule Table names are mapped onto adjoining numbers. Starting </p>
<p>with zero to </p>
<p>osdNumberOfScheduleTables – 1 </p>
<p>(</p>
<p>osdNumberOfScheduleTables </p>
<p>is defined in </p>
<p>tcb.h</p>
<p>) </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>/* Schedule Tables */ </p>
<p> </p>
<p>#define Scheduletable1 ((ScheduleTableType) 0) </p>
<p>#define Scheduletable2 ((ScheduleTableType) 1) </p>
<p>#define osSystemSchT ((ScheduleTableType) 2) </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p>Check that the values of </p>
<p>osr(NumberOf)&lt;OS Object&gt;</p>
<p> are defined to </p>
<p>osd(NumberOf)&lt;OS Object&gt; </p>
<p> </p>
<p> </p>
<p><b>Example </b></p>
<p>#define osrRTSize                 osdRTSize  </p>
<p>#define osrNumberOfPriorities     osdNumberOfPriorities  </p>
<p>#define osrNumberOfAppModes       osdNumberOfAppModes </p>
<p>#define osrNumberOfAllTasks       osdNumberOfAllTasks </p>
<p>#define osrNumberOfAllResources   osdNumberOfAllResources </p>
<p>   . </p>
<p>   . </p>
<p>   . </p>
<p>#define osrSystemTimer            SystemTimer </p>
<p>#define osrNumberOfCounters       osdNumberOfCounters </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>71 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p><b>9.2.4  Review of trustfct.c &amp; trustfct.h </b></p>
<p>The following review checks are only relevant for trusted functions that belong to an OS-</p>
<p>application which has the parameter </p>
<p>GenerateStub</p>
<p><i> </i>set to </p>
<p>TRUE</p>
<p><i>. </i></p>
<p>The  OS  provides  the  possibility  to  use  generated  stub  functions  for  the  call  of  trusted </p>
<p>functions. These stubs are generated into the following files: </p>
<p><b>&gt; </b></p>
<p>trustfct.c </p>
<p><b>&gt; </b></p>
<p>trustfct.h </p>
<p>Both  files  are  generated  on  QM  level  but  executed  in  supervisor-mode.  Therefore  the </p>
<p>generated code shall be reviewed. </p>
<p>If stubs are generated for a trusted function, there are two parts: the Caller stub and the </p>
<p>Callee-stub.  The  Caller-stub  is  a  function  which  packs  the  parameters  which  shall  be </p>
<p>passed </p>
<p>to </p>
<p>the </p>
<p>trusted </p>
<p>function </p>
<p>into </p>
<p>a </p>
<p>C-struct </p>
<p>and </p>
<p>calls </p>
<p>the </p>
<p>API </p>
<p>function </p>
<p>CallTrustedFunction</p>
<p>.  The  Callee-stub  unpacks  the  parameters  from  the  struct  and </p>
<p>passes them to the users trusted function. </p>
<p> </p>
<p><b>9.2.4.1  File trustfct.c  </b></p>
<p>Review the file </p>
<p>trustfct.c</p>
<p> according the following review criteria. </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>The name of the trusted function caller function body shall be  </p>
<p>Call_&lt;TrustedFunctionName&gt;</p>
<p> </p>
<p> </p>
<p> </p>
<p>If second parameter of API function </p>
<p>CallTrustedFunction</p>
<p> is </p>
<p>&amp;&lt;ParamName&gt;</p>
<p> </p>
<p>then the following local variable shall exist:  </p>
<p>TrustedFunctionParameterType &lt;ParamName&gt;;</p>
<p> </p>
<p> </p>
<p> </p>
<p>Check that the API function </p>
<p>CallTrustedFunction</p>
<p> only uses a reference to this </p>
<p>local variable. </p>
<p> </p>
<p>The first parameter shall be: </p>
<p>osd_TFCT_&lt;TrustedFunctionName&gt;</p>
<p> </p>
<p> </p>
<p> </p>
<p>If the trusted function has no arguments, then the second parameter shall be:  </p>
<p>(TrustedFunctionParameterRefType)0</p>
<p> </p>
<p> </p>
<p> </p>
<p>If the trusted function has arguments, then the second parameter shall be:  </p>
<p>&amp;&lt;ParamName&gt;</p>
<p> </p>
<p> </p>
<p> </p>
<p>Callee-stubs shall have the following function prototype: </p>
<p>void TRUSTED_&lt;TrustedFunctionName&gt;( TrustedFunctionIndexType </p>
<p>FunctionIndex, TrustedFunctionParameterRefType </p>
<p>FunctionParams ); </p>
<p> </p>
<p> </p>
<p>Callee-stubs shall not modify any ASIL data. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>72 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Callee-stubs shall not call any function other than the specific trusted function. </p>
<p> </p>
<p>Callee-stubs shall not consume more stack space than available. </p>
<p> </p>
<p>Trusted functions which have arguments shall be called with following parameter </p>
<p>notation syntax:  </p>
<p>((TrustedFunctionParameterType*)FunctionParams) -&gt;  </p>
<p>&lt;TrustedFunctionName&gt;_args.os_arg_&lt;MemberName&gt;</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>The following trusted function configuration: </p>
<p>TRUSTED_FUNCTION = TRUE  { </p>
<p>   NAME = &quot;StartTestStep&quot;; </p>
<p>   Params = &quot;osuint8 p&quot;; </p>
<p>   ReturnType = &quot;void&quot;; </p>
<p>};</p>
<p> </p>
<p>Leads to the following code in </p>
<p>trustfct.c</p>
<p>: </p>
<p>... </p>
<p>void Call_StartTestStep(osuint8 os_arg_p) </p>
<p>{ </p>
<p>   TrustedFunctionParameterType myargs; </p>
<p> </p>
<p>   myargs.StartTestStep_args. os_arg_p =  os_arg_p; </p>
<p>   (void) CallTrustedFunction(osd_TFCT_StartTestStep, &amp;myargs); </p>
<p>} </p>
<p>... </p>
<p>void TRUSTED_StartTestStep(TrustedFunctionIndexType FunctionIndex, </p>
<p>TrustedFunctionParameterRefType FunctionParams)  /* PRQA S 1505, 3673 */ </p>
<p>{ </p>
<p>   /* osdDummyRead might intentionally assign a value to an unused variable </p>
<p>on some platforms to avoid compiler warnings. This is no MISRA error. (3199) </p>
<p>*/ </p>
<p>   osdDummyRead(FunctionIndex)   /* PRQA S 3199 */ </p>
<p>   StartTestStep(((TrustedFunctionParameterType*)FunctionParams)-</p>
<p>&gt;StartTestStep_args. os_arg_p); </p>
<p>}</p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>73 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p><b>9.2.4.2  File trustfct.h  </b></p>
<p>Review the file </p>
<p>trustfct.h</p>
<p> according the following rules:  </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p>Each trusted function shall have an index definition with following notation syntax: </p>
<p><b>&gt; </b></p>
<p>If configuration attribute is “</p>
<p>GenerateStub=FALSE</p>
<p>“:  </p>
<p>  #define &lt;TrustedFunctionName&gt;  &lt;TrustedFunctionIndex&gt; </p>
<p><b>&gt; </b></p>
<p>If configuration attribute is “</p>
<p>GenerateStub=TRUE</p>
<p>“: </p>
<p>  #define osd_TFCT_&lt;TrustedFunctionName&gt;  &lt;TrustedFunctionIndex&gt; </p>
<p> </p>
<p> </p>
<p>The mapping of trusted function names to indexes shall be consistent to the </p>
<p>mapping of trusted function start addresses to indexes as printed in the </p>
<p>configuration block output. [SPMF92:0048] </p>
<p> </p>
<p>Each trusted function stub which uses function arguments shall have its specific C-</p>
<p>struct type definition </p>
<p>osTFArgType_&lt;TrustedFunctionName&gt;</p>
<p> </p>
<p> </p>
<p>This C-struct shall contain all arguments which are used by the specific trusted </p>
<p>function. </p>
<p> </p>
<p>Check that the following union type definition is generated and check that each </p>
<p>trusted function which uses function arguments is listed in this union type definition. </p>
<p>typedef union </p>
<p>{ </p>
<p>    osTFArgType_&lt;TrustedFuncName1&gt;  &lt;TrustedFuncName1&gt;_args; </p>
<p>    osTFArgType_&lt;TrustedFuncName2&gt;  &lt;TrustedFuncName2&gt;_args; </p>
<p>    osTFArgType_&lt;TrustedFuncName3&gt;  &lt;TrustedFuncName3&gt;_args; </p>
<p>    ... </p>
<p>} TrustedFunctionParameterType;</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>74 </p>
<p>based on template version 2.0 </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p><b>Example </b></p>
<p>The following trusted function configuration: </p>
<p>TRUSTED_FUNCTION = TRUE  { </p>
<p>   NAME = &quot;StartTestStep&quot;; </p>
<p>   Params = &quot;osuint8 p&quot;; </p>
<p>   ReturnType = &quot;void&quot;; </p>
<p>};</p>
<p> </p>
<p>Leads to the following code in </p>
<p>trustfct.h</p>
<p>: </p>
<p>#define osd_TFCT_StartTestStep 1 </p>
<p>void TRUSTED_StartTestStep(TrustedFunctionIndexType FunctionIndex, </p>
<p>TrustedFunctionParameterRefType FunctionParams); </p>
<p>void Call_StartTestStep(osuint8 os_arg_p); </p>
<p> </p>
<p>typedef struct </p>
<p>{ </p>
<p>   osuint8 os_arg_p; </p>
<p>} osTFArgType_StartTestStep;</p>
<p> </p>
<p> </p>
<p><b> </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>75 </p>
<p>based on template version 2.0 </p>
<p><b>10 </b></p>
<p><b>Review User Software </b></p>
<p>Some  code  parts  run  in  supervisor  mode  without  any  memory  protection  active  or  with </p>
<p>high memory access granted. Therefore, freedom from interference is not guaranteed by </p>
<p>the OS and the hardware. Trusted software has to guarantee freedom from interference on </p>
<p>its  own.  The  application  programmer  typically  knows  best,  what  is  to  do  in  order  to </p>
<p>guarantee  freedom  from  interference.  Anyhow,  there  are  few  additional  points  to  be </p>
<p>covered when an OS is used. </p>
<p>The  following  requirements  shall  generally  be  fulfilled  by  trusted  software  (also  valid  for </p>
<p>software which runs in supervisor mode or with access to safety relevant memory areas): </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p><i>OS code coverage shall be disabled </i></p>
<p>Check that </p>
<p>osdEnableCoverage</p>
<p> is not defined when you compile the OS. </p>
<p>[SPMF92:0077] </p>
<p> </p>
<p><i>Unhandled exception details shall be enabled </i></p>
<p>Check that osdExceptionDetails is defined = 1 (see tcb.h) </p>
<p>Check that OS attribute EnumeratedUnhandledISRs is set TRUE </p>
<p> </p>
<p><i>No usage of system call instructions in the user software </i></p>
<p>Any system call causes the CPU to change into supervisor mode. Therefore, </p>
<p>the application (trusted and non-trusted parts) shall not use system calls </p>
<p>directly. Instead, system calls shall only be used by using OS API service </p>
<p>functions. </p>
<p> </p>
<p><i>User header usrostyp.h </i></p>
<p>If trusted functions are configured, ensure that </p>
<p>usrostyp.h</p>
<p> does not </p>
<p>endanger SafeContext safety requirements. </p>
<p> </p>
<p><i>Enabling interrupts where it is not allowed </i></p>
<p>Interrupts shall not be enabled by the application where Category 2 ISRs are </p>
<p>disabled  by  default  (e.g.  in  Hooks). This  applies  not  to  ISRs.  In  ISRs  it  is </p>
<p>allowed to enable interrupts. [SPMF92:0066] </p>
<p> </p>
<p><i>Use only documented APIs </i></p>
<p>Trusted software shall only call documented API functions, which are listed in </p>
<p>chapter “Detailed List of Functionality”. [SPMF92:0068] </p>
<p> </p>
<p><i>Stack usage measurement is not exact </i></p>
<p>Stack </p>
<p>usage </p>
<p>measurement </p>
<p>is </p>
<p>implemented </p>
<p>by </p>
<p>counting </p>
<p>magic </p>
<p>patterns </p>
<p>(</p>
<p>osdStackCheckPattern</p>
<p>)  on  the  stack  which  have  been  written  there </p>
<p>during startup. The returned value may not be correct, if the magic pattern </p>
<p>did </p>
<p>not </p>
<p>change </p>
<p>(e.g. </p>
<p>the </p>
<p>user </p>
<p>application </p>
<p>uses </p>
<p>the </p>
<p>same </p>
<p>value). </p>
<p>[SPMF92:0072] </p>
<p> </p>
<p><i>Usage of osCheckMPUAccess API </i></p>
<p>If  you  are  using  the </p>
<p>osCheckMPUAccess</p>
<p>  API,  the  destination  address </p>
<p>parameter  shall  point  to  an  address,  where  reading  and  writing  does  not </p>
<p>produce other exceptions than MPU exceptions. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>76 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p><i>Usage of osCheckMPUAccess API </i></p>
<p>If you are using the </p>
<p>osCheckMPUAccess</p>
<p> API, Check that the API function is </p>
<p>only called with addresses which, reading and writing does not have any side </p>
<p>effects (e.g. potentially not true for peripheral registers). [SPMF92:02.0017]. </p>
<p> </p>
<p><i>If  you  have write  access  to  stacks,  stack  overflows  cannot  be  detected  by </i></p>
<p><i>hardware </i></p>
<p>The  OS  cannot  safely  detect  stack  overflows  in  software  which  has  write </p>
<p>access  to  all  stacks.  If  write  access  to  all  stacks  is  really  needed  (e.g.  for </p>
<p>RAM checking), the user has to ensure that the software does not produce a </p>
<p>stack overflow! [SPMF92:0078] </p>
<p> </p>
<p><i>APIs in exception handlers </i></p>
<p>Exception handlers must not call any OS API function beside: </p>
<p><b>&gt; </b></p>
<p>DisableAllInterrupts </p>
<p><b>&gt; </b></p>
<p>EnableAllInterrupts </p>
<p><b>&gt; </b></p>
<p>SuspendAllInterrupts </p>
<p><b>&gt; </b></p>
<p>ResumeAllInterrupts </p>
<p><b>&gt; </b></p>
<p>SuspendOSInterrupts</p>
<p><i> </i></p>
<p><b>&gt; </b></p>
<p>ResumeOSInterrupts</p>
<p><i> </i></p>
<p>[SPMF92:0067] </p>
<p> </p>
<p><i>Category 1 ISRs shall be transparent </i></p>
<p>All ISRs of category 1 must be implemented such that they are transparent </p>
<p>with respect to the processor state for the code they interrupt. This includes </p>
<p>core registers, MPU settings and the current interrupt priority. </p>
<p> </p>
<p><i>APIs in category 1 ISRs </i></p>
<p>Category 1 ISRs shall not call any OS API function beside: </p>
<p><b>&gt; </b></p>
<p>DisableAllInterrupts </p>
<p><b>&gt; </b></p>
<p>EnableAllInterrupts </p>
<p><b>&gt; </b></p>
<p>SuspendAllInterrupts </p>
<p><b>&gt; </b></p>
<p>ResumeAllInterrupts </p>
<p> [SPMF92:0067] [SPMF92:02.0018] </p>
<p> </p>
<p><i>Check out-parameters in Trusted Functions </i></p>
<p>Trusted functions which get a pointer shall check the pointer address to be in </p>
<p>an expected range before they write to the pointer address. This shall </p>
<p>prevent overwriting of safety relevant data when writing to the pointer </p>
<p>address. [SPMF92:0001] </p>
<p> </p>
<p><i>Check caller in Trusted Functions </i></p>
<p>Trusted functions shall validate whether they are called by an authorized </p>
<p>caller only. This may be done by using the API function </p>
<p>GetApplicationID</p>
<p>. [SPMF92:0047] </p>
<p> </p>
<p><i>No (Non-)Trusted Functions in Hooks </i></p>
<p>Hook routines shall not call any trusted function or non-trusted function. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>77 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p><i>No APIs in NMIs </i></p>
<p>Non-maskable interrupts shall not use any OS APIs. [SPMF92:0019], </p>
<p>[SPMF92:0067] </p>
<p> </p>
<p><i>Using Interrupt API before calling StartOS </i></p>
<p>If the user needs to use the interrupt API before he calls </p>
<p>StartOS</p>
<p>, he shall </p>
<p>call </p>
<p>osInitialize</p>
<p> and </p>
<p>osInitINTC</p>
<p>.  </p>
<p>After calling these functions interrupt API works only for the straight forward </p>
<p>case. OS error handling and MPU won’t be initialized, so the OS won’t be </p>
<p>able to handle any user errors or detect stack overflows. </p>
<p> </p>
<p><i>Functions osDisable/EnableLevelKM and osDisable/EnableGlobalKM </i></p>
<p>Functions osDisableLevelKM, osEnableLevelKM, osDisableGlobalKM and </p>
<p>osEnableGlobalKM  shall only be called by trusted applications, i.e. when </p>
<p>CPU is in privileged mode. [SPMF92:0094] </p>
<p> </p>
<p><i>Functions osEnableLevelKM, osEnableLevelUM, osEnableLevelAM </i></p>
<p>Assure that these functions are only called if the interrupt level was equal to </p>
<p>the task level at the matching disable function (especially: not called in ISR!) </p>
<p>Mind that the level functions may use the global flag, if disabling on level is </p>
<p>not supported for a specific hardware. [SPMF92:0095] </p>
<p> </p>
<p><i>Functions osEnableGlobalKM, osEnableGlobalUM, osEnableGlobalAM </i></p>
<p>Assure that these functions are only called if interrupts were enabled by </p>
<p>means of the global flag at the matching disable function (especially: not </p>
<p>called in ISR with EnableNesting=FALSE) Mind that the global interrupt API </p>
<p>functions may use the interrupt level in case no global disabling is supported </p>
<p>on a specific hardware or if timing protection is active. [SPMF92:0096] </p>
<p> </p>
<p><i>Functions osEnableLevelKM, osEnableLevelUM, osEnableLevelAM and  </i></p>
<p><i>functions osEnableGlobalKM, osEnableGlobalUM, osEnableGlobalAM </i></p>
<p>Assure that these functions are not called in a nested way, even if they seem </p>
<p>to use different locking mechanisms. [SPMF92:0097] </p>
<p> </p>
<p><i>Header file osek.h </i></p>
<p>This header file is included into the OS almost everywhere. Make sure that </p>
<p>you do not manipulate the OS in an unforeseen way. [SPMF92:0098] </p>
<p> </p>
<p><i>Timing Hooks  </i></p>
<p>Assure that hook functions do not violate safety goals especially do not </p>
<p>manipulate safety relevant data, the interrupt state and do not cause stack </p>
<p>overflow (prevention of stack overflow may be unnecessary if the hardware </p>
<p>allows to keep the MPU active in privileged mode) (interrupt disabling by </p>
<p>means of the global flag and restauration its's state before returning to the </p>
<p>caller shall be explicitly allowed if no OS API functions are used for that). </p>
<p>[SPMF92:0099] </p>
<p> </p>
<p><i>Timing Hooks Parameters </i></p>
<p>Assure that parameters of the hook routines are not used to reference a </p>
<p>memory location to write to without a check for validity. (Mind that the invalid </p>
<p>values are usually big numbers). [SPMF92:0100] </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>78 </p>
<p>based on template version 2.0 </p>
<p><b>Description of requirements to the OS user </b></p>
<p><b>Fulfilled </b></p>
<p><i>Timing Hooks  </i></p>
<p>The OS does not guarantee the call of the hook routines on ASIL level. There </p>
<p>is no safety requirement which assures that the hooks are correctly called (at </p>
<p>correct time, in correct context etc.). [SPMF92:0101] </p>
<p> </p>
<p><i>Timing Hooks </i></p>
<p>Calling OS API functions in OS_VTH* hooks is not allowed. [SPMF92:0102] </p>
<p> </p>
<p><i>Timing Hooks </i></p>
<p>Usage of OS variables in OS_VTH* hooks is dangerous as they may not be </p>
<p>consistent. [SPMF92:0103] </p>
<p> </p>
<p><i>Timing Hooks </i></p>
<p>Mind that the CAT1 ISRs may interrupt the hook routines which may cause </p>
<p>concurrent calls. [SPMF92:0104] </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>79 </p>
<p>based on template version 2.0 </p>
<p><b>11 </b></p>
<p><b>Hardware Specific Part </b></p>
<p>For RH850 SafeContext the following safety relevant requirements must be checked by the user: </p>
<p></p>
<p> </p>
<p>All assembly code (outside the SafeContext) shall be reviewed, not to change the content </p>
<p>of registers of R4 and R5 after StartOS is called  [SPMF92:04.0001]. Check in compiler list </p>
<p>files that only the startup module and the OS modules do modify registers R4 and R5. </p>
<p></p>
<p> </p>
<p>The user has to review that each ISR is called at least once (coverage of application). The </p>
<p>tests shall cover the activation of all ISRs and verify that the correct ISR was started. This </p>
<p>measure  shall  prevent  the  activation  of  wrong ISRs  because  of  a mix up  in the  interrupt </p>
<p>vector table [SPMF92:0008]. </p>
<p></p>
<p> </p>
<p>The user has to review the configuration by means of the ConfigBlock in accordance to the </p>
<p>review rules which are defined in chapter 12.2 [SPMF92:0014],[SPMF92:05.0008]. </p>
<p></p>
<p> </p>
<p>The user has to review that all libraries fit to the used compiler options. All used libraries </p>
<p>need  to  be  checked  for  using  the  correct  compiler  options  (e.g.  SDA  usage  need  to  be </p>
<p>identical to the specified options for the OS) [SPMF92:0010]. </p>
<p></p>
<p> </p>
<p>The  PreTaskHook  and  the  PostTaskHook  must  not  be  used  in  safety  code  which  is </p>
<p>released for serial production. Pre/PostTaskHook shall only be used for debugging or test </p>
<p>purposes. </p>
<p>Absence </p>
<p>of </p>
<p>Pre/PostTaskHook </p>
<p>must </p>
<p>be </p>
<p>reviewed </p>
<p>in </p>
<p>generated </p>
<p>file </p>
<p>tcb.h: </p>
<p>[SPMF92:02.0022],[SPMF92:02.0023],[SPMF92:05.0011] </p>
<p>The user must check that the following defines are set in the generated file tcb.h: </p>
<p><b>#define osdPreTaskHook  0 </b></p>
<p><b>#define osdPostTaskHook 0 </b></p>
<p></p>
<p> </p>
<p>The  complete  config  block  content  must  be  reviewed  by  the  means  of  the  BackReader </p>
<p>[SPMF92:04.0002], [SPMF92:04.0006]. </p>
<p></p>
<p> </p>
<p>The address value of the application specific linker symbols for MPU region start and end </p>
<p>address  must  be  checked  that  between  them  only  the  corresponding  application  data </p>
<p>sections are mapped [SPMF92:04.0004], [SPMF92:04.0010], [SPMF92:04.0011]. </p>
<p></p>
<p> </p>
<p>The </p>
<p>address </p>
<p>value </p>
<p>of </p>
<p>the </p>
<p>linker </p>
<p>symbols </p>
<p>_osGlobalShared_StartAddr </p>
<p>and </p>
<p>_osGlobalShared_EndAddr  must  be  checked  that  between  them  only  the  global  shared </p>
<p>data sections are mapped [SPMF92:04.0013]. </p>
<p></p>
<p> </p>
<p>The CPU must run in supervisor mode when StartOS is called [SPMF92:04.0007]. </p>
<p></p>
<p> </p>
<p>The </p>
<p>application </p>
<p>shall </p>
<p>check </p>
<p>the </p>
<p>config </p>
<p>block </p>
<p>version </p>
<p>by </p>
<p>using </p>
<p>OS </p>
<p>API </p>
<p>function </p>
<p>osGetConfigBlockVersion [SPMF92:0045], [SPMF92:04.0003] </p>
<p></p>
<p> </p>
<p>The user has to review that all task stacks, all ISR stacks and the system stack have 4 Byte </p>
<p>alignments [SPMF92:04.0008]. </p>
<p></p>
<p> </p>
<p>The user has to review the generated linker include files osdata.dld, osrom.dld, ossdata.dld </p>
<p>osstacks.dld and ostdata.dld if they are used for serial production [SPMF92:04.0014]. See </p>
<p>chapter 11.3. </p>
<p></p>
<p> </p>
<p>The user has to review that coverage is disabled [SPMF92:04.0015]. osdEnableCoverage </p>
<p>shall  not  be  defined  in  header  and  source  files  and  it  shall  not  be  defined  via  compiler </p>
<p>option –DosdEnableCoverage. </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>80 </p>
<p>based on template version 2.0 </p>
<p></p>
<p> </p>
<p>The user has to consider DMA controller usage if the used RH850 derivative incorporates a </p>
<p>DMA controller (DMAC). The DMA controller has direct access to the data bus. Therefore </p>
<p>DMA  access  to  memory  is  not  controlled  by  MPU  protection.    This  must  be  considered </p>
<p>especially for safety OS systems if any DMA access is wanted. </p>
<p></p>
<p> </p>
<p>The user has to review that osInitialize and osInitINTC are called before StartOS is called if </p>
<p>OS interrupt API functions or OS peripheral interrupt API functions are used before StartOS  </p>
<p>[SPMF92:0070]. </p>
<p></p>
<p> </p>
<p>The user has to review that all generated files belong together and that all generated files </p>
<p>are compiled and linked [SPMF92:0064]. The user shall not change any generated header </p>
<p>file (*.h) or source file (*.c).</p>
<p><i><b> </b></i></p>
<p></p>
<p> </p>
<p>The  user  has  to  check  that  the  application  does  not  modify  interrupt  controller  registers </p>
<p>EBASE, INTBP, INTCFG, SCBP and SCCFG after StartOS is called [SPMF92:0069]. </p>
<p></p>
<p> </p>
<p>The  application  shall  not  modify  any  register  in  interrupt  controller  unit  INTC  by  own </p>
<p>functions  or  routines  after  StartOS  is  called.  The  application  shall  only  use  the  OS API </p>
<p>functions for changing registers in unit INTC. [SPMF92:0083] </p>
<p></p>
<p> </p>
<p>The  user  has  to  check  validity  and  type  of  the  reference  parameter  when  calling  the </p>
<p>following OS API functions [SPMF92:05.0001]: </p>
<p>-  GetTaskID </p>
<p>-  GetTaskState </p>
<p>-  GetApplicationState </p>
<p>-  GetEvent </p>
<p>-  GetAlarm </p>
<p>-  GetScheduleTableStatus </p>
<p>-  GetCounterValue </p>
<p>-  GetElapsedValue </p>
<p>-  GetElapsedCounterValue </p>
<p></p>
<p> </p>
<p>The user has to assure that symbol <i>_osStartupStack_StartAddr </i>is provided in linker file and </p>
<p>points to the startup stack [SPMF92:05.0004]. </p>
<p></p>
<p> </p>
<p>User  has  to  review  that  osdTimerInterruptSourceNumberCore0  in  generated  file  tcb.h  is </p>
<p>equal to channel index of timer unit OSTM0 [SPMF92:05.0007]. </p>
<p></p>
<p> </p>
<p>User has to review in generated file tcb.c the content of  arrays &quot;oskGetCurrentTimeOps&quot; </p>
<p>and &quot;oskCounterId2GetCurrentTimeOpIdx&quot; [SPMF92:05.0016]. </p>
<p></p>
<p> </p>
<p>User </p>
<p>has </p>
<p>to </p>
<p>review </p>
<p>in </p>
<p>generated </p>
<p>file </p>
<p>tcb.c </p>
<p>the </p>
<p>arrays </p>
<p>&quot;oskInsertMinHeapOps&quot; </p>
<p>and </p>
<p>&quot;oskCounterId2InsertMinHeapOpIdx&quot; [SPMF92:05.0017]. </p>
<p></p>
<p> </p>
<p>The user has to check that the application does not modify CPU core register PMR after </p>
<p>StartOS is called [SPMF92:04.0018]. </p>
<p></p>
<p> </p>
<p>If  High  Resolution  Timer  is  used  as  SystemTimer  then  the  user  has  to  review  that  the </p>
<p>following  defines  exists  in  tcbpost.h  and  that  HiResSystemTimer  is  defined  smaller  than </p>
<p>osdNumberOfCounters [SPMF92:05.0018]: </p>
<p>#define HiResSystemTimer             &lt;x&gt; </p>
<p>#define osdTimerOSTM_HIRESID  HiResSystemTimer </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>81 </p>
<p>based on template version 2.0 </p>
<p></p>
<p> </p>
<p>If Standard Timer is used as SystemTimer then the user has to review that the following </p>
<p>defines </p>
<p>exists </p>
<p>in </p>
<p>tcbpost.h </p>
<p>and </p>
<p>that </p>
<p>SystemTimer </p>
<p>is </p>
<p>defined </p>
<p>smaller </p>
<p>than </p>
<p>osdNumberOfCounters [SPMF92:05.0019]: </p>
<p>#define SystemTimer       &lt;x&gt; </p>
<p>#define osdTimerOSTM   SystemTimer </p>
<p></p>
<p> </p>
<p>The </p>
<p>user </p>
<p>has </p>
<p>to </p>
<p>review </p>
<p>in </p>
<p>the </p>
<p>generated </p>
<p>file </p>
<p>tcb.c </p>
<p>that </p>
<p>the </p>
<p>size </p>
<p>of </p>
<p>the </p>
<p>array </p>
<p>oskAlarmHeapSize is equal to osdNumberOfCounters. Furthermore, the user has to review </p>
<p>that each entry must be equal to 1 + the number of alarms that are related to the counter </p>
<p>&lt;CounterName&gt; </p>
<p>+ </p>
<p>the </p>
<p>number </p>
<p>of </p>
<p>schedule </p>
<p>tables </p>
<p>that </p>
<p>are </p>
<p>related </p>
<p>to </p>
<p>the </p>
<p>counter </p>
<p>&lt;CounterName&gt;. The counter osSystemSWCounter is the only exception to this rule. This </p>
<p>counter must always exist and the related array element must be one. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>82 </p>
<p>based on template version 2.0 </p>
<p><b>11.1 </b></p>
<p><b>Interrupt Vector Table </b></p>
<p>Basically the interrupt vector tables must be provided by the application. An example vector table is </p>
<p>generated  into file  intvect_c&lt;CoreID&gt;.c. This file  is  generated  by  QM  software  and must  not  be </p>
<p>used directly as ASIL code. It must be reviewed carefully for compliance to the description below </p>
<p>because  the  code  which  is  called  by  the  interrupt  vector  table  runs  automatically  in  supervisor </p>
<p>mode  and  therefore  this  code  must  be  developed  according  to  ASIL  level </p>
<p>[SPMF92:0004], </p>
<p>[SPMF92:02.0020], [SPMF92:02.0021], [SPMF92:04.0012]. </p>
<p>The file intvect_c&lt;CoreID&gt;.c consists of the following parts: </p>
<p></p>
<p> </p>
<p>Header Include Section </p>
<p></p>
<p> </p>
<p>Core Exception Vector Table </p>
<p></p>
<p> </p>
<p>EIINT Vector Table </p>
<p></p>
<p> </p>
<p>CAT2 ISR Wrappers </p>
<p>The following subchapters describe these parts and do intentionally not describe any comments. </p>
<p> </p>
<p><b>11.1.1 Header Include Section </b></p>
<p>Generated file intvect_c&lt;CoreID&gt;.c starts exactly with the following lines: </p>
<p> </p>
<p><b>#if defined USE_QUOTE_INCLUDES </b></p>
<p><b> #include &quot;vrm.h&quot; </b></p>
<p><b>#else </b></p>
<p><b> #include &lt;vrm.h&gt; </b></p>
<p><b>#endif </b></p>
<p><b> </b></p>
<p><b>#define osdVrmGenMajRelNum 1 </b></p>
<p><b>#define osdVrmGenMinRelNum 6 </b></p>
<p><b>#if defined USE_QUOTE_INCLUDES </b></p>
<p><b> #include &quot;vrm.h&quot; </b></p>
<p><b>#else </b></p>
<p><b> #include &lt;vrm.h&gt; </b></p>
<p><b>#endif </b></p>
<p><b> </b></p>
<p><b>#if defined USE_QUOTE_INCLUDES </b></p>
<p><b> #include &quot;Os.h&quot; </b></p>
<p><b>#else </b></p>
<p><b> #include &lt;Os.h&gt; </b></p>
<p><b>#endif </b></p>
<p><b> </b></p>
<p><b>#if defined USE_QUOTE_INCLUDES </b></p>
<p><b> #include &quot;osekext.h&quot; </b></p>
<p><b>#else </b></p>
<p><b> #include &lt;osekext.h&gt; </b></p>
<p><b>#endif </b></p>
<p><b> </b></p>
<p><b>#ifndef osdNOASM </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>83 </p>
<p>based on template version 2.0 </p>
<p><b>11.1.2 Core Exception Vector Table </b></p>
<p>The core exception vector table section looks exactly like the following lines: </p>
<p><b>#pragma asm  </b></p>
<p><b> </b></p>
<p><b>   .section &quot;.osExceptionVectorTable_c0&quot;, &quot;ax&quot; </b></p>
<p><b>   .align 512 </b></p>
<p><b> </b></p>
<p><b>   .globl _osExceptionVectorTable_c0 </b></p>
<p><b>_osExceptionVectorTable_c0: </b></p>
<p> </p>
<p><b>   .offset 0x0000 </b></p>
<p><b>   .globl  _osCoreException_c0_0x0000 </b></p>
<p><b>_osCoreException_c0_0x0000: </b></p>
<p><b>   jr &lt;interrupt_handler_0&gt; </b></p>
<p><b> </b></p>
<p><b>   .offset 0x0010 </b></p>
<p><b>   .globl  _osCoreException_c0_0x0010 </b></p>
<p><b>_osCoreException_c0_0x0010: </b></p>
<p><b>   jr &lt;interrupt_handler_1&gt; </b></p>
<p><b> </b></p>
<p><b>   .offset 0x0020 </b></p>
<p><b>   .globl  _osCoreException_c0_0x0020 </b></p>
<p><b>_osCoreException_c0_0x0020: </b></p>
<p><b>   jr &lt;interrupt_handler_2&gt; </b></p>
<p><b> </b></p>
<p><b>... </b></p>
<p><b> </b></p>
<p><b>   .offset 0x01F0 </b></p>
<p><b>   .globl  _osCoreException_c0_0x01F0 </b></p>
<p><b>_osCoreException_c0_0x01F0: </b></p>
<p><b>   jr &lt;interrupt_handler_23&gt; </b></p>
<p><b> </b></p>
<p>   <b>.globl _osExceptionVectorTableEnd_c0 </b></p>
<p><b>_osExceptionVectorTableEnd_c0:</b> </p>
<p> </p>
<p><b>#pragma endasm</b> </p>
<p><b> </b></p>
<p><b> </b></p>
<p>The sequence of core exception vector table entries starts at vector address 0x0000, increases in </p>
<p>steps of 0x0010 and ends with vector address 0x01F0. </p>
<p>&lt;interrupt_handler_x&gt; is the name of the handler which is called when an exception occurs.  </p>
<p>If no specific handler is configured then osUnhandledCoreException is called: </p>
<p>example for unused interrupt source </p>
<p><b>   .offset 0x0010 </b></p>
<p><b>   .globl  _osCoreException_c0_0x0010 </b></p>
<p><b>_osCoreException_c0_0x0010: </b></p>
<p><b>   jr  _osUnhandledCoreException </b></p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>84 </p>
<p>based on template version 2.0 </p>
<p><b>11.1.3 EIINT Vector Table </b></p>
<p>The EIINT vector table section starts exactly with the following lines: </p>
<p><b>#pragma asm</b> </p>
<p> </p>
<p><b>   .section &quot;.osEIINTVectorTable_c0&quot;, &quot;ax&quot; </b></p>
<p><b>   .align 512 </b></p>
<p><b> </b></p>
<p><b>   .globl _osEIINTVectorTable_c0 </b></p>
<p><b>_osEIINTVectorTable_c0: </b></p>
<p><b> </b></p>
<p><b>.word  _&lt;EIINT_handler_0&gt; </b></p>
<p><b>.word  _&lt;EIINT_handler_1&gt; </b></p>
<p><b>.word  _&lt;EIINT_handler_2&gt; </b></p>
<p><b>... </b></p>
<p><b>.word  _&lt;EIINT_handler_x&gt; </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p>For each unused interrupt source the following table entry must be generated: </p>
<p><b>.word  _osUnhandledEIINTException </b></p>
<p> </p>
<p>For each interrupt source used as category 1 ISR the following table entry must be generated: </p>
<p><b>.word  _&lt;Cat1_EIINT_handler&gt; </b></p>
<p>&lt;Cat1_EIINT_handler&gt; is the name of the application specific EIINT handler which is called when </p>
<p>an interrupt on the corresponding source occurs. </p>
<p> </p>
<p>For each interrupt source used as category 2 ISR the following table entry must be generated: </p>
<p><b>.word  _&lt;Cat2_ISR_Name&gt;_CAT2 </b></p>
<p>&lt;Cat2_EIINT_handler&gt; is the name of the OS ISR wrapper which is called when an interrupt on </p>
<p>the corresponding source occurs. The CAT2 ISR wrapper section is described in the next chapter. </p>
<p> </p>
<p>The EIINT vector table section ends exactly with the following lines: </p>
<p><b>   .globl _osEIINTVectorTableEnd_c0 </b></p>
<p><b>_osEIINTVectorTableEnd_c0:</b> </p>
<p> </p>
<p><b>#pragma endasm</b> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>85 </p>
<p>based on template version 2.0 </p>
<p><b>11.1.4 CAT2 ISR Wrappers </b></p>
<p>The category 2 ISR wrapper section looks exactly like the following lines: </p>
<p><b>#pragma asm </b></p>
<p><b> </b></p>
<p><b>   .section &quot;.os_text&quot;, &quot;ax&quot; </b></p>
<p><b> </b></p>
<p><b>   osCAT2ISRC0(...) </b></p>
<p><b> </b></p>
<p><b>   osCAT2ISRC0(...) </b></p>
<p><b> </b></p>
<p><b>   osCAT2ISRC0(...) </b></p>
<p><b> </b></p>
<p><b>   ...     </b></p>
<p><b> </b></p>
<p><b>   osCAT2ISRC0(...) </b></p>
<p><b> </b></p>
<p><b>#pragma endasm </b></p>
<p> </p>
<p> </p>
<p>Each category 2 ISR handler must be generated exactly like the following line [SPMF92:0044]: </p>
<p><b>osCAT2ISRC0(&lt;Cat2_ISR_Name&gt;, &lt;Cat2_ISR_Priority) </b></p>
<p> </p>
<p>Macro osCAT2ISRC0() is defined in osekext.h. </p>
<p>It defines the CAT2 ISR prologue for each interrupt source which is used as category 2 ISR. </p>
<p>&lt;Cat2_ISR_Name&gt; is the unique name of the ISR function. This must be the same name as used </p>
<p>in the EIINT vector table at the corresponding channel index position with postfix: </p>
<p><b>.word  _&lt;Cat2_ISR_Name&gt;_CAT2 </b></p>
<p> </p>
<p>&lt;Cat2_ISR_Priority&gt; </p>
<p>is </p>
<p>the </p>
<p>value </p>
<p>of </p>
<p>the </p>
<p>interrupt </p>
<p>priority </p>
<p>level </p>
<p>which </p>
<p>is </p>
<p>configured </p>
<p>for </p>
<p>the </p>
<p>corresponding ISR. The valid range of &lt;Cat2_ISR_Priority&gt; is 0 ... 7 </p>
<p> </p>
<p><b>11.1.5  End of file Intvect_c&lt;CoreID&gt;.c </b></p>
<p>Generated file intvect_c&lt;CoreID&gt;.c ends exactly with the following line: </p>
<p><b>#endif /* ifndef osdNOASM */ </b></p>
<p> </p>
<p><b> </b></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>86 </p>
<p>based on template version 2.0 </p>
<p><b>11.2 </b></p>
<p><b>Linker Memory Sections </b></p>
<p>The OS uses specific memory section names for the linker. Check that these section names are </p>
<p>used in the linker file and check that they are used in the assigned area. </p>
<p>The OS uses the linker memory section names described in the following table: </p>
<p><b>Section Name and Type </b></p>
<p><b>Description and Link Requirements </b></p>
<p>.osExceptionVectorTable</p>
<p><b>_c&lt;CoreID&gt;</b></p>
<p> </p>
<p>section type .text </p>
<p>Contains the core exception vector table. It is generated </p>
<p>into file intvect_c&lt;CoreID&gt;.c </p>
<p>.osEIINTVectorTable</p>
<p><b>_c&lt;CoreID&gt;</b></p>
<p> </p>
<p>section type .text </p>
<p>Contains the EIINT exception vector table. It is generated </p>
<p>into file intvect_c&lt;CoreID&gt;.c </p>
<p>.os_text </p>
<p>section type .text </p>
<p>Contains the interrupt handler for category 2 ISRs. It is </p>
<p>generated into file intvect_c&lt;CoreID&gt;.c </p>
<p>Must be linked to program code section. </p>
<p>.os_text </p>
<p>section type .text </p>
<p>Contains all OS program code, except those which must </p>
<p>be placed in special sections (e.g. vector table). </p>
<p>Must be linked to program code section. </p>
<p>.os_rodata </p>
<p>section type .rodata </p>
<p>Contains the OS constant data, except those which must </p>
<p>be placed in special sections (e.g. configuration block </p>
<p>osConfigBlock). </p>
<p>Must be linked to constant data section. </p>
<p>.os_rosdata </p>
<p>section type .rosdata </p>
<p>Contains all OS constants which are placed in ROSDA </p>
<p>area, except those which must be placed in special </p>
<p>sections (e.g. configuration block osConfigBlock). </p>
<p>Must be linked to the constant data in ROSDA section </p>
<p>.osConfigBlock_rodata </p>
<p>section type .rodata </p>
<p>Contains the configuration block if SDA optimization is </p>
<p>disabled. </p>
<p>Must be linked to constant data section. </p>
<p>.osConfigBlock_rosdata </p>
<p>section type .rosdata </p>
<p>Contains the configuration block if SDA optimization is </p>
<p>enabled </p>
<p>Must be linked to constant data in ROSDA section. </p>
<p>.os_bss </p>
<p>section type .bss </p>
<p>Contains the uninitialized OS variables </p>
<p>Optional initialized to zero by system startup code. </p>
<p>Must be linked to the data section. </p>
<p>.os_data </p>
<p>section type .data </p>
<p>Contains the initialized OS variables which must be </p>
<p>copied from ROM to RAM by system startup code.  </p>
<p>Must be linked to the data section. This section must be </p>
<p>empty! </p>
<p>.os_sbss </p>
<p>section type .sbss </p>
<p>Contains uninitialized OS variables which are placed in </p>
<p>SDA area if SDA optimization is enabled. </p>
<p>Optional initialized to zero by system startup code. </p>
<p>Must be linked to the SDA section. </p>
<p>.os_sdata </p>
<p>section type .sdata </p>
<p>Contains initialized OS variables which are placed in SDA </p>
<p>area if SDA optimization is enabled. </p>
<p>Must be linked to the SDA section. This section must be </p>
<p>empty! </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>87 </p>
<p>based on template version 2.0 </p>
<p><b>Section Name and Type </b></p>
<p><b>Description and Link Requirements </b></p>
<p>.osTaskStack&lt;TaskIndex&gt; </p>
<p>section type .bss </p>
<p>Contains the uninitialized task specific stack. </p>
<p>Must be linked to the data section. </p>
<p>.osSystemStack</p>
<p><b>_c&lt;CoreID&gt;</b></p>
<p> </p>
<p>section type .bss </p>
<p>Contains the uninitialized OS system stack. </p>
<p>Must be linked to the data section. </p>
<p>.osIntStackLevel&lt;Priority&gt; </p>
<p>section type .bss </p>
<p>Contains the uninitialized ISR specific stack. </p>
<p>Must be linked to the data section. </p>
<p>.osAppl_&lt;ApplName&gt;_bss </p>
<p>section type .bss </p>
<p>Contains uninitialized application data. </p>
<p>Optional initialized to zero by system startup code. </p>
<p>Must be linked to the data section. </p>
<p>.osAppl_&lt;ApplName&gt;_sbss </p>
<p>section type .sbss </p>
<p>Contains uninitialized application data in SDA area if SDA </p>
<p>optimization is enabled. </p>
<p>Optional initialized to zero by system startup code. </p>
<p>Must be linked to SDA section. </p>
<p>.osAppl_&lt;ApplName&gt;_data </p>
<p>section type .data </p>
<p>Contains initialized application data. </p>
<p>Must be linked to data section. </p>
<p>.osAppl_&lt;ApplName&gt;_sdata </p>
<p>section type .sdata </p>
<p>Contains initialized application data in SDA area if SDA </p>
<p>optimization is enabled. </p>
<p>Must be linked to SDA section. </p>
<p>.osGlobalShared_bss </p>
<p>section type .bss </p>
<p>Contains uninitialized global shared data. </p>
<p>Optional initialized to zero by system startup code. </p>
<p>Must be linked to data section. </p>
<p>.osGlobalShared_sbss </p>
<p>section type .sbss </p>
<p>Contains uninitialized shared data in SDA area if SDA </p>
<p>optimization is enabled. </p>
<p>Optional initialized to zero by system startup code. </p>
<p>Must be linked to SDA section. </p>
<p>.osGlobalShared_data </p>
<p>section type .data </p>
<p>Contains initialized shared global data. </p>
<p>Must be linked to data section. </p>
<p>.osGlobalShared_sdata </p>
<p>section type .sdata </p>
<p>Contains initialized shared data in SDA area if SDA </p>
<p>optimization is enabled. </p>
<p>Must be linked to SDA section. </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>88 </p>
<p>based on template version 2.0 </p>
<p><b>11.3 </b></p>
<p><b>Linker Include Files </b></p>
<p>The generated linker include files shall be reviewed if they are used for serial production.  </p>
<p> </p>
<p><b>11.3.1 Review File osdata.dld </b></p>
<p>File osdata.dld contains mapping of section types .bss and .data for trusted applications. </p>
<p> </p>
<p>For each trusted application the generated lines must look like: </p>
<p><b>/* trusted application &lt;ApplName&gt; */ </b></p>
<p><b>.osAppl_&lt;ApplName&gt;_bss   align(4) :&gt;. </b></p>
<p><b>.osAppl_&lt;ApplName&gt;_data  align(4) :&gt;. </b></p>
<p><b> </b></p>
<p>The linker include file ends with the section mapping for OS data which must look like: </p>
<p><b>.os_bss    align(4) :&gt;. </b></p>
<p><b>.os_data   align(4) :&gt;. </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>89 </p>
<p>based on template version 2.0 </p>
<p><b>11.3.2 Review File ossdata.dld </b></p>
<p> </p>
<p>The generated example file ossdata.dld contains the mapping of section types .sbss and </p>
<p>.sdata for trusted and non-trusted applications. </p>
<p>For non-trusted applications it also contains the mapping of section types .bss and .data.  </p>
<p>This is necessary due to optimization for MPU region settings. </p>
<p> </p>
<p>For each trusted application the generated lines must look like: </p>
<p><b>/* trusted application &lt;ApplName&gt; */ </b></p>
<p><b>.osAppl_&lt;ApplName&gt;_sbss        align(4) :&gt;. </b></p>
<p><b>.osAppl_&lt;ApplName&gt;_sdata       align(4) :&gt;. </b></p>
<p><b> </b></p>
<p>For each non-trusted application the generated lines must look like: </p>
<p><b>/* non-trusted application &lt;ApplName&gt; */ </b></p>
<p><b>.osAppl_&lt;ApplName&gt;_bss         align(4) :&gt;. </b></p>
<p><b>.osAppl_&lt;ApplName&gt;_data        align(4) :&gt;. </b></p>
<p><b>.osAppl_&lt;ApplName&gt;_sbss        align(4) :&gt;. </b></p>
<p><b>.osAppl_&lt;ApplName&gt;_sdata       align(4) :&gt;. </b></p>
<p><b>_&lt;Appl_Section_StartAddr&gt; = addr(.osAppl_&lt;ApplName&gt;_bss); </b></p>
<p><b>_&lt;Appl_Section_EndAddr&gt;   = endaddr(.osAppl_&lt;ApplName&gt;_sdata)-1; </b></p>
<p><b> </b></p>
<p>After the mapping of the application sections the mapping for OS SDA sections must be </p>
<p>generated like the following lines: </p>
<p><b>.os_sbss    align(4) :&gt;. </b></p>
<p><b>.os_sdata   align(4) :&gt;. </b></p>
<p><b> </b></p>
<p>After the mapping of the OS SDA sections the mapping for global shared sections must be </p>
<p>generated like the following lines: </p>
<p><b>.osGlobalShared_sbss    align(4) :&gt;. </b></p>
<p><b>.osGlobalShared_sdata   align(4) :&gt;. </b></p>
<p><b>.osGlobalShared_bss     align(4) :&gt;. </b></p>
<p><b>.osGlobalShared_data    align(4) :&gt;. </b></p>
<p><b>_osGlobalShared_StartAddr = addr(.osGlobalShared_sbss); </b></p>
<p><b>_osGlobalShared_EndAddr   = endaddr(.osGlobalShared_data)-1; </b></p>
<p><b> </b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>90 </p>
<p>based on template version 2.0 </p>
<p><b>11.3.3 Review File osstacks.dld </b></p>
<p>File osstacks.dld contains mapping of all stack sections. </p>
<p> </p>
<p>Each stack section mapping for used interrupt priority levels must look like: </p>
<p><b>.osIntStackLevel&lt;PrioLevel&gt; align(4) :&gt;. </b></p>
<p><b>_osIntStackLevel&lt;PrioLevel&gt;_StartAddr = addr(.osIntStackLevel&lt;PrioLevel&gt;); </b></p>
<p><b>_osIntStackLevel&lt;PrioLevel&gt;_EndAddr = endaddr(.osIntStackLevel&lt;PrioLevel&gt;); </b></p>
<p> </p>
<p>&lt;PrioLevel&gt; is the interrupt priority level 0 … 15 </p>
<p> </p>
<p>The mapping for the system stack section must look like: </p>
<p><b>.osSystemStack align(4)  :&gt;. </b></p>
<p><b>_osSystemStack_StartAddr = addr(.osSystemStack); </b></p>
<p><b>_osSystemStack_EndAddr = endaddr(.osSystemStack); </b></p>
<p><b> </b></p>
<p>The system stack section is followed by the OS task stack sections which must look like: </p>
<p> </p>
<p><b>.osTaskStackosSystemApplicationCore00 align(4) :&gt;. </b></p>
<p><b>_osTaskStackosSystemApplicationCore00_StartAddr = </b></p>
<p><b>  addr(.osTaskStackosSystemApplicationCore00); </b></p>
<p><b>_osTaskStackosSystemApplicationCore00_EndAddr = </b></p>
<p><b>endaddr(.osTaskStackosSystemApplicationCore00); </b></p>
<p><b> </b></p>
<p><b>.osTaskStackosSystemApplicationCore01 align(4) :&gt;. </b></p>
<p><b>_osTaskStackosSystemApplicationCore01_StartAddr = </b></p>
<p><b>addr(.osTaskStackosSystemApplicationCore01); </b></p>
<p><b>_osTaskStackosSystemApplicationCore01_EndAddr = </b></p>
<p><b>endaddr(.osTaskStackosSystemApplicationCore01); </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p>The OS task stack sections are followed by the application task stack sections. </p>
<p>Each application task stack section mapping must look like: </p>
<p><b>.osTaskStack&lt;applname&gt;&lt;index&gt;  align(4)  :&gt;. </b></p>
<p><b>_osTaskStack&lt;applname&gt;&lt;index&gt;_StartAddr = addr(.osTaskStack&lt;applname&gt;&lt;index&gt;); </b></p>
<p><b>_osTaskStack&lt;applname&gt;&lt;index&gt;_EndAddr = endaddr(.osTaskStack&lt;applname&gt;&lt;index&gt;); </b></p>
<p><b> </b></p>
<p>&lt;applname&gt; is the name of the owner application </p>
<p>&lt;index&gt; is the index number of the task stack: 0 … number of tasks per application </p>
<p><b> </b></p>
<p><b> </b></p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>91 </p>
<p>based on template version 2.0 </p>
<p><b>11.3.4 Review File osrom.dld </b></p>
<p>File osrom.dld contains the sections used for initialized variables.  </p>
<p> </p>
<p>For each application which has data to be initialized during startup code the following lines must be </p>
<p>generated: </p>
<p><b>.ROM_osAppl_&lt;ApplName&gt;_data   ROM(.osAppl_&lt;ApplName&gt;_data)  :&gt;. </b></p>
<p><b>.ROM_osAppl_&lt;ApplName&gt;_sdata  ROM(.osAppl_&lt;ApplName&gt;_sdata) :&gt;. </b></p>
<p><b>.ROM_osAppl_&lt;ApplName&gt;_tdata  ROM(.osAppl_&lt;ApplName&gt;_tdata) :&gt;. </b></p>
<p><b> </b></p>
<p>File osrom.dld ends with the global shared initialized data sections which must look like: </p>
<p><b>.ROM_GlobalShared_data   ROM(.osGlobalShared_data)  :&gt;. </b></p>
<p><b>.ROM_GlobalShared_sdata  ROM(.osGlobalShared_sdata) :&gt;. </b></p>
<p><b>.ROM_GlobalShared_tdata  ROM(.osGlobalShared_tdata) :&gt;. </b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>11.3.5 Review File ostdata.dld </b></p>
<p>File ostada.dld contains the mapping for application data in TDA section. </p>
<p> </p>
<p>For each application which has data in TDA section the following line must be generated: </p>
<p><b>.osAppl_&lt;ApplName&gt;_tdata  align(4) MAX_SIZE(0x0100) :&gt;. </b></p>
<p> </p>
<p>File ostdata.dld ends with the mapping for global shared data in TDA section which must look like: </p>
<p><b>.osGlobalShared_tdata  align(4) MAX_SIZE(0x0100) :&gt;. </b></p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>92 </p>
<p>based on template version 2.0 </p>
<p><b>11.4 </b></p>
<p><b>Stack Size Configuration </b></p>
<p>The size of task stacks, ISR stacks and the system stack is configured by the user. The application </p>
<p>code  must  not  use  more  stack  then  configured.  Before  trusted  or  non-trusted  application  code </p>
<p>(tasks,  ISRs,  trusted  and  non-trusted  functions)  is  executed  the  OS  always  reprogramms  MPU </p>
<p>region 0 in order to protect the stack memory areas. </p>
<p>The following table provides an overview of the stacks and which code parts need to be considered </p>
<p>for the analysis of the required stack sizes. </p>
<p><b>Stack </b></p>
<p><b>Usage </b></p>
<p>System Stack </p>
<p>StartupHook </p>
<p>ErrorHook </p>
<p>ProtectionHook [SPMF92:0082] </p>
<p>ShutdownHook [SPMF92:0081] </p>
<p>Task Stacks </p>
<p>the corresponding task function and its call tree </p>
<p>ISRs of category 1 (when interrupting a task) </p>
<p>ErrorHook </p>
<p>Storing a context (144 Byte) </p>
<p>ISR Stacks </p>
<p>the corresponding category 2 ISR function and its call tree </p>
<p>ISRs of category 1 (when interrupting an ISR) </p>
<p>ErrorHook </p>
<p>Storing a context (144 Byte) </p>
<p> </p>
<p>If  no  static  analysis  for  the  stack  requirement  is  made,  the  stack  usage  may  be  measured  by </p>
<p>means </p>
<p>of </p>
<p>the </p>
<p>API </p>
<p>functions </p>
<p>osGetStackUsage, </p>
<p>osGetISRStackUsage </p>
<p>and </p>
<p>osGetSystemStackUsage,  when  StackUsageMeasurement  is  configured.  Measurement  has  to </p>
<p>consider  the  maximum  stack  usage  of  the  code  under  measure.  It  has  to  be  ensured,  that  all </p>
<p>directly and indirectly called functions are executed and use the maximum possible stack. </p>
<p>Stack  Usage  measurement  is  implemented  by  filling  the  stack  with  a  pattern  on  startup  and </p>
<p>counting the number of continuous patterns which have not been overwritten with another value. </p>
<p>This may lead to a too small measured value in case the function under measure uses this pattern </p>
<p>as value on its stack. </p>
<p>As the hardware allows to enable interrupts even in non-trusted code, any non-trusted ISR may </p>
<p>enable  nesting.  Therefore,  the  user  shall  expect  that  interrupt  nesting  can  always  occur  when </p>
<p>defining the system stack size [SPMF92:0089]. </p>
<p>The </p>
<p>stack </p>
<p>usage </p>
<p>must </p>
<p>be </p>
<p>measured </p>
<p>after </p>
<p>the </p>
<p>maximum </p>
<p>call </p>
<p>depth </p>
<p>has </p>
<p>been </p>
<p>reached </p>
<p>[SPMF92:0090]. </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>93 </p>
<p>based on template version 2.0 </p>
<p><b>11.5 </b></p>
<p><b>Stack Monitoring </b></p>
<p>The stack memory area is write protected via MPU region 0. Trusted and non-trusted applications </p>
<p>and the OS cannot write to stack areas which belong to other applications. </p>
<p>This  hardware  based  stack  monitoring  does  not  detect  all  stack  errors  [SPMF92:0076].  Stack </p>
<p>overflow </p>
<p>cannot </p>
<p>be </p>
<p>detected </p>
<p>if </p>
<p>the </p>
<p>task </p>
<p>or </p>
<p>ISR </p>
<p>stack </p>
<p>is </p>
<p>mapped </p>
<p>immediately </p>
<p>after </p>
<p>the </p>
<p>corresponding application data or global shared section. Stack underflow cannot be detected if the </p>
<p>task  or  ISR  stack  is  mapped  immediately  before  the  corresponding  application  data  or  global </p>
<p>shared section. </p>
<p>On  derivatives  with  MPU  inactive  in  privileged  mode  all  OS API  functions  are  executed  on  the </p>
<p>stack of caller without memory protection. [SPMF92:04.0020{!MPUPRIVMODE}] </p>
<p> </p>
<p><b>11.6 </b></p>
<p><b>Usage of MPU Regions </b></p>
<p>MPU region 0 is always used for stack area protection. It is always reprogrammed when </p>
<p>the context is switched. Therefore MPU region 0 cannot be configured by the user.  </p>
<p>Each MPU region 1 … 11 can be configured for static or dynamic usage: </p>
<p></p>
<p> </p>
<p>If a MPU region is configured for static usage, then it is initialized in StartOS and not </p>
<p>changed any more. For static MPU regions the user must specify the access attributes. </p>
<p></p>
<p> </p>
<p>If a MPU region is configured for dynamic usage, then it is initialized in StartOS and not </p>
<p>always reprogrammed when the context is switched. The access attributes for dynamic </p>
<p>MU regions are configured by the OS. </p>
<p>All stack sections must be mapped to a consecutive memory area. A static MPU region </p>
<p>must be configured for this memory area so that trusted and non-trusted application have </p>
<p>only read access to it. That means in supervisor and in user mode only reading is possible. </p>
<p>Write access to dedicated stack is achieved at runtime via reprogrammed MPU region 0 </p>
<p>when a task or ISR is started. </p>
<p>A static MPU region must be configured for the applications data area so that in supervisor </p>
<p>mode read and write is possible and in user mode only reading is possible. Write access to </p>
<p>the dedicated application data area is achieved via dynamic MPU region which must be </p>
<p>configured for each non-trusted application.  </p>
<p>A static MPU region must be configured for the code and const area (i.e. ROM/FLASH) so </p>
<p>that in supervisor mode (trusted applications) read, write and execute is possible and in </p>
<p>user mode (non-trusted applications) only read and execute is possible in that area. </p>
<p> </p>
<p><b>11.7 </b></p>
<p><b>Usage of Peripheral Interrupt API </b></p>
<p>The OS provides functions which allow write access to EI level interrupt control registers </p>
<p>EICn and to EI level interrupt mask registers IMRn in user mode. Non-trusted applications </p>
<p>can enable or disable peripheral interrupt sources by means of this functions. Call of the </p>
<p>OS peripheral interrupt API functions must be checked in every application that only valid </p>
<p>interrupt sources are modified [SPMF92:04.0016].  </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>94 </p>
<p>based on template version 2.0 </p>
<p><b>12 </b></p>
<p><b>Glossary and Abbreviations </b></p>
<p><b>12.1 </b></p>
<p><b>Glossary </b></p>
<p><b>Term </b></p>
<p><b>Description </b></p>
<p>OS-Application </p>
<p>An OS-Application is a set of tasks, ISRs and (Non-)Trusted Functions </p>
<p>with common peripheral/memory access rights and executing in the same </p>
<p>privilege mode. </p>
<p>Trusted software </p>
<p>Trusted application code is code which is executed with supervisor </p>
<p>privileges. The user has to ensure that this code does not interfere with </p>
<p>other components. Examples are start-up code, global Hook functions, </p>
<p>Tasks and ISRs which are configured to be part of a trusted OS </p>
<p>Application. </p>
<p>Non-trusted software </p>
<p>Defined by AUTOSAR specification: Part of a non-trusted application. </p>
<p>Non-trusted software is running with memory protection enabled and in </p>
<p>non-privileged mode. Therefore non-trusted software might be </p>
<p>implemented on QM level but ASIL software which does not need </p>
<p>unlimited memory access or privileged access can also be configured as </p>
<p>non-trusted. </p>
<p>Privileged mode </p>
<p>CPU mode with unlimited access to CPU system registers. Software </p>
<p>running in privileged mode is e.g. able to reconfigure the MPU and to </p>
<p>enable or disable interrupts. Therefore software running in privileged </p>
<p>mode must be implemented on ASIL level. </p>
<p>Non-privileged mode </p>
<p>CPU mode without or with limited access to CPU system registers. </p>
<p>Software running in privileged mode is not able to reconfigure the MPU or </p>
<p>to enable or disable interrupts. Therefore software running in privileged </p>
<p>mode might be implemented on QM level. </p>
<p>Silent principle </p>
<p>The idea of “Silent” code is not to disturb other software by means of </p>
<p>unintended memory writes. To provide high performance, this is not </p>
<p>achieved by a hardware protection mechanism (which would require MPU </p>
<p>reconfiguration for each API call) but by analysis of the OS code. </p>
<p>Table 12-1  </p>
<p>Glossary </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>95 </p>
<p>based on template version 2.0 </p>
<p> </p>
<p> </p>
<p><b>12.2 </b></p>
<p><b>Abbreviations </b></p>
<p><b>Abbreviation </b></p>
<p><b>Description </b></p>
<p>API </p>
<p>Application Programming Interface </p>
<p> </p>
<p>ASIL </p>
<p>Automotive Safety Integrity Level </p>
<p>AUTOSAR </p>
<p>Automotive Open System Architecture </p>
<p>BSW </p>
<p>Basis Software </p>
<p>CRC </p>
<p>Cyclic Redundancy Check </p>
<p>ECU </p>
<p>Electronic Control Unit </p>
<p>IRQ </p>
<p>Interrupt Request </p>
<p>ISR </p>
<p>Interrupt Service Routine </p>
<p>MICROSAR </p>
<p>Microcontroller Open System Architecture (the Vector AUTOSAR </p>
<p>solution) </p>
<p>MPU </p>
<p>Memory Protection Unit (realized in hardware by the processor) </p>
<p>MSSV </p>
<p>MICROSAR Safe Silence Verifier </p>
<p>ORTI </p>
<p>OSEK Run Time Interface </p>
<p>OS </p>
<p>Operating System </p>
<p>QM </p>
<p>Quality Management (used for software parts developed following only a </p>
<p>standard quality management process) </p>
<p>SC </p>
<p>Scalability Class (of AUTOSAR OS) </p>
<p>SEooC </p>
<p>Safety Element out of Context: a safety-related element which is not </p>
<p>developed for a specific item </p>
<p>Table 12-2  </p>
<p>Abbreviations </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p>MICROSAR OS SafeContext </p>
<p>Safety Manual </p>
<p>© 2016 Vector Informatik GmbH </p>
<p>Version 1.10 </p>
<p>96 </p>
<p>based on template version 2.0 </p>
<p><b>13 </b></p>
<p><b>Contact </b></p>
<p>Visit our website for more information on </p>
<p> </p>
<p><b>&gt; </b></p>
<p>News </p>
<p><b>&gt; </b></p>
<p>Products </p>
<p><b>&gt; </b></p>
<p>Demo software </p>
<p><b>&gt; </b></p>
<p>Support </p>
<p><b>&gt; </b></p>
<p>Training data </p>
<p><b>&gt; </b></p>
<p>Addresses </p>
<p><b>www.vector.com </b></p>
<p> </p>
<p>For support requests and issue notifications write to <b>osek-support@vector.com </b></p>
<p> </p>
<p> </p>
</body>
</html>
{% endraw %}