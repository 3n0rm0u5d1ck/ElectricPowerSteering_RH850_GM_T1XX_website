---
layout: default
title: AN-IND-8-003_GM_Support_in_CANoe_7.2
nav_order: 2
parent: Component Implementation
---
{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
     "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title></title>
  <meta name="generator" content="LibreOffice 24.2.7.2 (Linux)"/>
  <meta name="created" content="00:00:00"/>
  <meta name="changed" content="00:00:00"/>
</head>
<body>
<h1></h1>
<p><b> </b></p>
<p><b>GM Support in CANoe 7.2 </b></p>
<p><b>Version 2.1 </b></p>
<p><b>2010-02-23</b></p>
<p><b> </b></p>
<p><b> </b></p>
<p><b>Application Note AN-IND-8-003 </b></p>
<p> </p>
<p> </p>
<p><i> </i></p>
<p>Author(s) </p>
<p>Siegfried Beeh, Friederike Gengenbach </p>
<p>Restrictions </p>
<p>Customer Confidential: GM worldwide and GM suppliers  </p>
<p>Abstract </p>
<p>This application note explains the current stage of GM support in CANoe 7.2 and its </p>
<p>component Test Feature Set.</p>
<p> </p>
<p><i><b> </b></i></p>
<p><i><b>Table of Contents </b></i></p>
<p><i><b> </b></i></p>
<p><b> 1  </b></p>
<p><i>Copyright © 2010 - Vector Informatik GmbH </i></p>
<p><b>Contact Information:   www.vector.com   or ++49-711-80 670-0 </b></p>
<p>1.0</p>
<p> </p>
<p>Overview ..........................................................................................................................................................2</p>
<p> </p>
<p>1.1</p>
<p> </p>
<p>Introduction....................................................................................................................................................2</p>
<p> </p>
<p>1.2</p>
<p> </p>
<p>Terms and Abbreviations ..............................................................................................................................2</p>
<p> </p>
<p>2.0</p>
<p> </p>
<p>Basic Support in CANoe ..................................................................................................................................3</p>
<p> </p>
<p>2.1</p>
<p> </p>
<p>Trace Window ...............................................................................................................................................3</p>
<p> </p>
<p>2.2</p>
<p> </p>
<p>Logging..........................................................................................................................................................3</p>
<p> </p>
<p>2.3</p>
<p> </p>
<p>Export ............................................................................................................................................................3</p>
<p> </p>
<p>2.4</p>
<p> </p>
<p>Interactive Generator Block...........................................................................................................................3</p>
<p> </p>
<p>2.5</p>
<p> </p>
<p>Generator Block ............................................................................................................................................3</p>
<p> </p>
<p>2.6</p>
<p> </p>
<p>Symbol Selection Dialog ...............................................................................................................................3</p>
<p> </p>
<p>2.7</p>
<p> </p>
<p>Data Window .................................................................................................................................................5</p>
<p> </p>
<p>2.8</p>
<p> </p>
<p>Graphics Window ..........................................................................................................................................6</p>
<p> </p>
<p>2.9</p>
<p> </p>
<p>Panels............................................................................................................................................................6</p>
<p> </p>
<p>2.10</p>
<p> </p>
<p>CAPL .............................................................................................................................................................7</p>
<p> </p>
<p>3.0</p>
<p> </p>
<p>“GM Package” Modeling Package...................................................................................................................8</p>
<p> </p>
<p>3.1</p>
<p> </p>
<p>Model Generation..........................................................................................................................................8</p>
<p> </p>
<p>3.2</p>
<p> </p>
<p>Node Panels, Message Panels .....................................................................................................................8</p>
<p> </p>
<p>3.3</p>
<p> </p>
<p>Interaction Layer..........................................................................................................................................10</p>
<p> </p>
<p>3.4</p>
<p> </p>
<p>Network Management .................................................................................................................................10</p>
<p> </p>
<p>4.0</p>
<p> </p>
<p>Modeling Control Units (ECUs) in CAPL .......................................................................................................11</p>
<p> </p>
<p>4.1</p>
<p> </p>
<p>Signal Access..............................................................................................................................................11</p>
<p> </p>
<p>4.2</p>
<p> </p>
<p>Receiving Standard Messages ...................................................................................................................11</p>
<p> </p>
<p>4.3</p>
<p> </p>
<p>Receiving GM-Extended Messages............................................................................................................11</p>
<p> </p>
<p>4.4</p>
<p> </p>
<p>Receiving Signals Directly...........................................................................................................................11</p>
<p> </p>
<p>4.5</p>
<p> </p>
<p>Sending Standard Messages ......................................................................................................................12</p>
<p> </p>
<p>4.6</p>
<p> </p>
<p>Sending GM-Extended Messages ..............................................................................................................12</p>
<p> </p>
<p>5.0</p>
<p> </p>
<p>Test Feature Set ............................................................................................................................................13</p>
<p> </p>
<p>5.1</p>
<p> </p>
<p>Test Feature Set in CAPL ...........................................................................................................................13</p>
<p> </p>
<p>5.2</p>
<p> </p>
<p>Test Feature Set in XML .............................................................................................................................16</p>
<p> </p>
<p>5.3</p>
<p> </p>
<p>Test Service Library in CAPL and XML Test Modules................................................................................18</p>
<p> </p>
<p>5.4</p>
<p> </p>
<p>Test Automation Editor................................................................................................................................19</p>
<p> </p>
<p>5.5</p>
<p> </p>
<p>CANdb++ Test Module Generator ..............................................................................................................19</p>
<p> </p>
<p>6.0</p>
<p> </p>
<p>Additional Resources.....................................................................................................................................19</p>
<p> </p>
<p>7.0</p>
<p> </p>
<p>Contact...........................................................................................................................................................19</p>
<p> </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>2 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>1.0 </b></p>
<p><b>Overview </b></p>
<p><b>1.1 </b></p>
<p><b>Introduction </b></p>
<p>As a simulation, analysis and testing tool for electronic control units, CANoe supports the GMLAN 3.0 protocol in a </p>
<p>special way. This document briefly describes the support provided by CANoe specifically for GMLAN and explains </p>
<p>the possible use cases of the “Test Feature Set” for GMLAN in detail. This document is based on CANoe version </p>
<p>7.2. Because CANoe support for GMLAN is extended continuously, we recommend that the reader checks whether </p>
<p>a newer version of this document is available. </p>
<p>The general Test Feature Set concept is explained in a separate document; see chapter 6.0. Familiarity with the </p>
<p>Test Featu</p>
<p>re Set is assumed in this document. </p>
<p><b>1.2 </b></p>
<p><b>Terms and Abbreviations </b></p>
<p>Term </p>
<p>Meaning </p>
<p>CANoe </p>
<p>Vector product </p>
<p>SUT </p>
<p>System under Test </p>
<p>TFS </p>
<p>Test Feature Set </p>
<p>Æ</p>
<p>CANoe component </p>
<p>TSL </p>
<p>Test Service Library </p>
<p>Æ</p>
<p>TFS component </p>
<p>CAPL </p>
<p>CANoe Access Programming Language </p>
<p>Æ</p>
<p>Language used for programming simulation </p>
<p>nodes, test modules etc. in CANoe. </p>
<p>hsCAN </p>
<p>High speed CAN Bus (GM-specific terminology)</p>
<p>swCAN </p>
<p>Single wire CAN Bus (GM-specific terminology) </p>
<p>GM extended </p>
<p>message </p>
<p>Message with a 29-bit identifier </p>
<p>Standard message </p>
<p>Message with an 11-bit identifier </p>
<p>Panel Designer </p>
<p>Vector product for editing panels </p>
<p>Panel Editor </p>
<p>Vector product for editing panels </p>
<p>Test Automation </p>
<p>Editor </p>
<p>Vector product for editing XML test modules </p>
<p>Table 1: Terms and Abbreviations </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>3 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>2.0 </b></p>
<p><b>Basic Support in CANoe </b></p>
<p>Basic support for GMLAN is activated automatically as soon as a GMLAN network file is identified. The existence </p>
<p>and contents of the “UseGMParameterIds” network attribute are used as identification criteria. </p>
<p>Details about basic support, which are available in the Online Help for CANoe, are referenced briefly in the </p>
<p>following chapters. </p>
<p><b>2.1 </b></p>
<p><b>Trace Window </b></p>
<p>Separate columns display GM-specific “SourceID”, “Prio” and “ParameterID” information. The “GMLAN” base </p>
<p>configuration can be selected. This contains basic information along with additional GM-relevant default columns </p>
<p>such as “Prio”, “PID”, “SourceID” and “CAN-ID”. </p>
<p><b>2.2 </b></p>
<p><b>Logging </b></p>
<p>GM-extended messages are logged along with standard messages. The CAN-ID is decoded in the comment field </p>
<p>and documented separately as “ParameterID”, “SourceID” and “Prio”. </p>
<p><b>2.3 </b></p>
<p><b>Export </b></p>
<p>Signal histories for standard messages can be exported from the log block, but this is not possible for signals on </p>
<p>GM-extended messages. </p>
<p><b>2.4 </b></p>
<p><b>Interactive Generator Block </b></p>
<p>The Interactive Generator Block (IG) allows GM-extended messages to be sent. A special “GMLAN” tab is </p>
<p>provided for this purpose, as well as the ability to modify the message priority and SourceID. </p>
<p> </p>
<p>Figure 1: Defining a message in the Interactive Generator Block </p>
<p><b>2.5 </b></p>
<p><b>Generator Block </b></p>
<p>The Generator Block makes it possible to send GM-extended messages in symbolic entry mode. </p>
<p><b>2.6 </b></p>
<p><b>Symbol Selection Dialog </b></p>
<p>The symbolic selection dialog makes it possible to select symbols from the network database (*.dbc). </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>4 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>2.6.1 </b></p>
<p><b>Selecting a Message </b></p>
<p>Messages can be selected, for example, in filters, in the Interactive Generator Block and in the CAPL browser. </p>
<p> </p>
<p>Figure 2: Message selection in the symbolic selection dialog </p>
<p> </p>
<p>Only the message name is included in the <b>CAPL </b>browser, regardless of the path followed in the selection dialog. </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>5 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>2.6.2 </b></p>
<p><b>Selecting a signal </b></p>
<p>Signals can be selected, for instance, in the CAPL browser, the Data Window and the Graphics Window. </p>
<p> </p>
<p>Figure 3: Signal selection in the symbolic selection dialog  </p>
<p> </p>
<p>Only the signal name is included in the <b>CAPL browser</b>, regardless of how the selection dialog is navigated. If </p>
<p>additional qualifiers are required, these can be inserted in the CAPL browser by choosing “Insert message from </p>
<p>CANdb++…”. </p>
<p><b>2.7 </b></p>
<p><b>Data Window </b></p>
<p>Application signals are fully supported in the Data Window.  </p>
<p>. </p>
<p> </p>
<p>Figure 4: Data Window </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>6 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p>The send node of the signals can be checked in the special dialog “configuration overview” that is accessible from </p>
<p>the context menu of the Data Window: </p>
<p> </p>
<p> </p>
<p>Figure 5: Configuration overview </p>
<p><b>2.7.1 </b></p>
<p><b>Special signals in the Data window </b></p>
<p>Message-specific statistical signals can be selected in the Data and Graphics windows. These are available for </p>
<p>standard messages but not for GM-extended messages. </p>
<p><b>2.8 </b></p>
<p><b>Graphics Window </b></p>
<p>The Graphics Window allows the display of signals on a timeline. The notes that apply to the Data Window apply </p>
<p>equally to the selection of signals and special signals in the Graphics Window (see 2.7). </p>
<p><b>2.9 </b></p>
<p><b>Panels </b></p>
<p>A panel may contain elements used to visualize and control signal values. The notes that apply to the Data </p>
<p>Window apply similar to the selection of signals here (see 2.7).  </p>
<p>The Panel Ed</p>
<p>itor selects a signal via a symbol path that contains the database name, the tx node, the tx message </p>
<p>and the signal. For older configurations (created with older versions than CANoe 7.0), it must be ensured that the </p>
<p>tx node is part of the symbol path (see area highlighted in red).  </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>7 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p> </p>
<p>Figure 6: Configuration dialog for an “Input/Output Box” panel control </p>
<p>The Panel Designer fully supports GM by automatically inserting the tx node. </p>
<p><b>2.10 CAPL </b></p>
<p>A special message type – “gmlanMessage” – is available for GM-extended messages in CAPL, the CANoe </p>
<p>programming language. With this message type, the Prio and SourceID parameters present in addition to the </p>
<p>ParameterID can be queried using operators and set using special functions.  </p>
<p>Relevant CAPL code fragments are available e.g. in chapter 4.3. </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>8 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>3.0 </b></p>
<p><b>“GM Package” Modeling Package </b></p>
<p>The “GM Package” modeling package contains the following special GM-specific components: </p>
<p>•</p>
<p> </p>
<p>Interaction layer </p>
<p>•</p>
<p> </p>
<p>Network management </p>
<p>•</p>
<p> </p>
<p>Model generation </p>
<p>•</p>
<p> </p>
<p>Message panels for visualizing and controlling signal values. </p>
<p> </p>
<p>Since the supplied manual of the GM Package provides details on the modeling package and the components </p>
<p>included in it, the following chapter discusses the functionality of the package only briefly. </p>
<p>The modeling package is not included in the default CANoe installation, but can be requested from Vector support </p>
<p>mailto:support@de.vector.com as a separate package free of charge. </p>
<p><b>3.1 </b></p>
<p><b>Model Generation </b></p>
<p>The model generation wizard included in CANoe has been extended to include a GM option. swCAN and hsCAN </p>
<p>networks can be generated. </p>
<p> </p>
<p>Figure 7: Model Generation Wizard </p>
<p> </p>
<p>It is also possible to generate a multi-bus configuration. </p>
<p>Generation produces a complete CANoe configuration; the only action required is to select a node from the </p>
<p>alternative nodes in the GM network file and to deactivate or delete unused nodes in the simulation setup. </p>
<p><b>3.2 </b></p>
<p><b>Node Panels, Message Panels </b></p>
<p>The configuration generated by the model generation wizard uses message controls developed especially for GM. </p>
<p>These message controls make it possible, for example, to modify the signal values that are transmitted by the </p>
<p>simulated nodes. The panels can be used to visualize signal values for concretely existing nodes. </p>
<p>These controls can be created/changed in the “Panel Editor”. </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>9 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p> </p>
<p>Figure 8: Panel for changing and visualizing all send signals of a node in their messages </p>
<p> </p>
<p>In addition, a network management panel is generated for each node with which the virtual network status for </p>
<p>existing simulated nodes can be visualized and modified.  </p>
<p> </p>
<p>Figure 9: Panel for controlling and visualizing the network status for the current node </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>10 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>3.3 </b></p>
<p><b>Interaction Layer </b></p>
<p>The interaction layer can be integrated into individual simulation nodes as a modeling DLL. It is used automatically </p>
<p>when a model is generated using the model generation wizard. The interaction layer configures itself on the basis </p>
<p>of the network database. Changes to the network database are therefore integrated automatically. The tasks of the </p>
<p>individual components are: </p>
<p>•</p>
<p> </p>
<p>To  provide  a  signal-oriented  interface,  i.e.  individual  signal  values  can  be  set  as  signal  stimulants  from </p>
<p>within in CAPL, panels and the Test Feature Set. When using the COM server, then ensure to use the </p>
<p>signal objects that are “outputs” or “inputs” of nodes. </p>
<p>•</p>
<p> </p>
<p>To utilize the network database’s transmission model. Cyclical transmissions, spontaneous transmissions </p>
<p>in reaction to changes, etc. are sent to the bus in accordance with the transmission model. </p>
<p>•</p>
<p> </p>
<p>For some test cases, it is also necessary to be able to send messages on request. This is supported as </p>
<p>well. </p>
<p>•</p>
<p> </p>
<p>Linkage  to  the  network  management:  The  “virtual  networks”  observed  by  the  network  management  are </p>
<p>known to the interaction layer. This affects whether a transmission should actually be sent or not. </p>
<p>•</p>
<p> </p>
<p>To provide a standard fault injection interface which is suitable to control the sending of messages from </p>
<p>within  CAPL.  For  more  information  about  these  functions  refer  to  the  CANoe  Online  Help.  These </p>
<p>functionalities can also be used comfortable in CANoe Test Modules. </p>
<p><b>3.4 </b></p>
<p><b>Network Management </b></p>
<p>Network management is also available as a special modeling DLL. This component also configures itself based on </p>
<p>information contained in the network database. </p>
<p>The individual tasks of the components are: </p>
<p>•</p>
<p> </p>
<p>To control bus communications when waking up virtual networks and keeping them awake, insofar as the </p>
<p>node‘s role is that of an activator. </p>
<p>•</p>
<p> </p>
<p>To observe bus communications in order to detect changes in the status of the virtual networks that control </p>
<p>the node. </p>
<p>•</p>
<p> </p>
<p>Depending on the status of the virtual networks, the interaction layer is informed and its transmissions are </p>
<p>suppressed completely. The virtual networks can be activated or deactivated manually in CAPL or on the </p>
<p>panel. </p>
<p>•</p>
<p> </p>
<p>To provide a CAPL interface that makes it possible to control virtual networks or remain informed of virtual </p>
<p>network status changes from within the application. </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>11 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>4.0 </b></p>
<p><b>Modeling Control Units (ECUs) in CAPL </b></p>
<p>In principle, the following message types are available with GMLAN: </p>
<p>•</p>
<p> </p>
<p>Standard messages (with 11-bit message IDs) </p>
<p>•</p>
<p> </p>
<p>GM-extended messages (with 29-bit message IDs) </p>
<p>Messages of both types can be sent as well as received: </p>
<p><b>4.1 </b></p>
<p><b>Signal Access </b></p>
<p>To access to signal values (set and get signal value) there is a tight way available by using the $-operator: </p>
<p>dword sigValue;  </p>
<p>$ECC::A2RAlrmTime = 10;           // set signal value </p>
<p>sigValue = $ECC::A2RAlrmTime;     // get signal value </p>
<p><b>4.2 </b></p>
<p><b>Receiving Standard Messages </b></p>
<p>Standard messages can be received and evaluated in the usual way by defining “on message” handlers: </p>
<p>on message Dynamic_Normal_Force </p>
<p>{ </p>
<p>  long val; </p>
<p>  val = this.DynNrmlFrcFrLfWhl;  // signal access </p>
<p>  // Application code … </p>
<p>} </p>
<p><b>4.3 </b></p>
<p><b>Receiving GM-Extended Messages </b></p>
<p>GM-extended messages can be received and evaluated by defining “on gmlanmessage” handlers: The message </p>
<p>handler can then be programmed specifically for one or more SourceIDs: </p>
<p>on gmlanmessage Chime_Status  </p>
<p>{ </p>
<p>  long val; </p>
<p>  if(gmLanGetSourceId(this) == AMP.SourceId) </p>
<p>  { </p>
<p>    val = this.ChmAct; </p>
<p>    // Application code … </p>
<p>  } </p>
<p>} </p>
<p><b>4.4 </b></p>
<p><b>Receiving Signals Directly </b></p>
<p>Signals can be received directly in CANoe by defining an “on signal” handler in CAPL. This is supported for signals </p>
<p>on standard messages but not currently for signals on GM-extended messages. </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>12 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p> </p>
<p><b>4.5 </b></p>
<p><b>Sending Standard Messages </b></p>
<p>Standard messages are sent according to the following general principle: </p>
<p>  message Dynamic_Normal_Force msg; </p>
<p>  msg.DynNrmlFrcFrLfWhl = 1;  // example signal value </p>
<p>  output(msg); </p>
<p> </p>
<p><b>4.6 </b></p>
<p><b>Sending GM-Extended Messages </b></p>
<p>Before a GM-extended message is sent, the SourceID must be specified; whereas the Prio is added automatically: </p>
<p>gmlanmessage ChimeStatus msg; </p>
<p>gmLanSetSourceId(msg, AMP.SourceId); </p>
<p>output(msg) </p>
<p>Hint: When working signal oriented (4.1), the message is sent by the Intera</p>
<p>ction layer; no need to care about </p>
<p>SourceIDs. </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>13 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>5.0 </b></p>
<p><b>Test Feature Set </b></p>
<p><b>5.1 </b></p>
<p><b>Test Feature Set in CAPL </b></p>
<p>A typical test sequence consists of </p>
<p>•</p>
<p> </p>
<p>Stimulation of signals or messages (SUT input vector) </p>
<p>•</p>
<p> </p>
<p>Allowance for a SUT settling time until the expected reaction is to occur, and </p>
<p>•</p>
<p> </p>
<p>Evaluation of signal states or message events (SUT output vector) in response to the stimulation. </p>
<p> </p>
<p>The allowed settling time can be shortened by specifying a concrete event in the test sequence, e.g. receipt of a </p>
<p>message with a specific message ID. </p>
<p>Test sequences can be structured into test cases, test groups and test modules. </p>
<p>The CANoe test sequence and test structure apply equally to GMLAN, regardless of whether the test modules are </p>
<p>formulated in CAPL, XML or .NET. There are, however, a number of particularities, which are explained in the </p>
<p>following chapters.  </p>
<p><b>5.1.1 </b></p>
<p><b>Configuring the Restbus Simulation </b></p>
<p>The restbus simulation is used directly by the Test Feature Set. Based on the interaction layer configured there, it </p>
<p>takes charge of sending messages and thus of signal stimulation. Consequently, the prerequisite for the </p>
<p>stimulation of signal values is that the restbus simulation node is present in the simulation setup and is assigned to </p>
<p>the database node, and that the “CANoe GM Interaction Layer” modeling DLL is assigned to the simulation node. </p>
<p>Note: </p>
<p>The restbus simulation will be correctly and fully configured if it is created using the “model </p>
<p>generation wizard” that comes with the modeling package. Use of this generation method is </p>
<p>therefore recommended. </p>
<p> </p>
<p><b>5.1.2 </b></p>
<p><b>Signal Abstraction – Evaluation </b></p>
<p>Note: </p>
<p>For signals that are mapped onto GM extended messages the signal symbol has to be prefixed by </p>
<p>the send node, e.g. checkSignalInRange(ECC::A2RAlrmTime, 10, 20). </p>
<p>A signal value can be compared directly to a specified interval using the following functions: </p>
<p>long checkSignalInRange(dbSignal aSignal,          </p>
<p>                        float aLowLimit,  </p>
<p>                        float aHighLimit); </p>
<p> </p>
<p>Combined signal value queries, immediate comparison with a specified interval and automatic recording of the </p>
<p>actual and target values for the comparison results are also possible by means of special functions:  </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>14 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p>long testValidateSignalInRange (char aTestStep[],  </p>
<p>                                dbSignal aSignal,  </p>
<p>                                float aLowLimit,  </p>
<p>                                float aHighLimit) </p>
<p>long testValidateSignalOutsideRange (char aTestStep[],  </p>
<p>                                     dbSignal aSignal,  </p>
<p>                                     float aLowLimit,  </p>
<p>                                     float aHighLimit) </p>
<p>Please refer to the CANoe Online Help for further details about these functions. </p>
<p><b>5.1.3 </b></p>
<p><b>Signal Abstraction – Stimulation </b></p>
<p>Signal values can be stimulated with the $-operator (4.1). This requires (at least for the specified Tx node) a </p>
<p>configured restbus simulation (5.1.1). </p>
<p>$ECC::A2RAlrmTime = 10;  </p>
<p>If a signal tha</p>
<p>t is already being sent by a real ECU is to be stimulated as part of a test sequence, then the real ECU </p>
<p>should be stimulated, thereby indirectly causing the changed signal value to be sent. </p>
<p>Using the signal stimulation within the Test Feature Set the stimulation is reported in the test report. </p>
<p><b>5.1.4 </b></p>
<p><b>Message Abstraction – Evaluation  </b></p>
<p>There are also <b>wait functions </b>available for testing message events, with which the test sequence pauses until the </p>
<p>event condition is fulfilled.  Simulation node techniques (see 4.1 and 4.3) are available likewise. These wait </p>
<p>function</p>
<p>s can be used either symbolically by specifying a message symbol from the network file or numerically by </p>
<p>specifying a message ID. </p>
<p>For <b>standard messages </b>these are: </p>
<p>long TestWaitForMessage(dbMessage aMsg, dword aTimeout) </p>
<p>long TestWaitForMessage(long aMsgId, dword aTimeout) </p>
<p> </p>
<p>For <b>GM-extended messages</b>, only the numeric function for passing the message ID is available; alternative ways </p>
<p>of using the wait function are described below: </p>
<p><b>a) Symbolic setup via instantiation of a message buffer </b></p>
<p>The “aMsgId” expected in the function is created by means of a series of calls. The example below is </p>
<p>constructed for the send node “AMP” that transmits the message “Chime_Status”, with a maximum wait </p>
<p>time of 2000ms: </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>15 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p>// Example signal evaluation on message level  </p>
<p>testcase a () </p>
<p>{ </p>
<p>  gmlanmessage Chime_Status msg;   </p>
<p> </p>
<p>  if(testWaitForMessage(gmLanId(Chime_Status, AMP), 2000) == 1) </p>
<p>  { </p>
<p>    testGetWaitEventMsgData(msg); </p>
<p> </p>
<p>    if(msg.ChmAct == 1) </p>
<p>      TestStepPass(&quot;A&quot;, &quot;Message received, signal matches&quot;); </p>
<p>    else </p>
<p>      TestStepFail(&quot;A&quot;, &quot;Message received, signal does not match&quot;); </p>
<p>  } </p>
<p>  else  </p>
<p>    TestStepFail(&quot;A&quot;, &quot;Message missing&quot;); </p>
<p>} </p>
<p> </p>
<p>Commonly, application level tests are done by using signal access and signal test functions. Message </p>
<p>level checks are done mostly by utilizing the TSL checks (refer </p>
<p>5.3 for details).   </p>
<p><b>b) Nume</b></p>
<p><b>rical setup via modification of a message buffer </b></p>
<p>If the name of the message or send node is not known in CAPL and the message ID is to be set up in a </p>
<p>strictly numerical manner, the following steps are necessary: </p>
<p>// initialise local variables </p>
<p>gmlanmessage * msg1; </p>
<p> </p>
<p>// do something, e.g. stimulate the SUT </p>
<p> </p>
<p>// Set up and wait for response </p>
<p>msg1.id = (0x10); </p>
<p>gmLanSetSourceId(msg1, 0x81); </p>
<p>gmLanSetPrio(msg1, 4); </p>
<p>TestWaitForMessage(msg1.id, 2000); </p>
<p> </p>
<p><b>5.1.5 </b></p>
<p><b>Message Abstraction – Stimulation  </b></p>
<p>GM messages are sent in the same way as in simulation nodes. Standard GM messages are handled as described </p>
<p>in the CANoe Online Help. Only the GM-extended messages require special treatment: The “Prio” and “SourceID” </p>
<p>parameters can be added to a CAN-ID in the following ways: </p>
<p>Numerically, within the variable definition: </p>
<p>testcase numericOutput() </p>
<p>{ </p>
<p>  gmlanmessage 0x10x msg1 = {SA =0x81, PRIO= 0x4}; </p>
<p>  output(msg1); </p>
<p>} </p>
<p>Specifying PRIO (for the message priority) is optional, as this is taken from the message definition. If it is not </p>
<p>specified, the SA selector (for the SourceID) is taken to be 0. For this reason, it is absolutely necessary to add the </p>
<p>SourceID by using, for example, the following process (see also 4.6): </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>16 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p>testcase symbolicOutputProgrammatic() </p>
<p>{ </p>
<p>  gmlanmessage Chime_Status msg2; </p>
<p>  gmLanSetSourceId(msg2, AMP.SourceId); </p>
<p>  output(msg2); </p>
<p>} </p>
<p><b>5.1.6 </b></p>
<p><b>Interaction Layer Fault Injection Functions </b></p>
<p>There are also <b>Fault Injection </b>functions available which are suitable to control the sending of messages, e.g. to </p>
<p>change the cycle time, to suppress messages completely or to change the DLC of messages. For more information </p>
<p>about these functions refer to the CANoe Online Help. </p>
<p>These fault injection functions can also be used for messages with extended IDs. Therefore the ID-based functions </p>
<p>have to be used: </p>
<p>id_DDM = gmLanId(Driver_Door_Status, DDM); </p>
<p>TestDisableMsg(id_DDM); </p>
<p>This example disables the sending of the message “Driver_Door_Status” of node “DDM”. </p>
<p><b>5.2 </b></p>
<p><b>Test Feature Set in XML </b></p>
<p>GMLAN requires no new constructs with the Test Feature Set in XML test modules. The existing qualification of </p>
<p>signals using send nodes can be used directly here and must be used for GM-extended messages and their </p>
<p>signals. </p>
<p>The table below shows the existing test functions and their GM support: </p>
<p><b>Test function name </b></p>
<p>Usage in test modules <b>for messages with standard or GM-</b></p>
<p><b>extended IDs </b></p>
<p>Await Value Match </p>
<p>3</p>
<p> </p>
<p>CANstress Configuration </p>
<p>3</p>
<p> Trigger/disturbance definition for standard IDs </p>
<p>:</p>
<p> Trigger/disturbance definition for GM-extended IDs </p>
<p>CANstress State </p>
<p>3</p>
<p> </p>
<p>Diagnostics Service </p>
<p>3</p>
<p> </p>
<p>Diagnostics Service Check </p>
<p>(replaced by Diagnostics Service) </p>
<p>3</p>
<p> </p>
<p>Initialize </p>
<p>3</p>
<p> for signal abstraction </p>
<p>3</p>
<p> for message abstraction </p>
<p>Replay </p>
<p>3</p>
<p> </p>
<p>Request Response </p>
<p>3</p>
<p> </p>
<p>Set </p>
<p>3</p>
<p> for signal abstraction </p>
<p>3</p>
<p> for message abstraction </p>
<p>State Change </p>
<p>3</p>
<p> </p>
<p>State Check </p>
<p>3</p>
<p> </p>
<p>Stimulate Ramp </p>
<p>3</p>
<p> </p>
<p>System Call </p>
<p>3</p>
<p> </p>
<p>Tester Confirmation </p>
<p>3</p>
<p> </p>
<p>Until End </p>
<p>3</p>
<p> </p>
<p>VT System Configuration </p>
<p>3</p>
<p> </p>
<p>Wait </p>
<p>3</p>
<p> </p>
<p>Window Capture </p>
<p>3</p>
<p> </p>
<p>Table 2: XML Test Functions </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>17 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p>Syntax example for GM-extended: </p>
<p>&lt;testcase title=&quot;my GM test case&quot;&gt; </p>
<p>  &lt;statechange wait=&quot;200ms&quot;&gt; </p>
<p>    &lt;in&gt; </p>
<p>      &lt;cansignal id=&quot;stim_sig&quot; node=&quot;sender&quot;&gt; </p>
<p>       10 </p>
<p>      &lt;/cansignal&gt; </p>
<p>    &lt;/in&gt; </p>
<p>    &lt;expected&gt; </p>
<p>      &lt;cansignal id=&quot;expected_sig&quot; node=&quot;sender&quot;&gt; </p>
<p>        &lt;eq&gt;10&lt;/eq&gt; </p>
<p>      &lt;/cansignal&gt; </p>
<p>    &lt;/expected&gt; </p>
<p>  &lt;/statechange&gt; </p>
<p>&lt;/testcase&gt; </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>18 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>5.3 </b></p>
<p><b>Test Service Library in CAPL and XML Test Modules </b></p>
<p>The table below shows the existing check objects (“TSL checks”) and their usage for different message types: </p>
<p>Usage in test modules </p>
<p><b>for messages with </b></p>
<p><b>standard IDs </b></p>
<p> </p>
<p>Usage in test modules <b>for messages with </b></p>
<p><b>GM-extended IDs </b></p>
<p> </p>
<p><b>Check base name </b></p>
<p>CAPL  </p>
<p>XML </p>
<p>CAPL </p>
<p>XML </p>
<p>Cycle Time (Abs) </p>
<p>    For message </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> (ID-based)  </p>
<p>3</p>
<p> </p>
<p>Cycle Time (Rel) </p>
<p>    For message </p>
<p>3</p>
<p>  </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> (ID-based) </p>
<p>3</p>
<p> </p>
<p>    For node </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>DLC Monitoring </p>
<p>    For single message </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> (ID-based) </p>
<p>3</p>
<p> </p>
<p>    For all tx messages of node </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>    For all rx messages of node </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>Error Frame Check </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>Fallback Observation </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>Message Distance </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> (ID-based) </p>
<p>3</p>
<p> </p>
<p>Unknown Message Received </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>Signal Value Constancy </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>Node Active </p>
<p>    For message list </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>    For single node </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>    For all nodes </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>Node Inactive </p>
<p> </p>
<p> </p>
<p>    For message list </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>    For single node </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>    For all nodes </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>Absence of Defined Message </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> (ID-based) </p>
<p>3</p>
<p> </p>
<p>Occurrence of a Message </p>
<p>    For single message </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> (ID-based) </p>
<p>3</p>
<p> </p>
<p>    For node </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>Request Response Check </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>Value Invariant </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>-- </p>
<p>3</p>
<p> </p>
<p>Signal Value </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>Timeout Check </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>3</p>
<p> </p>
<p>Table 3: Test Service Library Checks </p>
<p> </p>
<p><b>Symbols </b></p>
<p><b>Meaning </b></p>
<p>3</p>
<p> </p>
<p>Fully supported </p>
<p>-- </p>
<p>Generally not available (specific feature of </p>
<p>XML test modules or CAPL test modules) </p>
<p>:</p>
<p> </p>
<p>Not supported for GM-extended messages </p>
<p> </p>
<p> </p>
<h1 style="page-break-before:always; "></h1>
<p> </p>
<p> </p>
<p>GM Support in CANoe 7.2</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p><i><b> </b></i></p>
<p><b>19 </b></p>
<p><i>Application Note AN-IND-8-003 </i></p>
<p><b> </b></p>
<p><b>5.4 </b></p>
<p><b>Test Automation Editor </b></p>
<p>The Test Automation Editor 1.1 supports fully the GMLAN networks and the editing of XML test modules.  </p>
<p>It provides a setting to fill in always the send node of an added symbol. </p>
<p> </p>
<p>For further information about the separate Vector product Test Automation Editor, see http://www.vector.com/tae</p>
<p>. </p>
<p><b>5.5 </b></p>
<p><b>CANdb++ Test Module Generator </b></p>
<p>The CANdb++ test module generator is available as standard component within the CANoe installation. It can be accessed from </p>
<p>the context menu of node objects, or within the “File</p>
<p>Æ</p>
<p>PlugIns” menu. </p>
<p> </p>
<p>The CANdb++ Test Module Generator uses the check objects in the Test Service Library and fully supports GM. If a </p>
<p>configuration contains multiple buses, it is important to specify the bus name for the generation. </p>
<p> </p>
<p>Please refer to the CANoe Online Help for more detailed information about the test module generator. </p>
<p><b>6.0 </b></p>
<p><b>Additional Resources </b></p>
<p>VECTOR APPLICATION NOTE </p>
<p><b>AN-IND-1-002 </b></p>
<p><b>Testing with CANoe </b></p>
<p><b>7.0 </b></p>
<p><b>Contact </b></p>
<p> </p>
<p><b>Germany  </b></p>
<p><b>and all countries not named below: </b></p>
<p><b>Vector Informatik GmbH </b></p>
<p>Ingersheimer Str. 24 </p>
<p>70499 Stuttgart </p>
<p>GERMANY </p>
<p>Phone: +49 711-80670-0 </p>
<p>Fax: </p>
<p>+49 711-80670-111 </p>
<p>E-mail:  info@de.vector.com </p>
<p> </p>
<p> </p>
<p><b>France, Belgium, Luxemburg: </b></p>
<p><b> </b></p>
<p><b>Vector France SAS </b></p>
<p>168 Boulevard Camélinat </p>
<p>92240 Malakoff  </p>
<p>FRANCE </p>
<p>Phone: +33 1 42 31 40 00 </p>
<p>Fax: </p>
<p>+33 1 42 31 40 09 </p>
<p>E-mail:  information@fr.vector.com </p>
<p> </p>
<p> </p>
<p><b>Sweden, Denmark, Norway,  </b></p>
<p><b>Finland, Iceland: </b></p>
<p><b>VecScan AB </b></p>
<p>Theres Svenssons Gata 9 </p>
<p>41755 Göteborg  </p>
<p>SWEDEN </p>
<p>Phone: +46 31 764 76 00 </p>
<p>Fax: </p>
<p>+46 31 764 76 19  </p>
<p>E-mail:  info@se.vector.com </p>
<p> </p>
<p> </p>
<p><b>United Kingdom, Ireland: </b></p>
<p><b>Vector GB Ltd. </b></p>
<p>Rhodium </p>
<p>Central Boulevard </p>
<p>Blythe Valley Park </p>
<p>Solihull, Birmingham </p>
<p>West Midlands B90 8AS </p>
<p>UNITED KINGDOM </p>
<p>Phone: +44 121 50681-50 </p>
<p>E-mail:  info@uk.vector.com </p>
<p> </p>
<p>  </p>
<p><b>China: </b></p>
<p>Vector Informatik GmbH  </p>
<p>Shanghai Representative Office </p>
<p>Suite 605, Tower C,  </p>
<p>Everbright Convention Center </p>
<p>No. 70 Caobao Road </p>
<p>Xuhui District </p>
<p>Shanghai 200235  </p>
<p>P.R. CHINA </p>
<p>Phone: +86 21 - 6432 5353 ext. 0 </p>
<p>Fax:  </p>
<p>+86 21 - 6432 5308 </p>
<p>E-mail: info@vector-china.com </p>
<p> </p>
<p><b> </b></p>
<p><b>India: </b></p>
<p>Vector Informatik India Private Ltd. </p>
<p>4/1/1/1 Sutar Icon </p>
<p>Sus Road </p>
<p>Pashan </p>
<p>Pune 411021 </p>
<p>INDIA </p>
<p> </p>
<p>Phone: +91 9673 336575 </p>
<p>E-mail: info@vector-india.com </p>
<p> </p>
<p><b>USA, Canada, Mexico: </b></p>
<p><b>Vector CANtech, Inc. </b></p>
<p>39500 Orchard Hill Pl., Ste 550 </p>
<p>Novi, MI  48375 </p>
<p>USA </p>
<p>Phone: +1 248 449 9290 </p>
<p>Fax: </p>
<p>+1 248 449 9704 </p>
<p>E-mail:  info@us.vector.com </p>
<p> </p>
<p> </p>
<p><b>Japan: </b></p>
<p><b>Vector Japan Co. Ltd. </b></p>
<p>Seafort Square Center Bld. 18F </p>
<p>2-3-12, Higashi-shinagawa, </p>
<p>Shinagawa-ku </p>
<p>Tokyo 140-0002 </p>
<p>JAPAN </p>
<p>Phone: +81 3 5769 7800 </p>
<p>Fax: </p>
<p>+81 3 5769 6975 </p>
<p>E-mail:  info@jp.vector.com </p>
<p> </p>
<p> </p>
<p><b>Korea: </b></p>
<p><b>Vector Korea IT Inc.</b></p>
<p><b> </b></p>
<p>#1406, Mario Tower, </p>
<p>222-12 Guro-dong, Guro-gu  </p>
<p>Seoul, 152-848 </p>
<p>REPUBLIC OF KOREA </p>
<p>Phone: +82 2 807 0600 </p>
<p>Fax: </p>
<p>+82 2 807 0601 </p>
<p>E-mail:  info@kr.vector.com </p>
<p> </p>
<p> </p>
</body>
</html>
{% endraw %}